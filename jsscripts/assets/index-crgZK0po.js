import{s as ee,t as Nt,T as Je,u as yn,E as ma,c as ut,V as U,h as se,y as oi,S as Ts,a as it,C as ie,W as _s,D as jr,A as Ea,Z as Ni,x as De,P as Rn,aD as Ia,w as ga,aE as te,aF as Ca,at as Xr,z as Re,H as Is,J as Fn,K as Sn,N as re,Q as Zr,e as si,d as Fe,Y as Ta,aw as Js,aV as qn,aW as _a,aY as wa,bi as ya,aA as $r,$ as ws,b as ni,a0 as Li,r as Me,a1 as Pe,a2 as Mi,a3 as Di,a4 as Qr,L as An,a5 as Kr,a6 as qr,a7 as Jr,a8 as to,a9 as eo,aa as Qt,ab as fe,i as tn,ac as Ui,ad as Ra,ae as On,af as bn,ag as vn,ah as Nn,ai as xn,aj as Pn,ak as Ln,al as Mn,am as Dn,an as Un,ao as Bn,ap as zn,aq as io,B as Pt,ar as Fa,as as Sa,I as ys,aL as Rs,aM as Fs,aC as Ss,aG as Ns,_ as Dt,O as gs,j as Aa,aK as so,aN as no,aO as ro,aP as oo,aQ as ao,az as Oa,b5 as Jn,b6 as ba,X as tr,aH as ki,aB as Ie,aI as va,aJ as di,bb as Na}from"./web-ifc-api-BAs6yRon.js";var xa=Object.defineProperty,Pa=(a,t,e)=>t in a?xa(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,g=(a,t,e)=>(Pa(a,typeof t!="symbol"?t+"":t,e),e);const ho=0,La=1,Ma=2,er=2,xs=1.25,ir=1,us=6*4+4+4,As=65535,Da=Math.pow(2,-24),Ps=Symbol("SKIP_GENERATION");function Ua(a){return a.index?a.index.count:a.attributes.position.count}function ai(a){return Ua(a)/3}function Ba(a,t=ArrayBuffer){return a>65535?new Uint32Array(new t(4*a)):new Uint16Array(new t(2*a))}function za(a,t){if(!a.index){const e=a.attributes.position.count,i=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s=Ba(e,i);a.setIndex(new Fe(s,1));for(let n=0;n<e;n++)s[n]=n}}function lo(a){const t=ai(a),e=a.drawRange,i=e.start/3,s=(e.start+e.count)/3,n=Math.max(0,i),r=Math.min(t,s)-n;return[{offset:Math.floor(n),count:Math.floor(r)}]}function co(a){if(!a.groups||!a.groups.length)return lo(a);const t=[],e=new Set,i=a.drawRange,s=i.start/3,n=(i.start+i.count)/3;for(const o of a.groups){const h=o.start/3,l=(o.start+o.count)/3;e.add(Math.max(s,h)),e.add(Math.min(n,l))}const r=Array.from(e.values()).sort((o,h)=>o-h);for(let o=0;o<r.length-1;o++){const h=r[o],l=r[o+1];t.push({offset:Math.floor(h),count:Math.floor(l-h)})}return t}function ka(a){if(a.groups.length===0)return!1;const t=ai(a),e=co(a).sort((n,r)=>n.offset-r.offset),i=e[e.length-1];i.count=Math.min(t-i.offset,i.count);let s=0;return e.forEach(({count:n})=>s+=n),t!==s}function Rt(a,t,e){return e.min.x=t[a],e.min.y=t[a+1],e.min.z=t[a+2],e.max.x=t[a+3],e.max.y=t[a+4],e.max.z=t[a+5],e}function Ya(a){a[0]=a[1]=a[2]=1/0,a[3]=a[4]=a[5]=-1/0}function sr(a){let t=-1,e=-1/0;for(let i=0;i<3;i++){const s=a[i+3]-a[i];s>e&&(e=s,t=i)}return t}function nr(a,t){t.set(a)}function rr(a,t,e){let i,s;for(let n=0;n<3;n++){const r=n+3;i=a[n],s=t[n],e[n]=i<s?i:s,i=a[r],s=t[r],e[r]=i>s?i:s}}function Yi(a,t,e){for(let i=0;i<3;i++){const s=t[a+2*i],n=t[a+2*i+1],r=s-n,o=s+n;r<e[i]&&(e[i]=r),o>e[i+3]&&(e[i+3]=o)}}function ui(a){const t=a[3]-a[0],e=a[4]-a[1],i=a[5]-a[2];return 2*(t*e+e*i+i*t)}function Ls(a,t,e,i,s=null){let n=1/0,r=1/0,o=1/0,h=-1/0,l=-1/0,c=-1/0,p=1/0,u=1/0,d=1/0,m=-1/0,f=-1/0,E=-1/0;const I=s!==null;for(let C=t*6,R=(t+e)*6;C<R;C+=6){const T=a[C+0],y=a[C+1],O=T-y,A=T+y;O<n&&(n=O),A>h&&(h=A),I&&T<p&&(p=T),I&&T>m&&(m=T);const N=a[C+2],b=a[C+3],P=N-b,z=N+b;P<r&&(r=P),z>l&&(l=z),I&&N<u&&(u=N),I&&N>f&&(f=N);const F=a[C+4],x=a[C+5],w=F-x,M=F+x;w<o&&(o=w),M>c&&(c=M),I&&F<d&&(d=F),I&&F>E&&(E=F)}i[0]=n,i[1]=r,i[2]=o,i[3]=h,i[4]=l,i[5]=c,I&&(s[0]=p,s[1]=u,s[2]=d,s[3]=m,s[4]=f,s[5]=E)}function Va(a,t,e,i){let s=1/0,n=1/0,r=1/0,o=-1/0,h=-1/0,l=-1/0;for(let c=t*6,p=(t+e)*6;c<p;c+=6){const u=a[c+0];u<s&&(s=u),u>o&&(o=u);const d=a[c+2];d<n&&(n=d),d>h&&(h=d);const m=a[c+4];m<r&&(r=m),m>l&&(l=m)}i[0]=s,i[1]=n,i[2]=r,i[3]=o,i[4]=h,i[5]=l}function Ga(a,t){Ya(t);const e=a.attributes.position,i=a.index?a.index.array:null,s=ai(a),n=new Float32Array(s*6),r=e.normalized,o=e.array,h=e.offset||0;let l=3;e.isInterleavedBufferAttribute&&(l=e.data.stride);const c=["getX","getY","getZ"];for(let p=0;p<s;p++){const u=p*3,d=p*6;let m=u+0,f=u+1,E=u+2;i&&(m=i[m],f=i[f],E=i[E]),r||(m=m*l+h,f=f*l+h,E=E*l+h);for(let I=0;I<3;I++){let C,R,T;r?(C=e[c[I]](m),R=e[c[I]](f),T=e[c[I]](E)):(C=o[m+I],R=o[f+I],T=o[E+I]);let y=C;R<y&&(y=R),T<y&&(y=T);let O=C;R>O&&(O=R),T>O&&(O=T);const A=(O-y)/2,N=I*2;n[d+N+0]=y+A,n[d+N+1]=A+(Math.abs(y)+A)*Da,y<t[I]&&(t[I]=y),O>t[I+3]&&(t[I+3]=O)}}return n}const ue=32,Ha=(a,t)=>a.candidate-t.candidate,ge=new Array(ue).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Vi=new Float32Array(6);function Wa(a,t,e,i,s,n){let r=-1,o=0;if(n===ho)r=sr(t),r!==-1&&(o=(t[r]+t[r+3])/2);else if(n===La)r=sr(a),r!==-1&&(o=ja(e,i,s,r));else if(n===Ma){const h=ui(a);let l=xs*s;const c=i*6,p=(i+s)*6;for(let u=0;u<3;u++){const d=t[u],m=(t[u+3]-d)/ue;if(s<ue/4){const f=[...ge];f.length=s;let E=0;for(let C=c;C<p;C+=6,E++){const R=f[E];R.candidate=e[C+2*u],R.count=0;const{bounds:T,leftCacheBounds:y,rightCacheBounds:O}=R;for(let A=0;A<3;A++)O[A]=1/0,O[A+3]=-1/0,y[A]=1/0,y[A+3]=-1/0,T[A]=1/0,T[A+3]=-1/0;Yi(C,e,T)}f.sort(Ha);let I=s;for(let C=0;C<I;C++){const R=f[C];for(;C+1<I&&f[C+1].candidate===R.candidate;)f.splice(C+1,1),I--}for(let C=c;C<p;C+=6){const R=e[C+2*u];for(let T=0;T<I;T++){const y=f[T];R>=y.candidate?Yi(C,e,y.rightCacheBounds):(Yi(C,e,y.leftCacheBounds),y.count++)}}for(let C=0;C<I;C++){const R=f[C],T=R.count,y=s-R.count,O=R.leftCacheBounds,A=R.rightCacheBounds;let N=0;T!==0&&(N=ui(O)/h);let b=0;y!==0&&(b=ui(A)/h);const P=ir+xs*(N*T+b*y);P<l&&(r=u,l=P,o=R.candidate)}}else{for(let I=0;I<ue;I++){const C=ge[I];C.count=0,C.candidate=d+m+I*m;const R=C.bounds;for(let T=0;T<3;T++)R[T]=1/0,R[T+3]=-1/0}for(let I=c;I<p;I+=6){let C=~~((e[I+2*u]-d)/m);C>=ue&&(C=ue-1);const R=ge[C];R.count++,Yi(I,e,R.bounds)}const f=ge[ue-1];nr(f.bounds,f.rightCacheBounds);for(let I=ue-2;I>=0;I--){const C=ge[I],R=ge[I+1];rr(C.bounds,R.rightCacheBounds,C.rightCacheBounds)}let E=0;for(let I=0;I<ue-1;I++){const C=ge[I],R=C.count,T=C.bounds,y=ge[I+1].rightCacheBounds;R!==0&&(E===0?nr(T,Vi):rr(T,Vi,Vi)),E+=R;let O=0,A=0;E!==0&&(O=ui(Vi)/h);const N=s-E;N!==0&&(A=ui(y)/h);const b=ir+xs*(O*E+A*N);b<l&&(r=u,l=b,o=C.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${n} used.`);return{axis:r,pos:o}}function ja(a,t,e,i){let s=0;for(let n=t,r=t+e;n<r;n++)s+=a[n*6+i*2];return s/e}class Gi{constructor(){}}function Xa(a,t,e,i,s,n){let r=i,o=i+s-1;const h=n.pos,l=n.axis*2;for(;;){for(;r<=o&&e[r*6+l]<h;)r++;for(;r<=o&&e[o*6+l]>=h;)o--;if(r<o){for(let c=0;c<3;c++){let p=t[r*3+c];t[r*3+c]=t[o*3+c],t[o*3+c]=p}for(let c=0;c<6;c++){let p=e[r*6+c];e[r*6+c]=e[o*6+c],e[o*6+c]=p}r++,o--}else return r}}function Za(a,t,e,i,s,n){let r=i,o=i+s-1;const h=n.pos,l=n.axis*2;for(;;){for(;r<=o&&e[r*6+l]<h;)r++;for(;r<=o&&e[o*6+l]>=h;)o--;if(r<o){let c=a[r];a[r]=a[o],a[o]=c;for(let p=0;p<6;p++){let u=e[r*6+p];e[r*6+p]=e[o*6+p],e[o*6+p]=u}r++,o--}else return r}}function $a(a,t){const e=(a.index?a.index.count:a.attributes.position.count)/3,i=e>2**16,s=i?4:2,n=t?new SharedArrayBuffer(e*s):new ArrayBuffer(e*s),r=i?new Uint32Array(n):new Uint16Array(n);for(let o=0,h=r.length;o<h;o++)r[o]=o;return r}function Qa(a,t){const e=a.geometry,i=e.index?e.index.array:null,s=t.maxDepth,n=t.verbose,r=t.maxLeafTris,o=t.strategy,h=t.onProgress,l=ai(e),c=a._indirectBuffer;let p=!1;const u=new Float32Array(6),d=new Float32Array(6),m=Ga(e,u),f=t.indirect?Za:Xa,E=[],I=t.indirect?lo(e):co(e);if(I.length===1){const T=I[0],y=new Gi;y.boundingData=u,Va(m,T.offset,T.count,d),R(y,T.offset,T.count,d),E.push(y)}else for(let T of I){const y=new Gi;y.boundingData=new Float32Array(6),Ls(m,T.offset,T.count,y.boundingData,d),R(y,T.offset,T.count,d),E.push(y)}return E;function C(T){h&&h(T/l)}function R(T,y,O,A=null,N=0){if(!p&&N>=s&&(p=!0,n&&(console.warn(`MeshBVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),O<=r||N>=s)return C(y+O),T.offset=y,T.count=O,T;const b=Wa(T.boundingData,A,m,y,O,o);if(b.axis===-1)return C(y+O),T.offset=y,T.count=O,T;const P=f(c,i,m,y,O,b);if(P===y||P===y+O)C(y+O),T.offset=y,T.count=O;else{T.splitAxis=b.axis;const z=new Gi,F=y,x=P-y;T.left=z,z.boundingData=new Float32Array(6),Ls(m,F,x,z.boundingData,d),R(z,F,x,d,N+1);const w=new Gi,M=P,Z=O-x;T.right=w,w.boundingData=new Float32Array(6),Ls(m,M,Z,w.boundingData,d),R(w,M,Z,d,N+1)}return T}}function Ka(a,t){const e=a.geometry;t.indirect&&(a._indirectBuffer=$a(e,t.useSharedArrayBuffer),ka(e)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),a._indirectBuffer||za(e,t);const i=Qa(a,t);let s,n,r;const o=[],h=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let p=0;p<i.length;p++){const u=i[p];let d=l(u);const m=new h(us*d);s=new Float32Array(m),n=new Uint32Array(m),r=new Uint16Array(m),c(0,u),o.push(m)}a._roots=o;return;function l(p){return p.count?1:1+l(p.left)+l(p.right)}function c(p,u){const d=p/4,m=p/2,f=!!u.count,E=u.boundingData;for(let I=0;I<6;I++)s[d+I]=E[I];if(f){const I=u.offset,C=u.count;return n[d+6]=I,r[m+14]=C,r[m+15]=As,p+us}else{const I=u.left,C=u.right,R=u.splitAxis;let T;if(T=c(p+us,I),T/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=T/4,T=c(T,C),n[d+7]=R,T}}}class Ee{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let i=1/0,s=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n][e];i=o<i?o:i,s=o>s?o:s}this.min=i,this.max=s}setFromPoints(t,e){let i=1/0,s=-1/0;for(let n=0,r=e.length;n<r;n++){const o=e[n],h=t.dot(o);i=h<i?h:i,s=h>s?h:s}this.min=i,this.max=s}isSeparated(t){return this.min>t.max||t.min>this.max}}Ee.prototype.setFromBox=function(){const a=new U;return function(t,e){const i=e.min,s=e.max;let n=1/0,r=-1/0;for(let o=0;o<=1;o++)for(let h=0;h<=1;h++)for(let l=0;l<=1;l++){a.x=i.x*o+s.x*(1-o),a.y=i.y*h+s.y*(1-h),a.z=i.z*l+s.z*(1-l);const c=t.dot(a);n=Math.min(c,n),r=Math.max(c,r)}this.min=n,this.max=r}}();const qa=function(){const a=new U,t=new U,e=new U;return function(i,s,n){const r=i.start,o=a,h=s.start,l=t;e.subVectors(r,h),a.subVectors(i.end,i.start),t.subVectors(s.end,s.start);const c=e.dot(l),p=l.dot(o),u=l.dot(l),d=e.dot(o),m=o.dot(o)*u-p*p;let f,E;m!==0?f=(c*p-d*u)/m:f=0,E=(c+f*p)/u,n.x=f,n.y=E}}(),kn=function(){const a=new se,t=new U,e=new U;return function(i,s,n,r){qa(i,s,a);let o=a.x,h=a.y;if(o>=0&&o<=1&&h>=0&&h<=1){i.at(o,n),s.at(h,r);return}else if(o>=0&&o<=1){h<0?s.at(0,r):s.at(1,r),i.closestPointToPoint(r,!0,n);return}else if(h>=0&&h<=1){o<0?i.at(0,n):i.at(1,n),s.closestPointToPoint(n,!0,r);return}else{let l;o<0?l=i.start:l=i.end;let c;h<0?c=s.start:c=s.end;const p=t,u=e;if(i.closestPointToPoint(c,!0,t),s.closestPointToPoint(l,!0,e),p.distanceToSquared(c)<=u.distanceToSquared(l)){n.copy(p),r.copy(c);return}else{n.copy(l),r.copy(u);return}}}}(),Ja=function(){const a=new U,t=new U,e=new oi,i=new ee;return function(s,n){const{radius:r,center:o}=s,{a:h,b:l,c}=n;if(i.start=h,i.end=l,i.closestPointToPoint(o,!0,a).distanceTo(o)<=r||(i.start=h,i.end=c,i.closestPointToPoint(o,!0,a).distanceTo(o)<=r)||(i.start=l,i.end=c,i.closestPointToPoint(o,!0,a).distanceTo(o)<=r))return!0;const p=n.getPlane(e);if(Math.abs(p.distanceToPoint(o))<=r){const u=p.projectPoint(o,t);if(n.containsPoint(u))return!0}return!1}}(),th=1e-15;function Ms(a){return Math.abs(a)<th}class ne extends Je{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new U),this.satBounds=new Array(4).fill().map(()=>new Ee),this.points=[this.a,this.b,this.c],this.sphere=new Ts,this.plane=new oi,this.needsUpdate=!0}intersectsSphere(t){return Ja(t,this)}update(){const t=this.a,e=this.b,i=this.c,s=this.points,n=this.satAxes,r=this.satBounds,o=n[0],h=r[0];this.getNormal(o),h.setFromPoints(o,s);const l=n[1],c=r[1];l.subVectors(t,e),c.setFromPoints(l,s);const p=n[2],u=r[2];p.subVectors(e,i),u.setFromPoints(p,s);const d=n[3],m=r[3];d.subVectors(i,t),m.setFromPoints(d,s),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,t),this.needsUpdate=!1}}ne.prototype.closestPointToSegment=function(){const a=new U,t=new U,e=new ee;return function(i,s=null,n=null){const{start:r,end:o}=i,h=this.points;let l,c=1/0;for(let p=0;p<3;p++){const u=(p+1)%3;e.start.copy(h[p]),e.end.copy(h[u]),kn(e,i,a,t),l=a.distanceToSquared(t),l<c&&(c=l,s&&s.copy(a),n&&n.copy(t))}return this.closestPointToPoint(r,a),l=r.distanceToSquared(a),l<c&&(c=l,s&&s.copy(a),n&&n.copy(r)),this.closestPointToPoint(o,a),l=o.distanceToSquared(a),l<c&&(c=l,s&&s.copy(a),n&&n.copy(o)),Math.sqrt(c)}}();ne.prototype.intersectsTriangle=function(){const a=new ne,t=new Array(3),e=new Array(3),i=new Ee,s=new Ee,n=new U,r=new U,o=new U,h=new U,l=new U,c=new ee,p=new ee,u=new ee,d=new U;function m(f,E,I){const C=f.points;let R=0,T=-1;for(let y=0;y<3;y++){const{start:O,end:A}=c;O.copy(C[y]),A.copy(C[(y+1)%3]),c.delta(r);const N=Ms(E.distanceToPoint(O));if(Ms(E.normal.dot(r))&&N){I.copy(c),R=2;break}const b=E.intersectLine(c,d);if(!b&&N&&d.copy(O),(b||N)&&!Ms(d.distanceTo(A))){if(R<=1)(R===1?I.start:I.end).copy(d),N&&(T=R);else if(R>=2){(T===1?I.start:I.end).copy(d),R=2;break}if(R++,R===2&&T===-1)break}}return R}return function(f,E=null,I=!1){this.needsUpdate&&this.update(),f.isExtendedTriangle?f.needsUpdate&&f.update():(a.copy(f),a.update(),f=a);const C=this.plane,R=f.plane;if(Math.abs(C.normal.dot(R.normal))>1-1e-10){const T=this.satBounds,y=this.satAxes;e[0]=f.a,e[1]=f.b,e[2]=f.c;for(let N=0;N<4;N++){const b=T[N],P=y[N];if(i.setFromPoints(P,e),b.isSeparated(i))return!1}const O=f.satBounds,A=f.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let N=0;N<4;N++){const b=O[N],P=A[N];if(i.setFromPoints(P,t),b.isSeparated(i))return!1}for(let N=0;N<4;N++){const b=y[N];for(let P=0;P<4;P++){const z=A[P];if(n.crossVectors(b,z),i.setFromPoints(n,t),s.setFromPoints(n,e),i.isSeparated(s))return!1}}return E&&(I||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),E.start.set(0,0,0),E.end.set(0,0,0)),!0}else{const T=m(this,R,p);if(T===1&&f.containsPoint(p.end))return E&&(E.start.copy(p.end),E.end.copy(p.end)),!0;if(T!==2)return!1;const y=m(f,C,u);if(y===1&&this.containsPoint(u.end))return E&&(E.start.copy(u.end),E.end.copy(u.end)),!0;if(y!==2)return!1;if(p.delta(o),u.delta(h),o.dot(h)<0){let F=u.start;u.start=u.end,u.end=F}const O=p.start.dot(o),A=p.end.dot(o),N=u.start.dot(o),b=u.end.dot(o),P=A<N,z=O<b;return O!==b&&N!==A&&P===z?!1:(E&&(l.subVectors(p.start,u.start),l.dot(o)>0?E.start.copy(p.start):E.start.copy(u.start),l.subVectors(p.end,u.end),l.dot(o)<0?E.end.copy(p.end):E.end.copy(u.end)),!0)}}}();ne.prototype.distanceToPoint=function(){const a=new U;return function(t){return this.closestPointToPoint(t,a),t.distanceTo(a)}}();ne.prototype.distanceToTriangle=function(){const a=new U,t=new U,e=["a","b","c"],i=new ee,s=new ee;return function(n,r=null,o=null){const h=r||o?i:null;if(this.intersectsTriangle(n,h))return(r||o)&&(r&&h.getCenter(r),o&&h.getCenter(o)),0;let l=1/0;for(let c=0;c<3;c++){let p;const u=e[c],d=n[u];this.closestPointToPoint(d,a),p=d.distanceToSquared(a),p<l&&(l=p,r&&r.copy(a),o&&o.copy(d));const m=this[u];n.closestPointToPoint(m,a),p=m.distanceToSquared(a),p<l&&(l=p,r&&r.copy(m),o&&o.copy(a))}for(let c=0;c<3;c++){const p=e[c],u=e[(c+1)%3];i.set(this[p],this[u]);for(let d=0;d<3;d++){const m=e[d],f=e[(d+1)%3];s.set(n[m],n[f]),kn(i,s,a,t);const E=a.distanceToSquared(t);E<l&&(l=E,r&&r.copy(a),o&&o.copy(t))}}return Math.sqrt(l)}}();class zt{constructor(t,e,i){this.isOrientedBox=!0,this.min=new U,this.max=new U,this.matrix=new ut,this.invMatrix=new ut,this.points=new Array(8).fill().map(()=>new U),this.satAxes=new Array(3).fill().map(()=>new U),this.satBounds=new Array(3).fill().map(()=>new Ee),this.alignedSatBounds=new Array(3).fill().map(()=>new Ee),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),i&&this.matrix.copy(i)}set(t,e,i){this.min.copy(t),this.max.copy(e),this.matrix.copy(i),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}zt.prototype.update=function(){return function(){const a=this.matrix,t=this.min,e=this.max,i=this.points;for(let h=0;h<=1;h++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){const p=1*h|2*l|4*c,u=i[p];u.x=h?e.x:t.x,u.y=l?e.y:t.y,u.z=c?e.z:t.z,u.applyMatrix4(a)}const s=this.satBounds,n=this.satAxes,r=i[0];for(let h=0;h<3;h++){const l=n[h],c=s[h],p=1<<h,u=i[p];l.subVectors(r,u),c.setFromPoints(l,i)}const o=this.alignedSatBounds;o[0].setFromPointsField(i,"x"),o[1].setFromPointsField(i,"y"),o[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();zt.prototype.intersectsBox=function(){const a=new Ee;return function(t){this.needsUpdate&&this.update();const e=t.min,i=t.max,s=this.satBounds,n=this.satAxes,r=this.alignedSatBounds;if(a.min=e.x,a.max=i.x,r[0].isSeparated(a)||(a.min=e.y,a.max=i.y,r[1].isSeparated(a))||(a.min=e.z,a.max=i.z,r[2].isSeparated(a)))return!1;for(let o=0;o<3;o++){const h=n[o],l=s[o];if(a.setFromBox(h,t),l.isSeparated(a))return!1}return!0}}();zt.prototype.intersectsTriangle=function(){const a=new ne,t=new Array(3),e=new Ee,i=new Ee,s=new U;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(a.copy(n),a.update(),n=a);const r=this.satBounds,o=this.satAxes;t[0]=n.a,t[1]=n.b,t[2]=n.c;for(let p=0;p<3;p++){const u=r[p],d=o[p];if(e.setFromPoints(d,t),u.isSeparated(e))return!1}const h=n.satBounds,l=n.satAxes,c=this.points;for(let p=0;p<3;p++){const u=h[p],d=l[p];if(e.setFromPoints(d,c),u.isSeparated(e))return!1}for(let p=0;p<3;p++){const u=o[p];for(let d=0;d<4;d++){const m=l[d];if(s.crossVectors(u,m),e.setFromPoints(s,t),i.setFromPoints(s,c),e.isSeparated(i))return!1}}return!0}}();zt.prototype.closestPointToPoint=function(){return function(a,t){return this.needsUpdate&&this.update(),t.copy(a).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();zt.prototype.distanceToPoint=function(){const a=new U;return function(t){return this.closestPointToPoint(t,a),t.distanceTo(a)}}();zt.prototype.distanceToBox=function(){const a=["x","y","z"],t=new Array(12).fill().map(()=>new ee),e=new Array(12).fill().map(()=>new ee),i=new U,s=new U;return function(n,r=0,o=null,h=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(o||h)&&(n.getCenter(s),this.closestPointToPoint(s,i),n.closestPointToPoint(i,s),o&&o.copy(i),h&&h.copy(s)),0;const l=r*r,c=n.min,p=n.max,u=this.points;let d=1/0;for(let f=0;f<8;f++){const E=u[f];s.copy(E).clamp(c,p);const I=E.distanceToSquared(s);if(I<d&&(d=I,o&&o.copy(E),h&&h.copy(s),I<l))return Math.sqrt(I)}let m=0;for(let f=0;f<3;f++)for(let E=0;E<=1;E++)for(let I=0;I<=1;I++){const C=(f+1)%3,R=(f+2)%3,T=E<<C|I<<R,y=1<<f|E<<C|I<<R,O=u[T],A=u[y];t[m].set(O,A);const N=a[f],b=a[C],P=a[R],z=e[m],F=z.start,x=z.end;F[N]=c[N],F[b]=E?c[b]:p[b],F[P]=I?c[P]:p[b],x[N]=p[N],x[b]=E?c[b]:p[b],x[P]=I?c[P]:p[b],m++}for(let f=0;f<=1;f++)for(let E=0;E<=1;E++)for(let I=0;I<=1;I++){s.x=f?p.x:c.x,s.y=E?p.y:c.y,s.z=I?p.z:c.z,this.closestPointToPoint(s,i);const C=s.distanceToSquared(i);if(C<d&&(d=C,o&&o.copy(i),h&&h.copy(s),C<l))return Math.sqrt(C)}for(let f=0;f<12;f++){const E=t[f];for(let I=0;I<12;I++){const C=e[I];kn(E,C,i,s);const R=i.distanceToSquared(s);if(R<d&&(d=R,o&&o.copy(i),h&&h.copy(s),R<l))return Math.sqrt(R)}}return Math.sqrt(d)}}();class Yn{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class eh extends Yn{constructor(){super(()=>new ne)}}const jt=new eh;function Yt(a,t){return t[a+15]===65535}function Vt(a,t){return t[a+6]}function Xt(a,t){return t[a+14]}function Zt(a){return a+8}function $t(a,t){return t[a+6]}function uo(a,t){return t[a+7]}class ih{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=i=>{e&&t.push(e),e=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,t.length!==0&&this.setBuffer(t.pop())}}}const _t=new ih;let ye,ti;const Be=[],Hi=new Yn(()=>new Nt);function sh(a,t,e,i,s,n){ye=Hi.getPrimitive(),ti=Hi.getPrimitive(),Be.push(ye,ti),_t.setBuffer(a._roots[t]);const r=en(0,a.geometry,e,i,s,n);_t.clearBuffer(),Hi.releasePrimitive(ye),Hi.releasePrimitive(ti),Be.pop(),Be.pop();const o=Be.length;return o>0&&(ti=Be[o-1],ye=Be[o-2]),r}function en(a,t,e,i,s=null,n=0,r=0){const{float32Array:o,uint16Array:h,uint32Array:l}=_t;let c=a*2;if(Yt(c,h)){const p=Vt(a,l),u=Xt(c,h);return Rt(a,o,ye),i(p,u,!1,r,n+a,ye)}else{let p=function(z){const{uint16Array:F,uint32Array:x}=_t;let w=z*2;for(;!Yt(w,F);)z=Zt(z),w=z*2;return Vt(z,x)},u=function(z){const{uint16Array:F,uint32Array:x}=_t;let w=z*2;for(;!Yt(w,F);)z=$t(z,x),w=z*2;return Vt(z,x)+Xt(w,F)};const d=Zt(a),m=$t(a,l);let f=d,E=m,I,C,R,T;if(s&&(R=ye,T=ti,Rt(f,o,R),Rt(E,o,T),I=s(R),C=s(T),C<I)){f=m,E=d;const z=I;I=C,C=z,R=T}R||(R=ye,Rt(f,o,R));const y=Yt(f*2,h),O=e(R,y,I,r+1,n+f);let A;if(O===er){const z=p(f),F=u(f)-z;A=i(z,F,!0,r+1,n+f,R)}else A=O&&en(f,t,e,i,s,n,r+1);if(A)return!0;T=ti,Rt(E,o,T);const N=Yt(E*2,h),b=e(T,N,C,r+1,n+E);let P;if(b===er){const z=p(E),F=u(E)-z;P=i(z,F,!0,r+1,n+E,T)}else P=b&&en(E,t,e,i,s,n,r+1);return!!P}}const pi=new U,Ds=new U;function nh(a,t,e={},i=0,s=1/0){const n=i*i,r=s*s;let o=1/0,h=null;if(a.shapecast({boundsTraverseOrder:c=>(pi.copy(t).clamp(c.min,c.max),pi.distanceToSquared(t)),intersectsBounds:(c,p,u)=>u<o&&u<r,intersectsTriangle:(c,p)=>{c.closestPointToPoint(t,pi);const u=t.distanceToSquared(pi);return u<o&&(Ds.copy(pi),o=u,h=p),u<n}}),o===1/0)return null;const l=Math.sqrt(o);return e.point?e.point.copy(Ds):e.point=Ds.clone(),e.distance=l,e.faceIndex=h,e}const ze=new U,ke=new U,Ye=new U,Wi=new se,ji=new se,Xi=new se,or=new U,ar=new U,hr=new U,Zi=new U;function rh(a,t,e,i,s,n){let r;return n===Na?r=a.intersectTriangle(i,e,t,!0,s):r=a.intersectTriangle(t,e,i,n!==Li,s),r===null?null:{distance:a.origin.distanceTo(s),point:s.clone()}}function oh(a,t,e,i,s,n,r,o,h){ze.fromBufferAttribute(t,n),ke.fromBufferAttribute(t,r),Ye.fromBufferAttribute(t,o);const l=rh(a,ze,ke,Ye,Zi,h);if(l){i&&(Wi.fromBufferAttribute(i,n),ji.fromBufferAttribute(i,r),Xi.fromBufferAttribute(i,o),l.uv=Je.getInterpolation(Zi,ze,ke,Ye,Wi,ji,Xi,new se)),s&&(Wi.fromBufferAttribute(s,n),ji.fromBufferAttribute(s,r),Xi.fromBufferAttribute(s,o),l.uv1=Je.getInterpolation(Zi,ze,ke,Ye,Wi,ji,Xi,new se)),e&&(or.fromBufferAttribute(e,n),ar.fromBufferAttribute(e,r),hr.fromBufferAttribute(e,o),l.normal=Je.getInterpolation(Zi,ze,ke,Ye,or,ar,hr,new U),l.normal.dot(a.direction)>0&&l.normal.multiplyScalar(-1));const c={a:n,b:r,c:o,normal:new U,materialIndex:0};Je.getNormal(ze,ke,Ye,c.normal),l.face=c,l.faceIndex=n}return l}function Os(a,t,e,i,s){const n=i*3;let r=n+0,o=n+1,h=n+2;const l=a.index;a.index&&(r=l.getX(r),o=l.getX(o),h=l.getX(h));const{position:c,normal:p,uv:u,uv1:d}=a.attributes,m=oh(e,c,p,u,d,r,o,h,t);return m?(m.faceIndex=i,s&&s.push(m),m):null}function bt(a,t,e,i){const s=a.a,n=a.b,r=a.c;let o=t,h=t+1,l=t+2;e&&(o=e.getX(o),h=e.getX(h),l=e.getX(l)),s.x=i.getX(o),s.y=i.getY(o),s.z=i.getZ(o),n.x=i.getX(h),n.y=i.getY(h),n.z=i.getZ(h),r.x=i.getX(l),r.y=i.getY(l),r.z=i.getZ(l)}function ah(a,t,e,i,s,n){const{geometry:r,_indirectBuffer:o}=a;for(let h=i,l=i+s;h<l;h++)Os(r,t,e,h,n)}function hh(a,t,e,i,s){const{geometry:n,_indirectBuffer:r}=a;let o=1/0,h=null;for(let l=i,c=i+s;l<c;l++){let p;p=Os(n,t,e,l),p&&p.distance<o&&(h=p,o=p.distance)}return h}function lh(a,t,e,i,s,n,r){const{geometry:o}=e,{index:h}=o,l=o.attributes.position;for(let c=a,p=t+a;c<p;c++){let u;if(u=c,bt(r,u*3,h,l),r.needsUpdate=!0,i(r,u,s,n))return!0}return!1}function ch(a,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=a.geometry,i=e.index?e.index.array:null,s=e.attributes.position;let n,r,o,h,l=0;const c=a._roots;for(let u=0,d=c.length;u<d;u++)n=c[u],r=new Uint32Array(n),o=new Uint16Array(n),h=new Float32Array(n),p(0,l),l+=n.byteLength;function p(u,d,m=!1){const f=u*2;if(o[f+15]===As){const E=r[u+6],I=o[f+14];let C=1/0,R=1/0,T=1/0,y=-1/0,O=-1/0,A=-1/0;for(let N=3*E,b=3*(E+I);N<b;N++){let P=i[N];const z=s.getX(P),F=s.getY(P),x=s.getZ(P);z<C&&(C=z),z>y&&(y=z),F<R&&(R=F),F>O&&(O=F),x<T&&(T=x),x>A&&(A=x)}return h[u+0]!==C||h[u+1]!==R||h[u+2]!==T||h[u+3]!==y||h[u+4]!==O||h[u+5]!==A?(h[u+0]=C,h[u+1]=R,h[u+2]=T,h[u+3]=y,h[u+4]=O,h[u+5]=A,!0):!1}else{const E=u+8,I=r[u+6],C=E+d,R=I+d;let T=m,y=!1,O=!1;t?T||(y=t.has(C),O=t.has(R),T=!y&&!O):(y=!0,O=!0);const A=T||y,N=T||O;let b=!1;A&&(b=p(E,d,T));let P=!1;N&&(P=p(I,d,T));const z=b||P;if(z)for(let F=0;F<3;F++){const x=E+F,w=I+F,M=h[x],Z=h[x+3],V=h[w],J=h[w+3];h[u+F]=M<V?M:V,h[u+F+3]=Z>J?Z:J}return z}}}const lr=new Nt;function Se(a,t,e,i){return Rt(a,t,lr),e.intersectBox(lr,i)}function dh(a,t,e,i,s,n){const{geometry:r,_indirectBuffer:o}=a;for(let h=i,l=i+s;h<l;h++){let c=o?o[h]:h;Os(r,t,e,c,n)}}function uh(a,t,e,i,s){const{geometry:n,_indirectBuffer:r}=a;let o=1/0,h=null;for(let l=i,c=i+s;l<c;l++){let p;p=Os(n,t,e,r?r[l]:l),p&&p.distance<o&&(h=p,o=p.distance)}return h}function ph(a,t,e,i,s,n,r){const{geometry:o}=e,{index:h}=o,l=o.attributes.position;for(let c=a,p=t+a;c<p;c++){let u;if(u=e.resolveTriangleIndex(c),bt(r,u*3,h,l),r.needsUpdate=!0,i(r,u,s,n))return!0}return!1}const cr=new U;function fh(a,t,e,i,s){_t.setBuffer(a._roots[t]),sn(0,a,e,i,s),_t.clearBuffer()}function sn(a,t,e,i,s){const{float32Array:n,uint16Array:r,uint32Array:o}=_t,h=a*2;if(Yt(h,r)){const l=Vt(a,o),c=Xt(h,r);ah(t,e,i,l,c,s)}else{const l=Zt(a);Se(l,n,i,cr)&&sn(l,t,e,i,s);const c=$t(a,o);Se(c,n,i,cr)&&sn(c,t,e,i,s)}}const dr=new U,mh=["x","y","z"];function Eh(a,t,e,i){_t.setBuffer(a._roots[t]);const s=nn(0,a,e,i);return _t.clearBuffer(),s}function nn(a,t,e,i){const{float32Array:s,uint16Array:n,uint32Array:r}=_t;let o=a*2;if(Yt(o,n)){const h=Vt(a,r),l=Xt(o,n);return hh(t,e,i,h,l)}else{const h=uo(a,r),l=mh[h],c=i.direction[l]>=0;let p,u;c?(p=Zt(a),u=$t(a,r)):(p=$t(a,r),u=Zt(a));const d=Se(p,s,i,dr)?nn(p,t,e,i):null;if(d){const f=d.point[l];if(c?f<=s[u+h]:f>=s[u+h+3])return d}const m=Se(u,s,i,dr)?nn(u,t,e,i):null;return d&&m?d.distance<=m.distance?d:m:d||m||null}}const $i=new Nt,Ve=new ne,Ge=new ne,fi=new ut,ur=new zt,Qi=new zt;function Ih(a,t,e,i){_t.setBuffer(a._roots[t]);const s=rn(0,a,e,i);return _t.clearBuffer(),s}function rn(a,t,e,i,s=null){const{float32Array:n,uint16Array:r,uint32Array:o}=_t;let h=a*2;if(s===null&&(e.boundingBox||e.computeBoundingBox(),ur.set(e.boundingBox.min,e.boundingBox.max,i),s=ur),Yt(h,r)){const l=t.geometry,c=l.index,p=l.attributes.position,u=e.index,d=e.attributes.position,m=Vt(a,o),f=Xt(h,r);if(fi.copy(i).invert(),e.boundsTree)return Rt(a,n,Qi),Qi.matrix.copy(fi),Qi.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:E=>Qi.intersectsBox(E),intersectsTriangle:E=>{E.a.applyMatrix4(i),E.b.applyMatrix4(i),E.c.applyMatrix4(i),E.needsUpdate=!0;for(let I=m*3,C=(f+m)*3;I<C;I+=3)if(bt(Ge,I,c,p),Ge.needsUpdate=!0,E.intersectsTriangle(Ge))return!0;return!1}});for(let E=m*3,I=(f+m)*3;E<I;E+=3){bt(Ve,E,c,p),Ve.a.applyMatrix4(fi),Ve.b.applyMatrix4(fi),Ve.c.applyMatrix4(fi),Ve.needsUpdate=!0;for(let C=0,R=u.count;C<R;C+=3)if(bt(Ge,C,u,d),Ge.needsUpdate=!0,Ve.intersectsTriangle(Ge))return!0}}else{const l=a+8,c=o[a+6];return Rt(l,n,$i),!!(s.intersectsBox($i)&&rn(l,t,e,i,s)||(Rt(c,n,$i),s.intersectsBox($i)&&rn(c,t,e,i,s)))}}const Ki=new ut,Us=new zt,mi=new zt,gh=new U,Ch=new U,Th=new U,_h=new U;function wh(a,t,e,i={},s={},n=0,r=1/0){t.boundingBox||t.computeBoundingBox(),Us.set(t.boundingBox.min,t.boundingBox.max,e),Us.needsUpdate=!0;const o=a.geometry,h=o.attributes.position,l=o.index,c=t.attributes.position,p=t.index,u=jt.getPrimitive(),d=jt.getPrimitive();let m=gh,f=Ch,E=null,I=null;s&&(E=Th,I=_h);let C=1/0,R=null,T=null;return Ki.copy(e).invert(),mi.matrix.copy(Ki),a.shapecast({boundsTraverseOrder:y=>Us.distanceToBox(y),intersectsBounds:(y,O,A)=>A<C&&A<r?(O&&(mi.min.copy(y.min),mi.max.copy(y.max),mi.needsUpdate=!0),!0):!1,intersectsRange:(y,O)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:A=>mi.distanceToBox(A),intersectsBounds:(A,N,b)=>b<C&&b<r,intersectsRange:(A,N)=>{for(let b=A,P=A+N;b<P;b++){bt(d,3*b,p,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let z=y,F=y+O;z<F;z++){bt(u,3*z,l,h),u.needsUpdate=!0;const x=u.distanceToTriangle(d,m,E);if(x<C&&(f.copy(m),I&&I.copy(E),C=x,R=z,T=b),x<n)return!0}}}});{const A=ai(t);for(let N=0,b=A;N<b;N++){bt(d,3*N,p,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let P=y,z=y+O;P<z;P++){bt(u,3*P,l,h),u.needsUpdate=!0;const F=u.distanceToTriangle(d,m,E);if(F<C&&(f.copy(m),I&&I.copy(E),C=F,R=P,T=N),F<n)return!0}}}}}),jt.releasePrimitive(u),jt.releasePrimitive(d),C===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=C,i.faceIndex=R,s&&(s.point?s.point.copy(I):s.point=I.clone(),s.point.applyMatrix4(Ki),f.applyMatrix4(Ki),s.distance=f.sub(s.point).length(),s.faceIndex=T),i)}function yh(a,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=a.geometry,i=e.index?e.index.array:null,s=e.attributes.position;let n,r,o,h,l=0;const c=a._roots;for(let u=0,d=c.length;u<d;u++)n=c[u],r=new Uint32Array(n),o=new Uint16Array(n),h=new Float32Array(n),p(0,l),l+=n.byteLength;function p(u,d,m=!1){const f=u*2;if(o[f+15]===As){const E=r[u+6],I=o[f+14];let C=1/0,R=1/0,T=1/0,y=-1/0,O=-1/0,A=-1/0;for(let N=E,b=E+I;N<b;N++){const P=3*a.resolveTriangleIndex(N);for(let z=0;z<3;z++){let F=P+z;F=i?i[F]:F;const x=s.getX(F),w=s.getY(F),M=s.getZ(F);x<C&&(C=x),x>y&&(y=x),w<R&&(R=w),w>O&&(O=w),M<T&&(T=M),M>A&&(A=M)}}return h[u+0]!==C||h[u+1]!==R||h[u+2]!==T||h[u+3]!==y||h[u+4]!==O||h[u+5]!==A?(h[u+0]=C,h[u+1]=R,h[u+2]=T,h[u+3]=y,h[u+4]=O,h[u+5]=A,!0):!1}else{const E=u+8,I=r[u+6],C=E+d,R=I+d;let T=m,y=!1,O=!1;t?T||(y=t.has(C),O=t.has(R),T=!y&&!O):(y=!0,O=!0);const A=T||y,N=T||O;let b=!1;A&&(b=p(E,d,T));let P=!1;N&&(P=p(I,d,T));const z=b||P;if(z)for(let F=0;F<3;F++){const x=E+F,w=I+F,M=h[x],Z=h[x+3],V=h[w],J=h[w+3];h[u+F]=M<V?M:V,h[u+F+3]=Z>J?Z:J}return z}}}const pr=new U;function Rh(a,t,e,i,s){_t.setBuffer(a._roots[t]),on(0,a,e,i,s),_t.clearBuffer()}function on(a,t,e,i,s){const{float32Array:n,uint16Array:r,uint32Array:o}=_t,h=a*2;if(Yt(h,r)){const l=Vt(a,o),c=Xt(h,r);dh(t,e,i,l,c,s)}else{const l=Zt(a);Se(l,n,i,pr)&&on(l,t,e,i,s);const c=$t(a,o);Se(c,n,i,pr)&&on(c,t,e,i,s)}}const fr=new U,Fh=["x","y","z"];function Sh(a,t,e,i){_t.setBuffer(a._roots[t]);const s=an(0,a,e,i);return _t.clearBuffer(),s}function an(a,t,e,i){const{float32Array:s,uint16Array:n,uint32Array:r}=_t;let o=a*2;if(Yt(o,n)){const h=Vt(a,r),l=Xt(o,n);return uh(t,e,i,h,l)}else{const h=uo(a,r),l=Fh[h],c=i.direction[l]>=0;let p,u;c?(p=Zt(a),u=$t(a,r)):(p=$t(a,r),u=Zt(a));const d=Se(p,s,i,fr)?an(p,t,e,i):null;if(d){const f=d.point[l];if(c?f<=s[u+h]:f>=s[u+h+3])return d}const m=Se(u,s,i,fr)?an(u,t,e,i):null;return d&&m?d.distance<=m.distance?d:m:d||m||null}}const qi=new Nt,He=new ne,We=new ne,Ei=new ut,mr=new zt,Ji=new zt;function Ah(a,t,e,i){_t.setBuffer(a._roots[t]);const s=hn(0,a,e,i);return _t.clearBuffer(),s}function hn(a,t,e,i,s=null){const{float32Array:n,uint16Array:r,uint32Array:o}=_t;let h=a*2;if(s===null&&(e.boundingBox||e.computeBoundingBox(),mr.set(e.boundingBox.min,e.boundingBox.max,i),s=mr),Yt(h,r)){const l=t.geometry,c=l.index,p=l.attributes.position,u=e.index,d=e.attributes.position,m=Vt(a,o),f=Xt(h,r);if(Ei.copy(i).invert(),e.boundsTree)return Rt(a,n,Ji),Ji.matrix.copy(Ei),Ji.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:E=>Ji.intersectsBox(E),intersectsTriangle:E=>{E.a.applyMatrix4(i),E.b.applyMatrix4(i),E.c.applyMatrix4(i),E.needsUpdate=!0;for(let I=m,C=f+m;I<C;I++)if(bt(We,3*t.resolveTriangleIndex(I),c,p),We.needsUpdate=!0,E.intersectsTriangle(We))return!0;return!1}});for(let E=m,I=f+m;E<I;E++){const C=t.resolveTriangleIndex(E);bt(He,3*C,c,p),He.a.applyMatrix4(Ei),He.b.applyMatrix4(Ei),He.c.applyMatrix4(Ei),He.needsUpdate=!0;for(let R=0,T=u.count;R<T;R+=3)if(bt(We,R,u,d),We.needsUpdate=!0,He.intersectsTriangle(We))return!0}}else{const l=a+8,c=o[a+6];return Rt(l,n,qi),!!(s.intersectsBox(qi)&&hn(l,t,e,i,s)||(Rt(c,n,qi),s.intersectsBox(qi)&&hn(c,t,e,i,s)))}}const ts=new ut,Bs=new zt,Ii=new zt,Oh=new U,bh=new U,vh=new U,Nh=new U;function xh(a,t,e,i={},s={},n=0,r=1/0){t.boundingBox||t.computeBoundingBox(),Bs.set(t.boundingBox.min,t.boundingBox.max,e),Bs.needsUpdate=!0;const o=a.geometry,h=o.attributes.position,l=o.index,c=t.attributes.position,p=t.index,u=jt.getPrimitive(),d=jt.getPrimitive();let m=Oh,f=bh,E=null,I=null;s&&(E=vh,I=Nh);let C=1/0,R=null,T=null;return ts.copy(e).invert(),Ii.matrix.copy(ts),a.shapecast({boundsTraverseOrder:y=>Bs.distanceToBox(y),intersectsBounds:(y,O,A)=>A<C&&A<r?(O&&(Ii.min.copy(y.min),Ii.max.copy(y.max),Ii.needsUpdate=!0),!0):!1,intersectsRange:(y,O)=>{if(t.boundsTree){const A=t.boundsTree;return A.shapecast({boundsTraverseOrder:N=>Ii.distanceToBox(N),intersectsBounds:(N,b,P)=>P<C&&P<r,intersectsRange:(N,b)=>{for(let P=N,z=N+b;P<z;P++){const F=A.resolveTriangleIndex(P);bt(d,3*F,p,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let x=y,w=y+O;x<w;x++){const M=a.resolveTriangleIndex(x);bt(u,3*M,l,h),u.needsUpdate=!0;const Z=u.distanceToTriangle(d,m,E);if(Z<C&&(f.copy(m),I&&I.copy(E),C=Z,R=x,T=P),Z<n)return!0}}}})}else{const A=ai(t);for(let N=0,b=A;N<b;N++){bt(d,3*N,p,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let P=y,z=y+O;P<z;P++){const F=a.resolveTriangleIndex(P);bt(u,3*F,l,h),u.needsUpdate=!0;const x=u.distanceToTriangle(d,m,E);if(x<C&&(f.copy(m),I&&I.copy(E),C=x,R=P,T=N),x<n)return!0}}}}}),jt.releasePrimitive(u),jt.releasePrimitive(d),C===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=C,i.faceIndex=R,s&&(s.point?s.point.copy(I):s.point=I.clone(),s.point.applyMatrix4(ts),f.applyMatrix4(ts),s.distance=f.sub(s.point).length(),s.faceIndex=T),i)}function Ph(){return typeof SharedArrayBuffer<"u"}const vi=new _t.constructor,Cs=new _t.constructor,we=new Yn(()=>new Nt),je=new Nt,Xe=new Nt,zs=new Nt,ks=new Nt;let Ys=!1;function Lh(a,t,e,i){if(Ys)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Ys=!0;const s=a._roots,n=t._roots;let r,o=0,h=0;const l=new ut().copy(e).invert();for(let c=0,p=s.length;c<p;c++){vi.setBuffer(s[c]),h=0;const u=we.getPrimitive();Rt(0,vi.float32Array,u),u.applyMatrix4(l);for(let d=0,m=n.length;d<m&&(Cs.setBuffer(n[c]),r=Kt(0,0,e,l,i,o,h,0,0,u),Cs.clearBuffer(),h+=n[d].length,!r);d++);if(we.releasePrimitive(u),vi.clearBuffer(),o+=s[c].length,r)break}return Ys=!1,r}function Kt(a,t,e,i,s,n=0,r=0,o=0,h=0,l=null,c=!1){let p,u;c?(p=Cs,u=vi):(p=vi,u=Cs);const d=p.float32Array,m=p.uint32Array,f=p.uint16Array,E=u.float32Array,I=u.uint32Array,C=u.uint16Array,R=a*2,T=t*2,y=Yt(R,f),O=Yt(T,C);let A=!1;if(O&&y)c?A=s(Vt(t,I),Xt(t*2,C),Vt(a,m),Xt(a*2,f),h,r+t,o,n+a):A=s(Vt(a,m),Xt(a*2,f),Vt(t,I),Xt(t*2,C),o,n+a,h,r+t);else if(O){const N=we.getPrimitive();Rt(t,E,N),N.applyMatrix4(e);const b=Zt(a),P=$t(a,m);Rt(b,d,je),Rt(P,d,Xe);const z=N.intersectsBox(je),F=N.intersectsBox(Xe);A=z&&Kt(t,b,i,e,s,r,n,h,o+1,N,!c)||F&&Kt(t,P,i,e,s,r,n,h,o+1,N,!c),we.releasePrimitive(N)}else{const N=Zt(t),b=$t(t,I);Rt(N,E,zs),Rt(b,E,ks);const P=l.intersectsBox(zs),z=l.intersectsBox(ks);if(P&&z)A=Kt(a,N,e,i,s,n,r,o,h+1,l,c)||Kt(a,b,e,i,s,n,r,o,h+1,l,c);else if(P)if(y)A=Kt(a,N,e,i,s,n,r,o,h+1,l,c);else{const F=we.getPrimitive();F.copy(zs).applyMatrix4(e);const x=Zt(a),w=$t(a,m);Rt(x,d,je),Rt(w,d,Xe);const M=F.intersectsBox(je),Z=F.intersectsBox(Xe);A=M&&Kt(N,x,i,e,s,r,n,h,o+1,F,!c)||Z&&Kt(N,w,i,e,s,r,n,h,o+1,F,!c),we.releasePrimitive(F)}else if(z)if(y)A=Kt(a,b,e,i,s,n,r,o,h+1,l,c);else{const F=we.getPrimitive();F.copy(ks).applyMatrix4(e);const x=Zt(a),w=$t(a,m);Rt(x,d,je),Rt(w,d,Xe);const M=F.intersectsBox(je),Z=F.intersectsBox(Xe);A=M&&Kt(b,x,i,e,s,r,n,h,o+1,F,!c)||Z&&Kt(b,w,i,e,s,r,n,h,o+1,F,!c),we.releasePrimitive(F)}}return A}const es=new zt,Er=new Nt;class Vn{static serialize(t,e={}){e={cloneBuffers:!0,...e};const i=t.geometry,s=t._roots,n=t._indirectBuffer,r=i.getIndex();let o;return e.cloneBuffers?o={roots:s.map(h=>h.slice()),index:r.array.slice(),indirectBuffer:n?n.slice():null}:o={roots:s,index:r.array,indirectBuffer:n},o}static deserialize(t,e,i={}){i={setIndex:!0,indirect:!!t.indirectBuffer,...i};const{index:s,roots:n,indirectBuffer:r}=t,o=new Vn(e,{...i,[Ps]:!0});if(o._roots=n,o._indirectBuffer=r||null,i.setIndex){const h=e.getIndex();if(h===null){const l=new Fe(t.index,1,!1);e.setIndex(l)}else h.array!==s&&(h.array.set(s),h.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:ho,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[Ps]:!1},e),e.useSharedArrayBuffer&&!Ph())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[Ps]||(Ka(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Nt)));const{_indirectBuffer:i}=this;this.resolveTriangleIndex=e.indirect?s=>i[s]:s=>s}refit(t=null){return(this.indirect?yh:ch)(this,t)}traverse(t,e=0){const i=this._roots[e],s=new Uint32Array(i),n=new Uint16Array(i);r(0);function r(o,h=0){const l=o*2,c=n[l+15]===As;if(c){const p=s[o+6],u=n[l+14];t(h,c,new Float32Array(i,o*4,6),p,u)}else{const p=o+us/4,u=s[o+6],d=s[o+7];t(h,c,new Float32Array(i,o*4,6),d)||(r(p,h+1),r(u,h+1))}}}raycast(t,e=Jn){const i=this._roots,s=this.geometry,n=[],r=e.isMaterial,o=Array.isArray(e),h=s.groups,l=r?e.side:e,c=this.indirect?Rh:fh;for(let p=0,u=i.length;p<u;p++){const d=o?e[h[p].materialIndex].side:l,m=n.length;if(c(this,p,d,t,n),o){const f=h[p].materialIndex;for(let E=m,I=n.length;E<I;E++)n[E].face.materialIndex=f}}return n}raycastFirst(t,e=Jn){const i=this._roots,s=this.geometry,n=e.isMaterial,r=Array.isArray(e);let o=null;const h=s.groups,l=n?e.side:e,c=this.indirect?Sh:Eh;for(let p=0,u=i.length;p<u;p++){const d=r?e[h[p].materialIndex].side:l,m=c(this,p,d,t);m!=null&&(o==null||m.distance<o.distance)&&(o=m,r&&(m.face.materialIndex=h[p].materialIndex))}return o}intersectsGeometry(t,e){let i=!1;const s=this._roots,n=this.indirect?Ah:Ih;for(let r=0,o=s.length;r<o&&(i=n(this,r,t,e),!i);r++);return i}shapecast(t){const e=jt.getPrimitive(),i=this.indirect?ph:lh;let{boundsTraverseOrder:s,intersectsBounds:n,intersectsRange:r,intersectsTriangle:o}=t;if(r&&o){const p=r;r=(u,d,m,f,E)=>p(u,d,m,f,E)?!0:i(u,d,this,o,m,f,e)}else r||(o?r=(p,u,d,m)=>i(p,u,this,o,d,m,e):r=(p,u,d)=>d);let h=!1,l=0;const c=this._roots;for(let p=0,u=c.length;p<u;p++){const d=c[p];if(h=sh(this,p,n,r,s,l),h)break;l+=d.byteLength}return jt.releasePrimitive(e),h}bvhcast(t,e,i){let{intersectsRanges:s,intersectsTriangles:n}=i;const r=jt.getPrimitive(),o=this.geometry.index,h=this.geometry.attributes.position,l=this.indirect?m=>{const f=this.resolveTriangleIndex(m);bt(r,f*3,o,h)}:m=>{bt(r,m*3,o,h)},c=jt.getPrimitive(),p=t.geometry.index,u=t.geometry.attributes.position,d=t.indirect?m=>{const f=t.resolveTriangleIndex(m);bt(c,f*3,p,u)}:m=>{bt(c,m*3,p,u)};if(n){const m=(f,E,I,C,R,T,y,O)=>{for(let A=I,N=I+C;A<N;A++){d(A),c.a.applyMatrix4(e),c.b.applyMatrix4(e),c.c.applyMatrix4(e),c.needsUpdate=!0;for(let b=f,P=f+E;b<P;b++)if(l(b),r.needsUpdate=!0,n(r,c,b,A,R,T,y,O))return!0}return!1};if(s){const f=s;s=function(E,I,C,R,T,y,O,A){return f(E,I,C,R,T,y,O,A)?!0:m(E,I,C,R,T,y,O,A)}}else s=m}return Lh(this,t,e,s)}intersectsBox(t,e){return es.set(t.min,t.max,e),es.needsUpdate=!0,this.shapecast({intersectsBounds:i=>es.intersectsBox(i),intersectsTriangle:i=>es.intersectsTriangle(i)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,i={},s={},n=0,r=1/0){return(this.indirect?xh:wh)(this,t,e,i,s,n,r)}closestPointToPoint(t,e={},i=0,s=1/0){return nh(this,t,e,i,s)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{Rt(0,new Float32Array(e),Er),t.union(Er)}),t}}function Ir(a,t,e){return a===null||(a.point.applyMatrix4(t.matrixWorld),a.distance=a.point.distanceTo(e.ray.origin),a.object=t,a.distance<e.near||a.distance>e.far)?null:a}const Vs=new ba,gr=new ut,Mh=it.prototype.raycast;function Dh(a,t){if(this.geometry.boundsTree){if(this.material===void 0)return;gr.copy(this.matrixWorld).invert(),Vs.copy(a.ray).applyMatrix4(gr);const e=this.geometry.boundsTree;if(a.firstHitOnly===!0){const i=Ir(e.raycastFirst(Vs,this.material),this,a);i&&t.push(i)}else{const i=e.raycast(Vs,this.material);for(let s=0,n=i.length;s<n;s++){const r=Ir(i[s],this,a);r&&t.push(r)}}}else Mh.call(this,a,t)}function Uh(a){return this.boundsTree=new Vn(this,a),this.boundsTree}function Bh(){this.boundsTree=null}class ${constructor(){g(this,"trigger",t=>{const e=this.handlers.slice(0);for(const i of e)i(t)}),g(this,"handlers",[])}add(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter(e=>e!==t)}reset(){this.handlers.length=0}}class ps{constructor(){g(this,"trigger",async t=>{const e=this.handlers.slice(0);for(const i of e)await i(t)}),g(this,"handlers",[])}add(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter(e=>e!==t)}reset(){this.handlers.length=0}}class Gn{constructor(t){g(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),g(this,"isResizeable",()=>"resize"in this&&"getSize"in this),g(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),g(this,"isHideable",()=>"visible"in this),g(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=t}}class St extends Gn{}class Hn extends Gn{constructor(t){super(t),g(this,"worlds",new Map),g(this,"onWorldChanged",new $),g(this,"currentWorld",null),this.onWorldChanged.add(({world:e,action:i})=>{i==="removed"&&this.worlds.delete(e.uuid)})}}class zh extends Hn{constructor(){super(...arguments),g(this,"hasCameraControls",()=>"controls"in this)}}class kh extends Hn{constructor(){super(...arguments),g(this,"onAfterUpdate",new $),g(this,"onBeforeUpdate",new $),g(this,"onDisposed",new $),g(this,"onResize",new $),g(this,"onClippingPlanesUpdated",new $),g(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(t,e,i){e.isLocal=i;const s=this.clippingPlanes.indexOf(e);t&&s===-1?this.clippingPlanes.push(e):!t&&s>-1&&this.clippingPlanes.splice(s,1),this.three.clippingPlanes=this.clippingPlanes.filter(n=>!n.isLocal)}}const po=class ln extends St{constructor(t){super(t),g(this,"_disposedComponents",new Set),g(this,"enabled",!0),t.add(ln.uuid,this)}get(){return this._disposedComponents}destroy(t,e=!0,i=!0){t.removeFromParent();const s=t;s.dispose&&s.dispose(),this.disposeGeometryAndMaterials(t,e),i&&s.children&&s.children.length&&this.disposeChildren(s),t.children.length=0}disposeGeometry(t){t.boundsTree&&t.disposeBoundsTree&&t.disposeBoundsTree(),t.dispose()}disposeGeometryAndMaterials(t,e){const i=t;i.geometry&&this.disposeGeometry(i.geometry),e&&i.material&&ln.disposeMaterial(i),i.material=[],i.geometry=null}disposeChildren(t){for(const e of t.children)this.destroy(e)}static disposeMaterial(t){if(t.material)if(Array.isArray(t.material))for(const e of t.material)e.dispose();else t.material.dispose()}};g(po,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let ri=po;class Yh extends Hn{constructor(t){super(t),g(this,"onDisposed",new $),g(this,"directionalLights",new Map),g(this,"ambientLights",new Map)}dispose(){const t=this.components.get(ri);for(const e of this.three.children){const i=e;i.geometry&&t.destroy(i)}for(const[,e]of this.directionalLights)e.removeFromParent(),e.target.removeFromParent(),e.dispose();for(const[,e]of this.ambientLights)e.removeFromParent(),e.dispose();this.three.children=[],this.onDisposed.trigger(),this.onDisposed.reset()}}class ei extends Set{constructor(t){super(t),g(this,"onItemAdded",new $),g(this,"onItemDeleted",new $),g(this,"onCleared",new $),g(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}add(...t){for(const e of t)this.has(e)||!this.guard(e)||(super.add(e),this.onItemAdded||(this.onItemAdded=new $),this.onItemAdded.trigger(e));return this}delete(t){const e=super.delete(t);return e&&this.onItemDeleted.trigger(),e}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}class Ae extends Map{constructor(t){super(t),g(this,"onItemSet",new $),g(this,"onItemUpdated",new $),g(this,"onItemDeleted",new $),g(this,"onCleared",new $),g(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}set(t,e){const i=this.has(t);if(!(this.guard??(()=>!0))(t,e))return this;const s=super.set(t,e);return i?(this.onItemUpdated||(this.onItemUpdated=new $),this.onItemUpdated.trigger({key:t,value:e})):(this.onItemSet||(this.onItemSet=new $),this.onItemSet.trigger({key:t,value:e})),s}delete(t){const e=super.delete(t);return e&&this.onItemDeleted.trigger(t),e}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}const fs=0,Vh=1,Gh=new U,Cr=new ee,Gs=new oi,Tr=new U,is=new Je;class Hh{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new _r,this.unassigned=new _r,this.vertices=[]}setFromPoints(t){if(t.length>=4){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.vertices.push(new Wh(t[e]));this.compute()}return this}setFromObject(t){const e=[];return t.updateMatrixWorld(!0),t.traverse(function(i){const s=i.geometry;if(s!==void 0){const n=s.attributes.position;if(n!==void 0)for(let r=0,o=n.count;r<o;r++){const h=new U;h.fromBufferAttribute(n,r).applyMatrix4(i.matrixWorld),e.push(h)}}}),this.setFromPoints(e)}containsPoint(t){const e=this.faces;for(let i=0,s=e.length;i<s;i++)if(e[i].distanceToPoint(t)>this.tolerance)return!1;return!0}intersectRay(t,e){const i=this.faces;let s=-1/0,n=1/0;for(let r=0,o=i.length;r<o;r++){const h=i[r],l=h.distanceToPoint(t.origin),c=h.normal.dot(t.direction);if(l>0&&c>=0)return null;const p=c!==0?-l/c:0;if(!(p<=0)&&(c>0?n=Math.min(p,n):s=Math.max(p,s),s>n))return null}return s!==-1/0?t.at(s,e):t.at(n,e),e}intersectsRay(t){return this.intersectRay(t,Gh)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(t,e){return t.face=e,e.outside===null?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this}removeVertexFromFace(t,e){return t===e.outside&&(t.next!==null&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this}removeAllVerticesFromFace(t){if(t.outside!==null){const e=t.outside;let i=t.outside;for(;i.next!==null&&i.next.face===t;)i=i.next;return this.assigned.removeSubList(e,i),e.prev=i.next=null,t.outside=null,e}}deleteFaceVertices(t,e){const i=this.removeAllVerticesFromFace(t);if(i!==void 0)if(e===void 0)this.unassigned.appendChain(i);else{let s=i;do{const n=s.next;e.distanceToPoint(s.point)>this.tolerance?this.addVertexToFace(s,e):this.unassigned.append(s),s=n}while(s!==null)}return this}resolveUnassignedPoints(t){if(this.unassigned.isEmpty()===!1){let e=this.unassigned.first();do{const i=e.next;let s=this.tolerance,n=null;for(let r=0;r<t.length;r++){const o=t[r];if(o.mark===fs){const h=o.distanceToPoint(e.point);if(h>s&&(s=h,n=o),s>1e3*this.tolerance)break}}n!==null&&this.addVertexToFace(e,n),e=i}while(e!==null)}return this}computeExtremes(){const t=new U,e=new U,i=[],s=[];for(let n=0;n<3;n++)i[n]=s[n]=this.vertices[0];t.copy(this.vertices[0].point),e.copy(this.vertices[0].point);for(let n=0,r=this.vertices.length;n<r;n++){const o=this.vertices[n],h=o.point;for(let l=0;l<3;l++)h.getComponent(l)<t.getComponent(l)&&(t.setComponent(l,h.getComponent(l)),i[l]=o);for(let l=0;l<3;l++)h.getComponent(l)>e.getComponent(l)&&(e.setComponent(l,h.getComponent(l)),s[l]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t.x),Math.abs(e.x))+Math.max(Math.abs(t.y),Math.abs(e.y))+Math.max(Math.abs(t.z),Math.abs(e.z))),{min:i,max:s}}computeInitialHull(){const t=this.vertices,e=this.computeExtremes(),i=e.min,s=e.max;let n=0,r=0;for(let u=0;u<3;u++){const d=s[u].point.getComponent(u)-i[u].point.getComponent(u);d>n&&(n=d,r=u)}const o=i[r],h=s[r];let l,c;n=0,Cr.set(o.point,h.point);for(let u=0,d=this.vertices.length;u<d;u++){const m=t[u];if(m!==o&&m!==h){Cr.closestPointToPoint(m.point,!0,Tr);const f=Tr.distanceToSquared(m.point);f>n&&(n=f,l=m)}}n=-1,Gs.setFromCoplanarPoints(o.point,h.point,l.point);for(let u=0,d=this.vertices.length;u<d;u++){const m=t[u];if(m!==o&&m!==h&&m!==l){const f=Math.abs(Gs.distanceToPoint(m.point));f>n&&(n=f,c=m)}}const p=[];if(Gs.distanceToPoint(c.point)<0){p.push(Jt.create(o,h,l),Jt.create(c,h,o),Jt.create(c,l,h),Jt.create(c,o,l));for(let u=0;u<3;u++){const d=(u+1)%3;p[u+1].getEdge(2).setTwin(p[0].getEdge(d)),p[u+1].getEdge(1).setTwin(p[d+1].getEdge(0))}}else{p.push(Jt.create(o,l,h),Jt.create(c,o,h),Jt.create(c,h,l),Jt.create(c,l,o));for(let u=0;u<3;u++){const d=(u+1)%3;p[u+1].getEdge(2).setTwin(p[0].getEdge((3-u)%3)),p[u+1].getEdge(0).setTwin(p[d+1].getEdge(1))}}for(let u=0;u<4;u++)this.faces.push(p[u]);for(let u=0,d=t.length;u<d;u++){const m=t[u];if(m!==o&&m!==h&&m!==l&&m!==c){n=this.tolerance;let f=null;for(let E=0;E<4;E++){const I=this.faces[E].distanceToPoint(m.point);I>n&&(n=I,f=this.faces[E])}f!==null&&this.addVertexToFace(m,f)}}return this}reindexFaces(){const t=[];for(let e=0;e<this.faces.length;e++){const i=this.faces[e];i.mark===fs&&t.push(i)}return this.faces=t,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let t,e=0;const i=this.assigned.first().face;let s=i.outside;do{const n=i.distanceToPoint(s.point);n>e&&(e=n,t=s),s=s.next}while(s!==null&&s.face===i);return t}}computeHorizon(t,e,i,s){this.deleteFaceVertices(i),i.mark=Vh;let n;e===null?n=e=i.getEdge(0):n=e.next;do{const r=n.twin,o=r.face;o.mark===fs&&(o.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,r,o,s):s.push(n)),n=n.next}while(n!==e);return this}addAdjoiningFace(t,e){const i=Jt.create(t,e.tail(),e.head());return this.faces.push(i),i.getEdge(-1).setTwin(e.twin),i.getEdge(0)}addNewFaces(t,e){this.newFaces=[];let i=null,s=null;for(let n=0;n<e.length;n++){const r=e[n],o=this.addAdjoiningFace(t,r);i===null?i=o:o.next.setTwin(s),this.newFaces.push(o.face),s=o}return i.next.setTwin(s),this}addVertexToHull(t){const e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let t;for(this.computeInitialHull();(t=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}class Jt{constructor(){this.normal=new U,this.midpoint=new U,this.area=0,this.constant=0,this.outside=null,this.mark=fs,this.edge=null}static create(t,e,i){const s=new Jt,n=new Hs(t,s),r=new Hs(e,s),o=new Hs(i,s);return n.next=o.prev=r,r.next=n.prev=o,o.next=r.prev=n,s.edge=n,s.compute()}getEdge(t){let e=this.edge;for(;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e}compute(){const t=this.edge.tail(),e=this.edge.head(),i=this.edge.next.head();return is.set(t.point,e.point,i.point),is.getNormal(this.normal),is.getMidpoint(this.midpoint),this.area=is.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(t){return this.normal.dot(t)-this.constant}}class Hs{constructor(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const t=this.head(),e=this.tail();return e!==null?e.point.distanceTo(t.point):-1}lengthSquared(){const t=this.head(),e=this.tail();return e!==null?e.point.distanceToSquared(t.point):-1}setTwin(t){return this.twin=t,t.twin=this,this}}class Wh{constructor(t){this.point=t,this.prev=null,this.next=null,this.face=null}}class _r{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(t,e){return e.prev=t.prev,e.next=t,e.prev===null?this.head=e:e.prev.next=e,t.prev=e,this}insertAfter(t,e){return e.prev=t,e.next=t.next,e.next===null?this.tail=e:e.next.prev=e,t.next=e,this}append(t){return this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this}appendChain(t){for(this.head===null?this.head=t:this.tail.next=t,t.prev=this.tail;t.next!==null;)t=t.next;return this.tail=t,this}remove(t){return t.prev===null?this.head=t.next:t.prev.next=t.next,t.next===null?this.tail=t.prev:t.next.prev=t.prev,this}removeSubList(t,e){return t.prev===null?this.head=e.next:t.prev.next=e.next,e.next===null?this.tail=t.prev:e.next.prev=t.prev,this}isEmpty(){return this.head===null}}const cn=[2,2,1],dn=[1,0,0];function ce(a,t){return a*3+t}function jh(a){const t=a.elements;let e=0;for(let i=0;i<9;i++)e+=t[i]*t[i];return Math.sqrt(e)}function Xh(a){const t=a.elements;let e=0;for(let i=0;i<3;i++){const s=t[ce(cn[i],dn[i])];e+=2*s*s}return Math.sqrt(e)}function Zh(a,t){let e=0,i=1;const s=a.elements;for(let l=0;l<3;l++){const c=Math.abs(s[ce(cn[l],dn[l])]);c>e&&(e=c,i=l)}let n=1,r=0;const o=dn[i],h=cn[i];if(Math.abs(s[ce(h,o)])>Number.EPSILON){const l=s[ce(h,h)],c=s[ce(o,o)],p=s[ce(h,o)],u=(l-c)/2/p;let d;u<0?d=-1/(-u+Math.sqrt(1+u*u)):d=1/(u+Math.sqrt(1+u*u)),n=1/Math.sqrt(1+d*d),r=d*n}return t.identity(),t.elements[ce(o,o)]=n,t.elements[ce(h,h)]=n,t.elements[ce(h,o)]=r,t.elements[ce(o,h)]=-r,t}function $h(a,t){let e=0,i=0;const s=10;t.unitary.identity(),t.diagonal.copy(a);const n=t.unitary,r=t.diagonal,o=new Pe,h=new Pe,l=Number.EPSILON*jh(r);for(;i<s&&Xh(r)>l;)Zh(r,o),h.copy(o).transpose(),r.multiply(o),r.premultiply(h),n.multiply(o),++e>2&&(i++,e=0);return t}function Qh(a){const t=[];for(let rt=0;rt<a.length-2;rt+=3){const dt=a[rt],ct=a[rt+1],Et=a[rt+2];t.push(new U(dt,ct,Et))}const e=new Hh;e.setFromPoints(t);const i={unitary:new Pe,diagonal:new Pe},s=e.faces,n=[],r=[];for(let rt=0,dt=s.length;rt<dt;rt++){const ct=s[rt];let Et=ct.edge;n.length=0;do n.push(Et),Et=Et.next;while(Et!==ct.edge);const Gt=n.length-2;for(let xt=1,_=Gt;xt<=_;xt++){const H=n[0].vertex,Y=n[xt+0].vertex,v=n[xt+1].vertex;r.push(H.point.x,H.point.y,H.point.z),r.push(Y.point.x,Y.point.y,Y.point.z),r.push(v.point.x,v.point.y,v.point.z)}}const o=new U,h=new U,l=new U,c=new U,p=new U,u=new U,d=new U,m=new U;let f=0,E=0,I=0,C=0,R=0,T=0,y=0;for(let rt=0,dt=r.length;rt<dt;rt+=9){o.fromArray(r,rt),h.fromArray(r,rt+3),l.fromArray(r,rt+6),d.set(0,0,0),d.add(o).add(h).add(l).divideScalar(3),c.subVectors(h,o),p.subVectors(l,o);const ct=u.crossVectors(c,p).length()/2;m.add(u.copy(d).multiplyScalar(ct)),f+=ct,E+=(9*d.x*d.x+o.x*o.x+h.x*h.x+l.x*l.x)*(ct/12),I+=(9*d.x*d.y+o.x*o.y+h.x*h.y+l.x*l.y)*(ct/12),C+=(9*d.x*d.z+o.x*o.z+h.x*h.z+l.x*l.z)*(ct/12),R+=(9*d.y*d.y+o.y*o.y+h.y*h.y+l.y*l.y)*(ct/12),T+=(9*d.y*d.z+o.y*o.z+h.y*h.z+l.y*l.z)*(ct/12),y+=(9*d.z*d.z+o.z*o.z+h.z*h.z+l.z*l.z)*(ct/12)}m.divideScalar(f),E/=f,I/=f,C/=f,R/=f,T/=f,y/=f,E-=m.x*m.x,I-=m.x*m.y,C-=m.x*m.z,R-=m.y*m.y,T-=m.y*m.z,y-=m.z*m.z;const O=new Pe;O.elements[0]=E,O.elements[1]=I,O.elements[2]=C,O.elements[3]=I,O.elements[4]=R,O.elements[5]=T,O.elements[6]=C,O.elements[7]=T,O.elements[8]=y,$h(O,i);const A=i.unitary,N=new U,b=new U,P=new U;A.extractBasis(N,b,P);let z=-1/0,F=-1/0,x=-1/0,w=1/0,M=1/0,Z=1/0;for(let rt=0,dt=t.length;rt<dt;rt++){const ct=t[rt];z=Math.max(N.dot(ct),z),F=Math.max(b.dot(ct),F),x=Math.max(P.dot(ct),x),w=Math.min(N.dot(ct),w),M=Math.min(b.dot(ct),M),Z=Math.min(P.dot(ct),Z)}N.multiplyScalar(.5*(w+z)),b.multiplyScalar(.5*(M+F)),P.multiplyScalar(.5*(Z+x));const V=new U,J=new U,j=new Pe;V.add(N).add(b).add(P),J.x=z-w,J.y=F-M,J.z=x-Z,J.multiplyScalar(.5),j.copy(A);const{x:nt,y:k,z:B}=J,st=new ut;st.makeScale(nt*2,k*2,B*2);const tt=new ut;tt.makeTranslation(-nt,-k,-B);const q=new ut;q.makeTranslation(V.x,V.y,V.z);const wt=new ut;wt.setFromMatrix3(j);const Ft=new ut;return Ft.multiply(q),Ft.multiply(wt),Ft.multiply(tt),Ft.multiply(st),{center:V,halfSizes:J,rotation:j,transformation:Ft}}function Kh(a,t,e){const i=[a[0]-t[0],a[1]-t[1],a[2]-t[2]];return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]>0}class wr{static isTransparent(t){return t.transparent&&t.opacity<1}}const un=class vt{static create(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return`${vt._lut[t&255]+vt._lut[t>>8&255]+vt._lut[t>>16&255]+vt._lut[t>>24&255]}-${vt._lut[e&255]}${vt._lut[e>>8&255]}-${vt._lut[e>>16&15|64]}${vt._lut[e>>24&255]}-${vt._lut[i&63|128]}${vt._lut[i>>8&255]}-${vt._lut[i>>16&255]}${vt._lut[i>>24&255]}${vt._lut[s&255]}${vt._lut[s>>8&255]}${vt._lut[s>>16&255]}${vt._lut[s>>24&255]}`.toLowerCase()}static validate(t){if(!vt._pattern.test(t))throw new Error(`${t} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};g(un,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),g(un,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let Ue=un;const fo=class mo{constructor(){g(this,"onDisposed",new $),g(this,"list",new Map),g(this,"enabled",!1),g(this,"_clock"),g(this,"update",()=>{if(!this.enabled)return;const t=this._clock.getDelta();for(const[e,i]of this.list)i.enabled&&i.isUpdateable()&&i.update(t);requestAnimationFrame(this.update)}),this._clock=new Ta,mo.setupBVH()}add(t,e){if(this.list.has(t))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");Ue.validate(t),this.list.set(t,e)}get(t){const e=t.uuid;if(!this.list.has(e)){const i=new t(this);return this.list.has(e)||this.add(e,i),i}return this.list.get(e)}init(){this.enabled=!0,this._clock.start(),this.update()}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.enabled=!1,e.isDisposeable()&&e.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){si.prototype.computeBoundsTree=Uh,si.prototype.disposeBoundsTree=Bh,it.prototype.raycast=Dh}};g(fo,"release","2.2.9");let Eo=fo;class qh extends Gn{constructor(){super(...arguments),g(this,"meshes",new Set),g(this,"onAfterUpdate",new $),g(this,"onBeforeUpdate",new $),g(this,"onDisposed",new $),g(this,"isDisposing",!1),g(this,"enabled",!0),g(this,"uuid",Ue.create()),g(this,"name"),g(this,"_scene"),g(this,"_camera"),g(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(t){this._scene=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(t){this._camera=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(t){this._renderer=t,t&&(t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"}))}update(t){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(t),this.camera.isUpdateable()&&this.camera.update(t),this.renderer&&this.renderer.update(t),this.onAfterUpdate.trigger()))}dispose(t=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),t){const e=this.components.get(ri);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const i of this.meshes)e.destroy(i);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.onDisposed.trigger()}}class Jh extends Yh{constructor(t){super(t),g(this,"isSetup",!1),g(this,"three"),g(this,"onSetup",new $),g(this,"config",{directionalLight:{color:new ie("white"),intensity:1.5,position:new U(5,10,3)},ambientLight:{color:new ie("white"),intensity:1}}),this.three=new _s,this.three.background=new ie(2107698)}setup(t){this.config={...this.config,...t};const e=new jr(this.config.directionalLight.color,this.config.directionalLight.intensity);e.position.copy(this.config.directionalLight.position);const i=new Ea(this.config.ambientLight.color,this.config.ambientLight.intensity);this.three.add(e,i),this.directionalLights.set(e.uuid,e),this.ambientLights.set(i.uuid,i),this.isSetup=!0,this.onSetup.trigger(this)}}class cd extends kh{constructor(t,e,i){super(t),g(this,"enabled",!0),g(this,"container"),g(this,"three"),g(this,"_canvas"),g(this,"_parameters"),g(this,"_resizeObserver",null),g(this,"onContainerUpdated",new $),g(this,"_resizing",!1),g(this,"resize",r=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const o=r?r.x:this.container.clientWidth,h=r?r.y:this.container.clientHeight;this.three.setSize(o,h),this.onResize.trigger(new se(o,h)),this._resizing=!1}),g(this,"resizeEvent",()=>{this.resize()}),g(this,"onContextLost",r=>{r.preventDefault(),this.enabled=!1}),g(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new Ni({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=e,this._parameters=i,this.three=new Ni({antialias:!0,alpha:!0,...i}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const s=this.three.getContext(),{canvas:n}=s;n.addEventListener("webglcontextlost",this.onContextLost,!1),n.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const t=this.currentWorld.scene.three,e=this.currentWorld.camera.three;this.three.render(t,e),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new se(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(t){const e=this.three.domElement.parentElement;if(!e)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),t&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(e),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const ht={LEFT:1,RIGHT:2,MIDDLE:4},G=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Ze={NONE:0,IN:1,OUT:-1};function be(a){return a.isPerspectiveCamera}function Te(a){return a.isOrthographicCamera}const $e=Math.PI*2,yr=Math.PI/2,Io=1e-5,gi=Math.PI/180;function qt(a,t,e){return Math.max(t,Math.min(e,a))}function Ct(a,t=Io){return Math.abs(a)<t}function mt(a,t,e=Io){return Ct(a-t,e)}function Rr(a,t){return Math.round(a/t)*t}function Ci(a){return isFinite(a)?a:a<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Ti(a){return Math.abs(a)<Number.MAX_VALUE?a:a*(1/0)}function ss(a,t,e,i,s=1/0,n){i=Math.max(1e-4,i);const r=2/i,o=r*n,h=1/(1+o+.48*o*o+.235*o*o*o);let l=a-t;const c=t,p=s*i;l=qt(l,-p,p),t=a-l;const u=(e.value+r*l)*n;e.value=(e.value-r*u)*h;let d=t+(l+u)*h;return c-a>0==d>c&&(d=c,e.value=(d-c)/n),d}function Fr(a,t,e,i,s=1/0,n,r){i=Math.max(1e-4,i);const o=2/i,h=o*n,l=1/(1+h+.48*h*h+.235*h*h*h);let c=t.x,p=t.y,u=t.z,d=a.x-c,m=a.y-p,f=a.z-u;const E=c,I=p,C=u,R=s*i,T=R*R,y=d*d+m*m+f*f;if(y>T){const M=Math.sqrt(y);d=d/M*R,m=m/M*R,f=f/M*R}c=a.x-d,p=a.y-m,u=a.z-f;const O=(e.x+o*d)*n,A=(e.y+o*m)*n,N=(e.z+o*f)*n;e.x=(e.x-o*O)*l,e.y=(e.y-o*A)*l,e.z=(e.z-o*N)*l,r.x=c+(d+O)*l,r.y=p+(m+A)*l,r.z=u+(f+N)*l;const b=E-a.x,P=I-a.y,z=C-a.z,F=r.x-E,x=r.y-I,w=r.z-C;return b*F+P*x+z*w>0&&(r.x=E,r.y=I,r.z=C,e.x=(r.x-E)/n,e.y=(r.y-I)/n,e.z=(r.z-C)/n),r}function Ws(a,t){t.set(0,0),a.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=a.length,t.y/=a.length}function js(a,t){return Te(a)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}class tl{constructor(){this._listeners={}}addEventListener(t,e){const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){const i=this._listeners[t];if(i!==void 0){const s=i.indexOf(e);s!==-1&&i.splice(s,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const e=this._listeners[t.type];if(e!==void 0){t.target=this;const i=e.slice(0);for(let s=0,n=i.length;s<n;s++)i[s].call(this,t)}}}const el="2.7.3",ns=1/8,go=typeof window<"u",il=go&&/Mac/.test(navigator.platform),sl=!(go&&"PointerEvent"in window);let at,Sr,rs,Xs,kt,lt,ft,Qe,_i,ae,he,ve,Ar,Or,Wt,wi,Ke,br,Zs,vr,$s,Qs,os;class Mt extends tl{static install(t){at=t.THREE,Sr=Object.freeze(new at.Vector3(0,0,0)),rs=Object.freeze(new at.Vector3(0,1,0)),Xs=Object.freeze(new at.Vector3(0,0,1)),kt=new at.Vector2,lt=new at.Vector3,ft=new at.Vector3,Qe=new at.Vector3,_i=new at.Vector3,ae=new at.Vector3,he=new at.Vector3,ve=new at.Vector3,Ar=new at.Vector3,Or=new at.Vector3,Wt=new at.Spherical,wi=new at.Spherical,Ke=new at.Box3,br=new at.Box3,Zs=new at.Sphere,vr=new at.Quaternion,$s=new at.Quaternion,Qs=new at.Matrix4,os=new at.Raycaster}static get ACTION(){return G}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=G.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Ze.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new at.Vector3,this._focalOffsetVelocity=new at.Vector3,this._zoomVelocity={value:0},this._truckInternal=(T,y,O)=>{let A,N;if(be(this._camera)){const b=lt.copy(this._camera.position).sub(this._target),P=this._camera.getEffectiveFOV()*gi,z=b.length()*Math.tan(P*.5);A=this.truckSpeed*T*z/this._elementRect.height,N=this.truckSpeed*y*z/this._elementRect.height}else if(Te(this._camera)){const b=this._camera;A=T*(b.right-b.left)/b.zoom/this._elementRect.width,N=y*(b.top-b.bottom)/b.zoom/this._elementRect.height}else return;this.verticalDragToForward?(O?this.setFocalOffset(this._focalOffsetEnd.x+A,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(A,0,!0),this.forward(-N,!0)):O?this.setFocalOffset(this._focalOffsetEnd.x+A,this._focalOffsetEnd.y+N,this._focalOffsetEnd.z,!0):this.truck(A,N,!0)},this._rotateInternal=(T,y)=>{const O=$e*this.azimuthRotateSpeed*T/this._elementRect.height,A=$e*this.polarRotateSpeed*y/this._elementRect.height;this.rotate(O,A,!0)},this._dollyInternal=(T,y,O)=>{const A=Math.pow(.95,-T*this.dollySpeed),N=this._sphericalEnd.radius,b=this._sphericalEnd.radius*A,P=qt(b,this.minDistance,this.maxDistance),z=P-b;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(b,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(z,!0),this._dollyToNoClamp(P,!0)):this._dollyToNoClamp(P,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?b:P)-N,this._dollyControlCoord.set(y,O)),this._lastDollyDirection=Math.sign(-T)},this._zoomInternal=(T,y,O)=>{const A=Math.pow(.95,T*this.dollySpeed),N=this._zoom,b=this._zoom*A;this.zoomTo(b,!0),this.dollyToCursor&&(this._changedZoom+=b-N,this._dollyControlCoord.set(y,O))},typeof at>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new at.Quaternion().setFromUnitVectors(this._camera.up,rs),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=G.NONE,this._target=new at.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new at.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new at.Spherical().setFromVector3(lt.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new at.Vector3,new at.Vector3,new at.Vector3,new at.Vector3],this._updateNearPlaneCorners(),this._boundary=new at.Box3(new at.Vector3(-1/0,-1/0,-1/0),new at.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new at.Vector2,this.mouseButtons={left:G.ROTATE,middle:G.DOLLY,right:G.TRUCK,wheel:be(this._camera)?G.DOLLY:Te(this._camera)?G.ZOOM:G.NONE},this.touches={one:G.TOUCH_ROTATE,two:be(this._camera)?G.TOUCH_DOLLY_TRUCK:Te(this._camera)?G.TOUCH_ZOOM_TRUCK:G.NONE,three:G.TOUCH_TRUCK};const i=new at.Vector2,s=new at.Vector2,n=new at.Vector2,r=T=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const A=this._domElement.getBoundingClientRect(),N=T.clientX/A.width,b=T.clientY/A.height;if(N<this._interactiveArea.left||N>this._interactiveArea.right||b<this._interactiveArea.top||b>this._interactiveArea.bottom)return}const y=T.pointerType!=="mouse"?null:(T.buttons&ht.LEFT)===ht.LEFT?ht.LEFT:(T.buttons&ht.MIDDLE)===ht.MIDDLE?ht.MIDDLE:(T.buttons&ht.RIGHT)===ht.RIGHT?ht.RIGHT:null;if(y!==null){const A=this._findPointerByMouseButton(y);A&&this._disposePointer(A)}if((T.buttons&ht.LEFT)===ht.LEFT&&this._lockedPointer)return;const O={pointerId:T.pointerId,clientX:T.clientX,clientY:T.clientY,deltaX:0,deltaY:0,mouseButton:y};this._activePointers.push(O),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,f(T)},o=T=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const A=this._domElement.getBoundingClientRect(),N=T.clientX/A.width,b=T.clientY/A.height;if(N<this._interactiveArea.left||N>this._interactiveArea.right||b<this._interactiveArea.top||b>this._interactiveArea.bottom)return}const y=(T.buttons&ht.LEFT)===ht.LEFT?ht.LEFT:(T.buttons&ht.MIDDLE)===ht.MIDDLE?ht.MIDDLE:(T.buttons&ht.RIGHT)===ht.RIGHT?ht.RIGHT:null;if(y!==null){const A=this._findPointerByMouseButton(y);A&&this._disposePointer(A)}const O={pointerId:1,clientX:T.clientX,clientY:T.clientY,deltaX:0,deltaY:0,mouseButton:(T.buttons&ht.LEFT)===ht.LEFT?ht.LEFT:(T.buttons&ht.MIDDLE)===ht.LEFT?ht.MIDDLE:(T.buttons&ht.RIGHT)===ht.LEFT?ht.RIGHT:null};this._activePointers.push(O),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",p),this._domElement.ownerDocument.addEventListener("mousemove",l),this._domElement.ownerDocument.addEventListener("mouseup",p),this._isDragging=!0,f(T)},h=T=>{T.cancelable&&T.preventDefault();const y=T.pointerId,O=this._lockedPointer||this._findPointerById(y);if(O){if(O.clientX=T.clientX,O.clientY=T.clientY,O.deltaX=T.movementX,O.deltaY=T.movementY,this._state=0,T.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(T.buttons&ht.LEFT)===ht.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(T.buttons&ht.MIDDLE)===ht.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(T.buttons&ht.RIGHT)===ht.RIGHT&&(this._state=this._state|this.mouseButtons.right);E()}},l=T=>{const y=this._lockedPointer||this._findPointerById(1);y&&(y.clientX=T.clientX,y.clientY=T.clientY,y.deltaX=T.movementX,y.deltaY=T.movementY,this._state=0,(this._lockedPointer||(T.buttons&ht.LEFT)===ht.LEFT)&&(this._state=this._state|this.mouseButtons.left),(T.buttons&ht.MIDDLE)===ht.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(T.buttons&ht.RIGHT)===ht.RIGHT&&(this._state=this._state|this.mouseButtons.right),E())},c=T=>{const y=this._findPointerById(T.pointerId);if(!(y&&y===this._lockedPointer)){if(y&&this._disposePointer(y),T.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=G.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=G.NONE;I()}},p=()=>{const T=this._findPointerById(1);T&&T===this._lockedPointer||(T&&this._disposePointer(T),this._state=G.NONE,I())};let u=-1;const d=T=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===G.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const b=this._domElement.getBoundingClientRect(),P=T.clientX/b.width,z=T.clientY/b.height;if(P<this._interactiveArea.left||P>this._interactiveArea.right||z<this._interactiveArea.top||z>this._interactiveArea.bottom)return}if(T.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===G.ROTATE||this.mouseButtons.wheel===G.TRUCK){const b=performance.now();u-b<1e3&&this._getClientRect(this._elementRect),u=b}const y=il?-1:-3,O=T.deltaMode===1?T.deltaY/y:T.deltaY/(y*10),A=this.dollyToCursor?(T.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,N=this.dollyToCursor?(T.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case G.ROTATE:{this._rotateInternal(T.deltaX,T.deltaY),this._isUserControllingRotate=!0;break}case G.TRUCK:{this._truckInternal(T.deltaX,T.deltaY,!1),this._isUserControllingTruck=!0;break}case G.OFFSET:{this._truckInternal(T.deltaX,T.deltaY,!0),this._isUserControllingOffset=!0;break}case G.DOLLY:{this._dollyInternal(-O,A,N),this._isUserControllingDolly=!0;break}case G.ZOOM:{this._zoomInternal(-O,A,N),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},m=T=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Mt.ACTION.NONE){const y=T instanceof PointerEvent?T.pointerId:0,O=this._findPointerById(y);O&&this._disposePointer(O),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",p);return}T.preventDefault()}},f=T=>{if(this._enabled){if(Ws(this._activePointers,kt),this._getClientRect(this._elementRect),i.copy(kt),s.copy(kt),this._activePointers.length>=2){const y=kt.x-this._activePointers[1].clientX,O=kt.y-this._activePointers[1].clientY,A=Math.sqrt(y*y+O*O);n.set(0,A);const N=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,b=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;s.set(N,b)}if(this._state=0,!T)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in T&&T.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(T.buttons&ht.LEFT)===ht.LEFT&&(this._state=this._state|this.mouseButtons.left),(T.buttons&ht.MIDDLE)===ht.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(T.buttons&ht.RIGHT)===ht.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&G.ROTATE)===G.ROTATE||(this._state&G.TOUCH_ROTATE)===G.TOUCH_ROTATE||(this._state&G.TOUCH_DOLLY_ROTATE)===G.TOUCH_DOLLY_ROTATE||(this._state&G.TOUCH_ZOOM_ROTATE)===G.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&G.TRUCK)===G.TRUCK||(this._state&G.TOUCH_TRUCK)===G.TOUCH_TRUCK||(this._state&G.TOUCH_DOLLY_TRUCK)===G.TOUCH_DOLLY_TRUCK||(this._state&G.TOUCH_ZOOM_TRUCK)===G.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&G.DOLLY)===G.DOLLY||(this._state&G.TOUCH_DOLLY)===G.TOUCH_DOLLY||(this._state&G.TOUCH_DOLLY_TRUCK)===G.TOUCH_DOLLY_TRUCK||(this._state&G.TOUCH_DOLLY_OFFSET)===G.TOUCH_DOLLY_OFFSET||(this._state&G.TOUCH_DOLLY_ROTATE)===G.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&G.ZOOM)===G.ZOOM||(this._state&G.TOUCH_ZOOM)===G.TOUCH_ZOOM||(this._state&G.TOUCH_ZOOM_TRUCK)===G.TOUCH_ZOOM_TRUCK||(this._state&G.TOUCH_ZOOM_OFFSET)===G.TOUCH_ZOOM_OFFSET||(this._state&G.TOUCH_ZOOM_ROTATE)===G.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&G.OFFSET)===G.OFFSET||(this._state&G.TOUCH_OFFSET)===G.TOUCH_OFFSET||(this._state&G.TOUCH_DOLLY_OFFSET)===G.TOUCH_DOLLY_OFFSET||(this._state&G.TOUCH_ZOOM_OFFSET)===G.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},E=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Ws(this._activePointers,kt);const T=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,y=T?-T.deltaX:s.x-kt.x,O=T?-T.deltaY:s.y-kt.y;if(s.copy(kt),((this._state&G.ROTATE)===G.ROTATE||(this._state&G.TOUCH_ROTATE)===G.TOUCH_ROTATE||(this._state&G.TOUCH_DOLLY_ROTATE)===G.TOUCH_DOLLY_ROTATE||(this._state&G.TOUCH_ZOOM_ROTATE)===G.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(y,O),this._isUserControllingRotate=!0),(this._state&G.DOLLY)===G.DOLLY||(this._state&G.ZOOM)===G.ZOOM){const A=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,N=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0,b=this.dollyDragInverted?-1:1;(this._state&G.DOLLY)===G.DOLLY?(this._dollyInternal(b*O*ns,A,N),this._isUserControllingDolly=!0):(this._zoomInternal(b*O*ns,A,N),this._isUserControllingZoom=!0)}if((this._state&G.TOUCH_DOLLY)===G.TOUCH_DOLLY||(this._state&G.TOUCH_ZOOM)===G.TOUCH_ZOOM||(this._state&G.TOUCH_DOLLY_TRUCK)===G.TOUCH_DOLLY_TRUCK||(this._state&G.TOUCH_ZOOM_TRUCK)===G.TOUCH_ZOOM_TRUCK||(this._state&G.TOUCH_DOLLY_OFFSET)===G.TOUCH_DOLLY_OFFSET||(this._state&G.TOUCH_ZOOM_OFFSET)===G.TOUCH_ZOOM_OFFSET||(this._state&G.TOUCH_DOLLY_ROTATE)===G.TOUCH_DOLLY_ROTATE||(this._state&G.TOUCH_ZOOM_ROTATE)===G.TOUCH_ZOOM_ROTATE){const A=kt.x-this._activePointers[1].clientX,N=kt.y-this._activePointers[1].clientY,b=Math.sqrt(A*A+N*N),P=n.y-b;n.set(0,b);const z=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,F=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&G.TOUCH_DOLLY)===G.TOUCH_DOLLY||(this._state&G.TOUCH_DOLLY_ROTATE)===G.TOUCH_DOLLY_ROTATE||(this._state&G.TOUCH_DOLLY_TRUCK)===G.TOUCH_DOLLY_TRUCK||(this._state&G.TOUCH_DOLLY_OFFSET)===G.TOUCH_DOLLY_OFFSET?(this._dollyInternal(P*ns,z,F),this._isUserControllingDolly=!0):(this._zoomInternal(P*ns,z,F),this._isUserControllingZoom=!0)}((this._state&G.TRUCK)===G.TRUCK||(this._state&G.TOUCH_TRUCK)===G.TOUCH_TRUCK||(this._state&G.TOUCH_DOLLY_TRUCK)===G.TOUCH_DOLLY_TRUCK||(this._state&G.TOUCH_ZOOM_TRUCK)===G.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(y,O,!1),this._isUserControllingTruck=!0),((this._state&G.OFFSET)===G.OFFSET||(this._state&G.TOUCH_OFFSET)===G.TOUCH_OFFSET||(this._state&G.TOUCH_DOLLY_OFFSET)===G.TOUCH_DOLLY_OFFSET||(this._state&G.TOUCH_ZOOM_OFFSET)===G.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(y,O,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},I=()=>{Ws(this._activePointers,kt),s.copy(kt),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mouseup",p),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",C),this._domElement.ownerDocument.addEventListener("pointerlockerror",R),this._domElement.ownerDocument.addEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),f())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",C),this._domElement.ownerDocument.removeEventListener("pointerlockerror",R))};const C=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},R=()=>{this.unlockPointer()};this._addAllEventListeners=T=>{this._domElement=T,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",r),sl&&this._domElement.addEventListener("mousedown",o),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",d,{passive:!1}),this._domElement.addEventListener("contextmenu",m)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",r),this._domElement.removeEventListener("mousedown",o),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",d,{passive:!1}),this._domElement.removeEventListener("contextmenu",m),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mouseup",p),this._domElement.ownerDocument.removeEventListener("pointerlockchange",C),this._domElement.ownerDocument.removeEventListener("pointerlockerror",R))},this.cancel=()=>{this._state!==G.NONE&&(this._state=G.NONE,this._activePointers.length=0,I())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=qt(t.width,0,1),this._interactiveArea.height=qt(t.height,0,1),this._interactiveArea.x=qt(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=qt(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,i=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,i=!1){this._isUserControllingRotate=!1;const s=qt(t,this.minAzimuthAngle,this.maxAzimuthAngle),n=qt(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=s,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const r=!i||mt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&mt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(r)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Ze.NONE,this._changedDolly=0,this._dollyToNoClamp(qt(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){const i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const n=this._collisionTest(),r=mt(n,this._spherical.radius);if(!(i>t)&&r)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,n)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);const s=!e||mt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(s)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(_i).multiplyScalar(t)),e||this._target.copy(this._targetEnd);const i=!e||mt(this._target.x,this._targetEnd.x,this.restThreshold)&&mt(this._target.y,this._targetEnd.y,this.restThreshold)&&mt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=qt(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);const i=!e||mt(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(t,e,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,i)}truck(t,e,i=!1){this._camera.updateMatrix(),ae.setFromMatrixColumn(this._camera.matrix,0),he.setFromMatrixColumn(this._camera.matrix,1),ae.multiplyScalar(t),he.multiplyScalar(-e);const s=lt.copy(ae).add(he),n=ft.copy(this._targetEnd).add(s);return this.moveTo(n.x,n.y,n.z,i)}forward(t,e=!1){lt.setFromMatrixColumn(this._camera.matrix,0),lt.crossVectors(this._camera.up,lt),lt.multiplyScalar(t);const i=ft.copy(this._targetEnd).add(lt);return this.moveTo(i.x,i.y,i.z,e)}elevate(t,e=!1){return lt.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+lt.x,this._targetEnd.y+lt.y,this._targetEnd.z+lt.z,e)}moveTo(t,e,i,s=!1){this._isUserControllingTruck=!1;const n=lt.set(t,e,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,s||this._target.copy(this._targetEnd);const r=!s||mt(this._target.x,this._targetEnd.x,this.restThreshold)&&mt(this._target.y,this._targetEnd.y,this.restThreshold)&&mt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}lookInDirectionOf(t,e,i,s=!1){const n=lt.set(t,e,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(n.x,n.y,n.z,s)}fitToBox(t,e,{cover:i=!1,paddingLeft:s=0,paddingRight:n=0,paddingBottom:r=0,paddingTop:o=0}={}){const h=[],l=t.isBox3?Ke.copy(t):Ke.setFromObject(t);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const c=Rr(this._sphericalEnd.theta,yr),p=Rr(this._sphericalEnd.phi,yr);h.push(this.rotateTo(c,p,e));const u=lt.setFromSpherical(this._sphericalEnd).normalize(),d=vr.setFromUnitVectors(u,Xs),m=mt(Math.abs(u.y),1);m&&d.multiply($s.setFromAxisAngle(rs,c)),d.multiply(this._yAxisUpSpaceInverse);const f=br.makeEmpty();ft.copy(l.min).applyQuaternion(d),f.expandByPoint(ft),ft.copy(l.min).setX(l.max.x).applyQuaternion(d),f.expandByPoint(ft),ft.copy(l.min).setY(l.max.y).applyQuaternion(d),f.expandByPoint(ft),ft.copy(l.max).setZ(l.min.z).applyQuaternion(d),f.expandByPoint(ft),ft.copy(l.min).setZ(l.max.z).applyQuaternion(d),f.expandByPoint(ft),ft.copy(l.max).setY(l.min.y).applyQuaternion(d),f.expandByPoint(ft),ft.copy(l.max).setX(l.min.x).applyQuaternion(d),f.expandByPoint(ft),ft.copy(l.max).applyQuaternion(d),f.expandByPoint(ft),f.min.x-=s,f.min.y-=r,f.max.x+=n,f.max.y+=o,d.setFromUnitVectors(Xs,u),m&&d.premultiply($s.invert()),d.premultiply(this._yAxisUpSpace);const E=f.getSize(lt),I=f.getCenter(ft).applyQuaternion(d);if(be(this._camera)){const C=this.getDistanceToFitBox(E.x,E.y,E.z,i);h.push(this.moveTo(I.x,I.y,I.z,e)),h.push(this.dollyTo(C,e)),h.push(this.setFocalOffset(0,0,0,e))}else if(Te(this._camera)){const C=this._camera,R=C.right-C.left,T=C.top-C.bottom,y=i?Math.max(R/E.x,T/E.y):Math.min(R/E.x,T/E.y);h.push(this.moveTo(I.x,I.y,I.z,e)),h.push(this.zoomTo(y,e)),h.push(this.setFocalOffset(0,0,0,e))}return Promise.all(h)}fitToSphere(t,e){const i=[],s=t instanceof at.Sphere?Zs.copy(t):Mt.createBoundingSphere(t,Zs);if(i.push(this.moveTo(s.center.x,s.center.y,s.center.z,e)),be(this._camera)){const n=this.getDistanceToFitSphere(s.radius);i.push(this.dollyTo(n,e))}else if(Te(this._camera)){const n=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,o=2*s.radius,h=Math.min(n/o,r/o);i.push(this.zoomTo(h,e))}return i.push(this.setFocalOffset(0,0,0,e)),Promise.all(i)}setLookAt(t,e,i,s,n,r,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Ze.NONE,this._changedDolly=0;const h=ft.set(s,n,r),l=lt.set(t,e,i);this._targetEnd.copy(h),this._sphericalEnd.setFromVector3(l.sub(h).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const c=!o||mt(this._target.x,this._targetEnd.x,this.restThreshold)&&mt(this._target.y,this._targetEnd.y,this.restThreshold)&&mt(this._target.z,this._targetEnd.z,this.restThreshold)&&mt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&mt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&mt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(t,e,i,s,n,r,o,h,l,c,p,u,d,m=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Ze.NONE,this._changedDolly=0;const f=lt.set(s,n,r),E=ft.set(t,e,i);Wt.setFromVector3(E.sub(f).applyQuaternion(this._yAxisUpSpace));const I=Qe.set(c,p,u),C=ft.set(o,h,l);wi.setFromVector3(C.sub(I).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(f.lerp(I,d));const R=wi.theta-Wt.theta,T=wi.phi-Wt.phi,y=wi.radius-Wt.radius;this._sphericalEnd.set(Wt.radius+y*d,Wt.phi+T*d,Wt.theta+R*d),this.normalizeRotations(),this._needsUpdate=!0,m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const O=!m||mt(this._target.x,this._targetEnd.x,this.restThreshold)&&mt(this._target.y,this._targetEnd.y,this.restThreshold)&&mt(this._target.z,this._targetEnd.z,this.restThreshold)&&mt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&mt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&mt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(O)}setPosition(t,e,i,s=!1){return this.setLookAt(t,e,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,s)}setTarget(t,e,i,s=!1){const n=this.getPosition(lt),r=this.setLookAt(n.x,n.y,n.z,t,e,i,s);return this._sphericalEnd.phi=qt(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),r}setFocalOffset(t,e,i,s=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,i),this._needsUpdate=!0,s||this._focalOffset.copy(this._focalOffsetEnd);const n=!s||mt(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&mt(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&mt(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(t,e,i){this._camera.updateMatrixWorld(),ae.setFromMatrixColumn(this._camera.matrixWorldInverse,0),he.setFromMatrixColumn(this._camera.matrixWorldInverse,1),ve.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const s=lt.set(t,e,i),n=s.distanceTo(this._camera.position),r=s.sub(this._camera.position);ae.multiplyScalar(r.x),he.multiplyScalar(r.y),ve.multiplyScalar(r.z),lt.copy(ae).add(he).add(ve),lt.z=lt.z+n,this.dollyTo(n,!1),this.setFocalOffset(-lt.x,lt.y,-lt.z,!1),this.moveTo(t,e,i,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,i,s){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new at.Vector4,typeof t=="number"?this._viewport.set(t,e,i,s):this._viewport.copy(t)}getDistanceToFitBox(t,e,i,s=!1){if(js(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const n=t/e,r=this._camera.getEffectiveFOV()*gi,o=this._camera.aspect;return((s?n>o:n<o)?e:t/o)*.5/Math.tan(r*.5)+i*.5}getDistanceToFitSphere(t){if(js(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const e=this._camera.getEffectiveFOV()*gi,i=Math.atan(Math.tan(e*.5)*this._camera.aspect)*2,s=1<this._camera.aspect?e:i;return t/Math.sin(s*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new at.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new at.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t&&t instanceof at.Spherical?t:new at.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new at.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%$e,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=$e),this._spherical.theta+=$e*Math.round((this._sphericalEnd.theta-this._spherical.theta)/$e)}reset(t=!1){if(!mt(this._camera.up.x,this._cameraUp0.x)||!mt(this._camera.up.y,this._cameraUp0.y)||!mt(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const i=this.getPosition(lt);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}const e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,rs),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=lt.subVectors(this._target,this._camera.position).normalize(),e=ft.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();const i=this.getPosition(lt);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(t){const e=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,s=this._sphericalEnd.radius-this._spherical.radius,n=Ar.subVectors(this._targetEnd,this._target),r=Or.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(Ct(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=ss(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,c,1/0,t),this._needsUpdate=!0}if(Ct(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=ss(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,c,1/0,t),this._needsUpdate=!0}if(Ct(s))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const c=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=ss(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,c,this.maxSpeed,t),this._needsUpdate=!0}if(Ct(n.x)&&Ct(n.y)&&Ct(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const c=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Fr(this._target,this._targetEnd,this._targetVelocity,c,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(Ct(r.x)&&Ct(r.y)&&Ct(r.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const c=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Fr(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,c,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(Ct(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const c=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=ss(this._zoom,this._zoomEnd,this._zoomVelocity,c,1/0,t)}if(this.dollyToCursor){if(be(this._camera)&&this._changedDolly!==0){const c=this._spherical.radius-this._lastDistance,p=this._camera,u=this._getCameraDirection(_i),d=lt.copy(u).cross(p.up).normalize();d.lengthSq()===0&&(d.x=1);const m=ft.crossVectors(d,u),f=this._sphericalEnd.radius*Math.tan(p.getEffectiveFOV()*gi*.5),E=(this._sphericalEnd.radius-c-this._sphericalEnd.radius)/this._sphericalEnd.radius,I=Qe.copy(this._targetEnd).add(d.multiplyScalar(this._dollyControlCoord.x*f*p.aspect)).add(m.multiplyScalar(this._dollyControlCoord.y*f)),C=lt.copy(this._targetEnd).lerp(I,E),R=this._lastDollyDirection===Ze.IN&&this._spherical.radius<=this.minDistance,T=this._lastDollyDirection===Ze.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(R||T)){this._sphericalEnd.radius-=c,this._spherical.radius-=c;const O=ft.copy(u).multiplyScalar(-c);C.add(O)}this._boundary.clampPoint(C,C);const y=ft.subVectors(C,this._targetEnd);this._targetEnd.copy(C),this._target.add(y),this._changedDolly-=c,Ct(this._changedDolly)&&(this._changedDolly=0)}else if(Te(this._camera)&&this._changedZoom!==0){const c=this._zoom-this._lastZoom,p=this._camera,u=lt.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(p.near+p.far)/(p.near-p.far)).unproject(p),d=ft.set(0,0,-1).applyQuaternion(p.quaternion),m=Qe.copy(u).add(d.multiplyScalar(-u.dot(p.up))),f=-(this._zoom-c-this._zoom)/this._zoom,E=this._getCameraDirection(_i),I=this._targetEnd.dot(E),C=lt.copy(this._targetEnd).lerp(m,f),R=C.dot(E),T=E.multiplyScalar(R-I);C.sub(T),this._boundary.clampPoint(C,C);const y=ft.subVectors(C,this._targetEnd);this._targetEnd.copy(C),this._target.add(y),this._changedZoom-=c,Ct(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const h=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,h),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!Ct(this._focalOffset.x)||!Ct(this._focalOffset.y)||!Ct(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),ae.setFromMatrixColumn(this._camera.matrix,0),he.setFromMatrixColumn(this._camera.matrix,1),ve.setFromMatrixColumn(this._camera.matrix,2),ae.multiplyScalar(this._focalOffset.x),he.multiplyScalar(-this._focalOffset.y),ve.multiplyScalar(this._focalOffset.z),lt.copy(ae).add(he).add(ve),this._camera.position.add(lt)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),lt.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const l=this._needsUpdate;return l&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):l?(this.dispatchEvent({type:"update"}),Ct(e,this.restThreshold)&&Ct(i,this.restThreshold)&&Ct(s,this.restThreshold)&&Ct(n.x,this.restThreshold)&&Ct(n.y,this.restThreshold)&&Ct(n.z,this.restThreshold)&&Ct(r.x,this.restThreshold)&&Ct(r.y,this.restThreshold)&&Ct(r.z,this.restThreshold)&&Ct(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!l&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=l,this._needsUpdate=!1,l}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Ci(this.maxDistance),minZoom:this.minZoom,maxZoom:Ci(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Ci(this.maxPolarAngle),minAzimuthAngle:Ci(this.minAzimuthAngle),maxAzimuthAngle:Ci(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:lt.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){const i=JSON.parse(t);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=Ti(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=Ti(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=Ti(i.maxPolarAngle),this.minAzimuthAngle=Ti(i.minAzimuthAngle),this.maxAzimuthAngle=Ti(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this.verticalDragToForward=i.verticalDragToForward,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],e),Wt.setFromVector3(lt.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Wt.theta,Wt.phi,e),this.dollyTo(Wt.radius,e),this.zoomTo(i.zoom,e),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",el),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,i){const s=e.lengthSq();if(s===0)return t;const n=ft.copy(e).add(t),r=this._boundary.clampPoint(n,Qe).sub(n),o=r.lengthSq();if(o===0)return t.add(e);if(o===s)return t;if(i===0)return t.add(e).add(r);{const h=1+i*o/e.dot(r);return t.add(ft.copy(e).multiplyScalar(h)).add(r.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(be(this._camera)){const t=this._camera,e=t.near,i=t.getEffectiveFOV()*gi,s=Math.tan(i*.5)*e,n=s*t.aspect;this._nearPlaneCorners[0].set(-n,-s,0),this._nearPlaneCorners[1].set(n,-s,0),this._nearPlaneCorners[2].set(n,s,0),this._nearPlaneCorners[3].set(-n,s,0)}else if(Te(this._camera)){const t=this._camera,e=1/t.zoom,i=t.left*e,s=t.right*e,n=t.top*e,r=t.bottom*e;this._nearPlaneCorners[0].set(i,n,0),this._nearPlaneCorners[1].set(s,n,0),this._nearPlaneCorners[2].set(s,r,0),this._nearPlaneCorners[3].set(i,r,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||js(this._camera,"_collisionTest"))return t;const e=this._getTargetDirection(_i);Qs.lookAt(Sr,e,this._camera.up);for(let i=0;i<4;i++){const s=ft.copy(this._nearPlaneCorners[i]);s.applyMatrix4(Qs);const n=Qe.addVectors(this._target,s);os.set(n,e),os.far=this._spherical.radius+1;const r=os.intersectObjects(this.colliderMeshes);r.length!==0&&r[0].distance<t&&(t=r[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{const i=()=>{this.removeEventListener("rest",i),e()};this.addEventListener("rest",i)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new at.Sphere){const i=e,s=i.center;Ke.makeEmpty(),t.traverseVisible(r=>{r.isMesh&&Ke.expandByObject(r)}),Ke.getCenter(s);let n=0;return t.traverseVisible(r=>{if(!r.isMesh)return;const o=r,h=o.geometry.clone();h.applyMatrix4(o.matrixWorld);const l=h.attributes.position;for(let c=0,p=l.count;c<p;c++)lt.fromBufferAttribute(l,c),n=Math.max(n,s.distanceToSquared(lt))}),i.radius=Math.sqrt(n),i}}class xi extends zh{constructor(t){super(t),g(this,"onBeforeUpdate",new $),g(this,"onAfterUpdate",new $),g(this,"onAspectUpdated",new $),g(this,"onDisposed",new $),g(this,"three"),g(this,"_allControls",new Map),g(this,"updateAspect",()=>{var e;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof De){this.onAspectUpdated.trigger();return}if((e=this.currentWorld.renderer)!=null&&e.isResizeable()){const i=this.currentWorld.renderer.getSize();this.three.aspect=i.width/i.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:e,world:i})=>{if(e==="added"){const s=this.newCameraControls();this._allControls.set(i.uuid,s)}if(e==="removed"){const s=this._allControls.get(i.uuid);s&&(s.dispose(),this._allControls.delete(i.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const t=this._allControls.get(this.currentWorld.uuid);if(!t)throw new Error("Controls not found!");return t}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(t){this.currentWorld!==null&&(this.controls.enabled=t)}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[t,e]of this._allControls)e.dispose()}update(t){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(t),this.onAfterUpdate.trigger(this))}setupCamera(){const t=window.innerWidth/window.innerHeight,e=new Rn(60,t,1,1e3);return e.position.set(50,50,50),e.lookAt(new U(0,0,0)),e}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");Mt.install({THREE:xi.getSubsetOfThree()});const{domElement:t}=this.currentWorld.renderer.three,e=new Mt(this.three,t);return e.smoothTime=.2,e.dollyToCursor=!0,e.infinityDolly=!0,e.minDistance=6,e}setupEvents(t){t?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:Ia,Vector2:se,Vector3:U,Vector4:ga,Quaternion:te,Matrix4:ut,Spherical:Ca,Box3:Nt,Sphere:Ts,Raycaster:yn,MathUtils:Xr}}}const Co=class To extends St{constructor(t){super(t),g(this,"onAfterUpdate",new $),g(this,"onBeforeUpdate",new $),g(this,"onDisposed",new $),g(this,"onWorldCreated",new $),g(this,"onWorldDeleted",new $),g(this,"list",new Map),g(this,"enabled",!0),t.add(To.uuid,this)}create(){const t=new qh(this.components),e=t.uuid;if(this.list.has(e))throw new Error("There is already a world with this name!");return this.list.set(e,t),this.onWorldCreated.trigger(t),t}delete(t){if(!this.list.has(t.uuid))throw new Error("The provided world is not found in the list!");const e=t.uuid;this.list.delete(t.uuid),t.dispose(),this.onWorldDeleted.trigger(e)}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}update(t){if(this.enabled)for(const[e,i]of this.list)i.update(t)}};g(Co,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let nl=Co;function rl(a,t,e,i){return new Promise((s,n)=>{function r(){const o=a.clientWaitSync(t,e,0);if(o===a.WAIT_FAILED){n();return}if(o===a.TIMEOUT_EXPIRED){setTimeout(r,i);return}s()}r()})}async function ol(a,t,e,i,s,n,r){const o=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);a.flush(),await rl(a,o,0,10),a.deleteSync(o),a.bindBuffer(t,e),a.getBufferSubData(t,i,s,n,r),a.bindBuffer(t,null)}async function _o(a,t,e,i,s,n,r,o){const h=a.createBuffer();return a.bindBuffer(a.PIXEL_PACK_BUFFER,h),a.bufferData(a.PIXEL_PACK_BUFFER,o.byteLength,a.STREAM_READ),a.readPixels(t,e,i,s,n,r,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),await ol(a,a.PIXEL_PACK_BUFFER,h,0,o),a.deleteBuffer(h),o}class al{constructor(t,e,i){if(g(this,"onDisposed",new $),g(this,"onViewUpdated",new ps),g(this,"enabled",!0),g(this,"needsUpdate",!1),g(this,"renderDebugFrame",!1),g(this,"components"),g(this,"world"),g(this,"renderer"),g(this,"autoUpdate",!0),g(this,"updateInterval",1e3),g(this,"worker"),g(this,"scene",new _s),g(this,"_width",512),g(this,"_height",512),g(this,"_availableColor",1),g(this,"renderTarget"),g(this,"bufferSize"),g(this,"_buffer"),g(this,"_isWorkerBusy",!1),g(this,"updateVisibility",async r=>{if(!this.enabled||!this.needsUpdate&&!r||this._isWorkerBusy)return;this._isWorkerBusy=!0;const o=this.world.camera.three;o.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,o);const h=this.renderer.getContext();try{await _o(h,0,0,this._width,this._height,h.RGBA,h.UNSIGNED_BYTE,this._buffer)}catch{this.needsUpdate=!1,this._isWorkerBusy=!1,this.renderer.setRenderTarget(null);return}this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,o),this.worker.postMessage({buffer:this._buffer}),this.needsUpdate=!1}),!e.renderer)throw new Error("The given world must have a renderer!");this.components=t,this.applySettings(i),this.world=e,this.renderer=new Ni,this.renderTarget=new Js(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.renderer.clippingPlanes=e.renderer.clippingPlanes;const s=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Map();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          const g = buffer[i + 1];
          const b = buffer[i + 2];
          const code = "" + r + "-" + g + "-" + b;
          if(colors.has(code)) {
            colors.set(code, colors.get(code) + 1);
          } else {
            colors.set(code, 1);
          }
        }
        postMessage({ colors });
      });
    `,n=new Blob([s],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(n))}dispose(){this.enabled=!1;for(const t of this.scene.children)t.removeFromParent();this.onViewUpdated.reset(),this.worker.terminate(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderTarget.dispose(),this._buffer=null,this.onDisposed.reset()}getAvailableColor(){let t=BigInt(this._availableColor.toString());const e=[];do e.unshift(Number(t%256n)),t/=256n;while(t);for(;e.length!==3;)e.unshift(0);const[i,s,n]=e,r=`${i}-${s}-${n}`;return{r:i,g:s,b:n,code:r}}increaseColor(){if(this._availableColor===256*256*256){console.warn("Color can't be increased over 256 x 256 x 256!");return}this._availableColor++}decreaseColor(){if(this._availableColor===1){console.warn("Color can't be decreased under 0!");return}this._availableColor--}applySettings(t){t&&(t.updateInterval!==void 0&&(this.updateInterval=t.updateInterval),t.height!==void 0&&(this._height=t.height),t.width!==void 0&&(this._width=t.width),t.autoUpdate!==void 0&&(this.autoUpdate=t.autoUpdate))}}class hl extends al{constructor(t,e,i){super(t,e,i),g(this,"onViewUpdated",new $),g(this,"threshold",100),g(this,"colorMeshes",new Map),g(this,"isProcessing",!1),g(this,"_interval",null),g(this,"_colorCodeMeshMap",new Map),g(this,"_meshIDColorCodeMap",new Map),g(this,"_currentVisibleMeshes",new Set),g(this,"_recentlyHiddenMeshes",new Set),g(this,"_intervalID",null),g(this,"_transparentMat",new ni({transparent:!0,opacity:0})),g(this,"handleWorkerMessage",async s=>{if(this.isProcessing)return;const n=s.data.colors;this._recentlyHiddenMeshes=new Set(this._currentVisibleMeshes),this._currentVisibleMeshes.clear();for(const[r,o]of n){if(o<this.threshold)continue;const h=this._colorCodeMeshMap.get(r);h&&(this._currentVisibleMeshes.add(h),this._recentlyHiddenMeshes.delete(h))}this.onViewUpdated.trigger({seen:this._currentVisibleMeshes,unseen:this._recentlyHiddenMeshes}),this._isWorkerBusy=!1}),this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&(this._interval=window.setInterval(async()=>{this.isProcessing||await this.updateVisibility()},this.updateInterval)),this.onViewUpdated.add(({seen:s,unseen:n})=>{for(const r of s)r.visible=!0;for(const r of n)r.visible=!1})}dispose(){super.dispose(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null),this._interval!==null&&(window.clearInterval(this._interval),this._intervalID=null),this._currentVisibleMeshes.clear(),this._recentlyHiddenMeshes.clear(),this._meshIDColorCodeMap.clear(),this._transparentMat.dispose(),this._colorCodeMeshMap.clear();const t=this.components.get(ri);for(const e in this.colorMeshes){const i=this.colorMeshes.get(e);i&&t.destroy(i,!0)}this.colorMeshes.clear()}add(t){if(!this.enabled)return;if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const e=t instanceof Me,{geometry:i,material:s}=t,{colorMaterial:n,code:r}=this.getAvailableMaterial();let o;if(Array.isArray(s)){let c=!0;const p=[];for(const u of s)wr.isTransparent(u)?p.push(this._transparentMat):(c=!1,p.push(n));if(c){n.dispose(),this.isProcessing=!1;return}o=p}else if(wr.isTransparent(s)){n.dispose(),this.isProcessing=!1;return}else o=n;this._colorCodeMeshMap.set(r,t),this._meshIDColorCodeMap.set(t.uuid,r);const h=e?t.count:1,l=new Me(i,o,h);e?l.instanceMatrix=t.instanceMatrix:l.setMatrixAt(0,new ut),t.visible=!1,t.updateWorldMatrix(!0,!1),l.applyMatrix4(t.matrixWorld),l.updateMatrix(),this.scene.add(l),this.colorMeshes.set(t.uuid,l),this.increaseColor(),this.isProcessing=!1}remove(t){if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const e=this.components.get(ri);this._currentVisibleMeshes.delete(t),this._recentlyHiddenMeshes.delete(t);const i=this.colorMeshes.get(t.uuid),s=this._meshIDColorCodeMap.get(t.uuid);if(!i||!s){this.isProcessing=!1;return}this._colorCodeMeshMap.delete(s),this._meshIDColorCodeMap.delete(t.uuid),this.colorMeshes.delete(t.uuid),i.geometry=void 0,i.material=[],e.destroy(i,!0),this._recentlyHiddenMeshes.delete(t),this._currentVisibleMeshes.delete(t),this.isProcessing=!1}updateInstanced(t){for(const e of t){const i=this.colorMeshes.get(e.uuid);i&&(i.count=e.count)}}getAvailableMaterial(){const{r:t,g:e,b:i,code:s}=this.getAvailableColor(),n=Ns.enabled;Ns.enabled=!1;const r=new ie(`rgb(${t}, ${e}, ${i})`);if(!this.world.renderer)throw new Error("Renderer not found in the world!");const o=this.world.renderer.clippingPlanes,h=new ni({color:r,clippingPlanes:o,side:Li});return Ns.enabled=n,{colorMaterial:h,code:s}}}const wo=class pn extends St{constructor(t){super(t),g(this,"onDisposed",new $),g(this,"_enabled",!0),g(this,"list",new Map),t.add(pn.uuid,this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t;for(const[e,i]of this.list)i.enabled=t}create(t,e){if(this.list.has(t.uuid))return this.list.get(t.uuid);const i=new hl(this.components,t,e);return this.list.set(t.uuid,i),i}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){this.enabled=!1,this.onDisposed.trigger(pn.uuid),this.onDisposed.reset();for(const[t,e]of this.list)e.dispose();this.list.clear()}updateInstanced(t){for(const[,e]of this.list)e.updateInstanced(t)}};g(wo,"uuid","69f2a50d-c266-44fc-b1bd-fa4d34be89e6");let ll=wo;class cl{constructor(t,e){if(g(this,"onDisposed",new $),g(this,"onDistanceComputed",new $),g(this,"excludedObjects",new Set),g(this,"enabled",!0),g(this,"renderDebugFrame",!1),g(this,"components"),g(this,"scene",new _s),g(this,"camera",new De(-1,1,1,-1,0,1)),g(this,"depthMaterial"),g(this,"world"),g(this,"renderer"),g(this,"worker"),g(this,"_width",512),g(this,"_height",512),g(this,"_postQuad"),g(this,"tempRT"),g(this,"resultRT"),g(this,"bufferSize"),g(this,"_buffer"),g(this,"_isWorkerBusy",!1),g(this,"compute",async()=>{if(!this.enabled||this.world.isDisposing||this._isWorkerBusy)return;this._isWorkerBusy=!0,this.world.camera.three.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.tempRT);const o="visibilityBeforeDistanceCheck";for(const l of this.excludedObjects)l.userData[o]=l.visible,l.visible=!1;this.renderer.render(this.world.scene.three,this.world.camera.three);for(const l of this.excludedObjects)l.userData[o]!==void 0&&(l.visible=l.userData[o]);this.depthMaterial.uniforms.tDiffuse.value=this.tempRT.texture,this.depthMaterial.uniforms.tDepth.value=this.tempRT.depthTexture,this.renderer.setRenderTarget(this.resultRT),this.renderer.render(this.scene,this.camera);const h=this.renderer.getContext();try{await _o(h,0,0,this._width,this._height,h.RGBA,h.UNSIGNED_BYTE,this._buffer)}catch{this.renderer.setRenderTarget(null),this._isWorkerBusy=!1;return}this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,this.camera),this.worker.postMessage({buffer:this._buffer})}),g(this,"handleWorkerMessage",o=>{if(!this.enabled||this.world.isDisposing)return;const h=o.data.colors;let l=Number.MAX_VALUE;for(const d of h)d!==0&&d<l&&(l=d);const c=this.world.camera.three||De,p=(l/255-1)*-1*(c.far-c.near),u=Math.min(p,c.far);this.onDistanceComputed.trigger(u),this._isWorkerBusy=!1}),!e.renderer)throw new Error("The given world must have a renderer!");this.components=t,this.world=e;const i=e.camera.three;this.renderer=new Ni,this.tempRT=new Js(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.tempRT.texture.minFilter=qn,this.tempRT.texture.magFilter=qn,this.tempRT.stencilBuffer=!1,this.tempRT.samples=0,this.tempRT.depthTexture=new _a(this._width,this._height),this.tempRT.depthTexture.format=wa,this.tempRT.depthTexture.type=ya,this.resultRT=new Js(this._width,this._height),this.depthMaterial=new $r({vertexShader:`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
    `,fragmentShader:`
#include <packing>

varying vec2 vUv;
uniform sampler2D tDiffuse;
uniform sampler2D tDepth;
uniform float cameraNear;
uniform float cameraFar;


float readDepth( sampler2D depthSampler, vec2 coord ) {
  float fragCoordZ = texture2D( depthSampler, coord ).x;
  float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
  return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );
}

void main() {
  //vec3 diffuse = texture2D( tDiffuse, vUv ).rgb;
  float depth = readDepth( tDepth, vUv );

  gl_FragColor.rgb = 1.0 - vec3( depth );
  gl_FragColor.a = 1.0;
}
    `,uniforms:{cameraNear:{value:i.near},cameraFar:{value:i.far},tDiffuse:{value:null},tDepth:{value:null}}});const s=new ws(2,2);this._postQuad=new it(s,this.depthMaterial),this.scene.add(this._postQuad),this.renderer.clippingPlanes=e.renderer.clippingPlanes;const n=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Set();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          colors.add(r);
        }
        postMessage({ colors });
      });
    `,r=new Blob([n],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(r)),this.worker.addEventListener("message",this.handleWorkerMessage)}dispose(){this.enabled=!1,this.onDistanceComputed.reset(),this.worker.terminate(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.tempRT.dispose(),this.resultRT.dispose();const t=[...this.scene.children];this.excludedObjects.clear();for(const e of t)e.removeFromParent();this._postQuad.geometry.dispose(),this._postQuad.removeFromParent(),this._buffer=null,this.onDisposed.reset()}}class dd extends Jh{constructor(){super(...arguments),g(this,"_distanceRenderer"),g(this,"autoBias",!0),g(this,"config",{directionalLight:{color:new ie("white"),intensity:1.5,position:new U(5,10,3)},ambientLight:{color:new ie("white"),intensity:1},shadows:{cascade:1,resolution:512}}),g(this,"_lightsWithShadow",new Map),g(this,"_isComputingShadows",!1),g(this,"_shadowsEnabled",!0),g(this,"_bias",0),g(this,"recomputeShadows",t=>{if(!this._shadowsEnabled)return;if(this.autoBias&&(this.bias=t/-1e5),t*=1.5,!this.currentWorld)throw new Error("A world needs to be assigned to the scene before computing shadows!");if(!this._lightsWithShadow.size)throw new Error("No shadows found!");const e=this.currentWorld.camera.three;if(!(e instanceof Rn)&&!(e instanceof De))throw new Error("Invalid camera type!");const i=new U;e.getWorldDirection(i);let s=t;const n=new U;n.copy(this.config.directionalLight.position),n.normalize();for(const[r,o]of this._lightsWithShadow){const h=this.directionalLights.get(o);if(!h)throw new Error("Light not found.");const l=new U;l.copy(i);const c=r===this._lightsWithShadow.size-1,p=c?s/2:s*2/3;l.multiplyScalar(p),l.add(e.position);const u=s-p,d=new U;d.copy(n),d.multiplyScalar(u),h.target.position.copy(l),h.position.copy(l),h.position.add(d),h.shadow.camera.right=u,h.shadow.camera.left=-u,h.shadow.camera.top=u,h.shadow.camera.bottom=-u,h.shadow.camera.far=u*2,h.shadow.camera.updateProjectionMatrix(),h.shadow.camera.updateMatrix(),c||(s/=3)}this._isComputingShadows=!1})}get bias(){return this._bias}set bias(t){this._bias=t;for(const[,e]of this._lightsWithShadow){const i=this.directionalLights.get(e);i&&(i.shadow.bias=t)}}get shadowsEnabled(){return this._shadowsEnabled}set shadowsEnabled(t){this._shadowsEnabled=t;for(const[,e]of this.directionalLights)e.castShadow=t}get distanceRenderer(){if(!this._distanceRenderer)throw new Error("You must set up this component before accessing the distance renderer!");return this._distanceRenderer}setup(t){if(super.setup(t),this.config={...this.config,...t},this.config.shadows.cascade<=0)throw new Error("Config.shadows.cascade must be a natural number greater than 0!");if(this.config.shadows.cascade>1)throw new Error("Multiple shadows not supported yet!");if(!this.currentWorld)throw new Error("A world needs to be assigned to the scene before setting it up!");for(const[,e]of this.directionalLights)e.target.removeFromParent(),e.removeFromParent(),e.dispose();this.directionalLights.clear(),this._distanceRenderer||(this._distanceRenderer=new cl(this.components,this.currentWorld),this._distanceRenderer.onDistanceComputed.add(this.recomputeShadows)),this._lightsWithShadow.clear();for(let e=0;e<this.config.shadows.cascade;e++){const i=new jr;i.intensity=this.config.directionalLight.intensity,i.color=this.config.directionalLight.color,i.position.copy(this.config.directionalLight.position),i.shadow.mapSize.width=this.config.shadows.resolution,i.shadow.mapSize.height=this.config.shadows.resolution,this.three.add(i,i.target),this.directionalLights.set(i.uuid,i),this._lightsWithShadow.set(e,i.uuid),i.castShadow=!0,i.shadow.bias=this._bias}}dispose(){super.dispose(),this._distanceRenderer&&this._distanceRenderer.dispose(),this._lightsWithShadow.clear()}async updateShadows(){this._isComputingShadows||!this._shadowsEnabled||(this._isComputingShadows=!0,await this.distanceRenderer.compute())}}class dl{constructor(t){g(this,"_event"),g(this,"_position",new se),g(this,"onDisposed",new $),g(this,"updateMouseInfo",e=>{this._event=e}),this.dom=t,this.setupEvents(!0)}get position(){if(this._event){const t=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(t,this._event),this._position.y=this.getPositionY(t,this._event)}return this._position}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}getPositionY(t,e){return-((e.clientY-t.top)/(t.bottom-t.top))*2+1}getPositionX(t,e){return(e.clientX-t.left)/(t.right-t.left)*2-1}setupEvents(t){t?this.dom.addEventListener("pointermove",this.updateMouseInfo):this.dom.removeEventListener("pointermove",this.updateMouseInfo)}}class ul{constructor(t,e){g(this,"enabled",!0),g(this,"components"),g(this,"onDisposed",new $),g(this,"mouse"),g(this,"three",new yn),g(this,"world");const i=e.renderer;if(!i)throw new Error("A renderer is needed for the raycaster to work!");this.world=e,this.mouse=new dl(i.three.domElement),this.components=t}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRay(t=Array.from(this.world.meshes)){if(!this.world)throw new Error("A world is needed to cast rays!");const e=this.world.camera.three;return this.three.setFromCamera(this.mouse.position,e),this.intersect(t)}castRayFromVector(t,e,i=Array.from(this.world.meshes)){return this.three.set(t,e),this.intersect(i)}intersect(t=Array.from(this.world.meshes)){const e=this.three.intersectObjects(t),i=this.filterClippingPlanes(e);return i.length>0?i[0]:null}filterClippingPlanes(t){if(!this.world.renderer)throw new Error("Renderer not found!");const e=this.world.renderer.three;if(!e.clippingPlanes)return t;const i=e.clippingPlanes;return t.length<=0||!i||(i==null?void 0:i.length)<=0?t:t.filter(s=>i.every(n=>n.distanceToPoint(s.point)>0))}}const yo=class Ro extends St{constructor(t){super(t),g(this,"enabled",!0),g(this,"list",new Map),g(this,"onDisposed",new $),t.add(Ro.uuid,this)}get(t){if(this.list.has(t.uuid))return this.list.get(t.uuid);const e=new ul(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}};g(yo,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let fn=yo;class pl{constructor(t,e,i){g(this,"onDisposed",new $),g(this,"world"),g(this,"components"),g(this,"three"),g(this,"_fade",3),g(this,"updateZoom",()=>{this.world.camera instanceof xi&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=e;const{color:s,size1:n,size2:r,distance:o}=i;this.components=t;const h=new ws(2,2,1,1),l=new $r({side:Li,uniforms:{uSize1:{value:n},uSize2:{value:r},uColor:{value:s},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new it(h,l),this.three.frustumCulled=!1,e.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(t){t?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(t){this._fade=t?3:0,this.material.uniforms.uFade.value=this._fade}dispose(){this.setupEvents(!1),this.components.get(ri).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(t){if(this.world.isDisposing||!(this.world.camera instanceof xi))return;const e=this.world.camera.controls;t?e.addEventListener("update",this.updateZoom):e.removeEventListener("update",this.updateZoom)}}const Fo=class So extends St{constructor(t){super(t),g(this,"list",new Map),g(this,"config",{color:new ie(12303291),size1:1,size2:10,distance:500}),g(this,"onDisposed",new $),g(this,"enabled",!0),t.add(So.uuid,this)}create(t){if(this.list.has(t.uuid))throw new Error("This world already has a grid!");const e=new pl(this.components,t,this.config);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};g(Fo,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");let ud=Fo;const Ne=new yn,Lt=new U,Ce=new U,yt=new te,Nr={X:new U(1,0,0),Y:new U(0,1,0),Z:new U(0,0,1)},Ks={type:"change"},xr={type:"mouseDown"},Pr={type:"mouseUp",mode:null},Lr={type:"objectChange"};class fl extends gs{constructor(t,e){super(),e===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document),this.isTransformControls=!0,this.visible=!1,this.domElement=e,this.domElement.style.touchAction="none";const i=new Tl;this._gizmo=i,this.add(i);const s=new _l;this._plane=s,this.add(s);const n=this;function r(C,R){let T=R;Object.defineProperty(n,C,{get:function(){return T!==void 0?T:R},set:function(y){T!==y&&(T=y,s[C]=y,i[C]=y,n.dispatchEvent({type:C+"-changed",value:y}),n.dispatchEvent(Ks))}}),n[C]=R,s[C]=R,i[C]=R}r("camera",t),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const o=new U,h=new U,l=new te,c=new te,p=new U,u=new te,d=new U,m=new U,f=new U,E=0,I=new U;r("worldPosition",o),r("worldPositionStart",h),r("worldQuaternion",l),r("worldQuaternionStart",c),r("cameraPosition",p),r("cameraQuaternion",u),r("pointStart",d),r("pointEnd",m),r("rotationAxis",f),r("rotationAngle",E),r("eye",I),this._offset=new U,this._startNorm=new U,this._endNorm=new U,this._cameraScale=new U,this._parentPosition=new U,this._parentQuaternion=new te,this._parentQuaternionInv=new te,this._parentScale=new U,this._worldScaleStart=new U,this._worldQuaternionInv=new te,this._worldScale=new U,this._positionStart=new U,this._quaternionStart=new te,this._scaleStart=new U,this._getPointer=ml.bind(this),this._onPointerDown=Il.bind(this),this._onPointerHover=El.bind(this),this._onPointerMove=gl.bind(this),this._onPointerUp=Cl.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;Ne.setFromCamera(t,this.camera);const e=qs(this._gizmo.picker[this.mode],Ne);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t.button!==0)&&this.axis!==null){Ne.setFromCamera(t,this.camera);const e=qs(this._plane,Ne,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,xr.mode=this.mode,this.dispatchEvent(xr)}}pointerMove(t){const e=this.axis,i=this.mode,s=this.object;let n=this.space;if(i==="scale"?n="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(n="world"),s===void 0||e===null||this.dragging===!1||t.button!==-1)return;Ne.setFromCamera(t,this.camera);const r=qs(this._plane,Ne,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),n==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),n==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(n==="local"&&(s.position.applyQuaternion(yt.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),n==="world"&&(s.parent&&s.position.add(Lt.setFromMatrixPosition(s.parent.matrixWorld)),e.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(Lt.setFromMatrixPosition(s.parent.matrixWorld))));else if(i==="scale"){if(e.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),Ce.set(o,o,o)}else Lt.copy(this.pointStart),Ce.copy(this.pointEnd),Lt.applyQuaternion(this._worldQuaternionInv),Ce.applyQuaternion(this._worldQuaternionInv),Ce.divide(Lt),e.search("X")===-1&&(Ce.x=1),e.search("Y")===-1&&(Ce.y=1),e.search("Z")===-1&&(Ce.z=1);s.scale.copy(this._scaleStart).multiply(Ce),this.scaleSnap&&(e.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(Lt.setFromMatrixPosition(this.camera.matrixWorld));let h=!1;e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Lt.copy(this.rotationAxis).cross(this.eye))*o):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(Nr[e]),Lt.copy(Nr[e]),n==="local"&&Lt.applyQuaternion(this.worldQuaternion),Lt.cross(this.eye),Lt.length()===0?h=!0:this.rotationAngle=this._offset.dot(Lt.normalize())*o),(e==="E"||h)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),n==="local"&&e!=="E"&&e!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(yt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(yt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Ks),this.dispatchEvent(Lr)}}pointerUp(t){t.button===0&&(this.dragging&&this.axis!==null&&(Pr.mode=this.mode,this.dispatchEvent(Pr)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}attach(t){return this.object=t,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Ks),this.dispatchEvent(Lr),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Ne}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}}function ml(a){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};{const t=this.domElement.getBoundingClientRect();return{x:(a.clientX-t.left)/t.width*2-1,y:-(a.clientY-t.top)/t.height*2+1,button:a.button}}}function El(a){if(this.enabled)switch(a.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(a));break}}function Il(a){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(a)),this.pointerDown(this._getPointer(a)))}function gl(a){this.enabled&&this.pointerMove(this._getPointer(a))}function Cl(a){this.enabled&&(this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(a)))}function qs(a,t,e){const i=t.intersectObject(a,!0);for(let s=0;s<i.length;s++)if(i[s].object.visible||e)return i[s];return!1}const as=new ma,It=new U(0,1,0),Mr=new U(0,0,0),Dr=new ut,hs=new te,ms=new te,le=new U,Ur=new ut,Oi=new U(1,0,0),xe=new U(0,1,0),bi=new U(0,0,1),ls=new U,yi=new U,Ri=new U;class Tl extends gs{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new ni({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new An({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=t.clone();i.opacity=.15;const s=e.clone();s.opacity=.5;const n=t.clone();n.color.setHex(16711680);const r=t.clone();r.color.setHex(65280);const o=t.clone();o.color.setHex(255);const h=t.clone();h.color.setHex(16711680),h.opacity=.5;const l=t.clone();l.color.setHex(65280),l.opacity=.5;const c=t.clone();c.color.setHex(255),c.opacity=.5;const p=t.clone();p.opacity=.25;const u=t.clone();u.color.setHex(16776960),u.opacity=.25,t.clone().color.setHex(16776960);const d=t.clone();d.color.setHex(7895160);const m=new Dt(0,.04,.1,12);m.translate(0,.05,0);const f=new Pt(.08,.08,.08);f.translate(0,.04,0);const E=new si;E.setAttribute("position",new tr([0,0,0,1,0,0],3));const I=new Dt(.0075,.0075,.5,3);I.translate(0,.25,0);function C(w,M){const Z=new di(w,.0075,3,64,M*Math.PI*2);return Z.rotateY(Math.PI/2),Z.rotateX(Math.PI/2),Z}function R(){const w=new si;return w.setAttribute("position",new tr([0,0,0,1,1,1],3)),w}const T={X:[[new it(m,n),[.5,0,0],[0,0,-Math.PI/2]],[new it(m,n),[-.5,0,0],[0,0,Math.PI/2]],[new it(I,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new it(m,r),[0,.5,0]],[new it(m,r),[0,-.5,0],[Math.PI,0,0]],[new it(I,r)]],Z:[[new it(m,o),[0,0,.5],[Math.PI/2,0,0]],[new it(m,o),[0,0,-.5],[-Math.PI/2,0,0]],[new it(I,o),null,[Math.PI/2,0,0]]],XYZ:[[new it(new ki(.1,0),p.clone()),[0,0,0]]],XY:[[new it(new Pt(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new it(new Pt(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new it(new Pt(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},y={X:[[new it(new Dt(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new it(new Dt(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new it(new Dt(.2,0,.6,4),i),[0,.3,0]],[new it(new Dt(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new it(new Dt(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new it(new Dt(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new it(new ki(.2,0),i)]],XY:[[new it(new Pt(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new it(new Pt(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new it(new Pt(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},O={START:[[new it(new ki(.01,2),s),null,null,null,"helper"]],END:[[new it(new ki(.01,2),s),null,null,null,"helper"]],DELTA:[[new Ie(R(),s),null,null,null,"helper"]],X:[[new Ie(E,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ie(E,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ie(E,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},A={XYZE:[[new it(C(.5,1),d),null,[0,Math.PI/2,0]]],X:[[new it(C(.5,.5),n)]],Y:[[new it(C(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new it(C(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new it(C(.75,1),u),null,[0,Math.PI/2,0]]]},N={AXIS:[[new Ie(E,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},b={XYZE:[[new it(new va(.25,10,8),i)]],X:[[new it(new di(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new it(new di(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new it(new di(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new it(new di(.75,.1,2,24),i)]]},P={X:[[new it(f,n),[.5,0,0],[0,0,-Math.PI/2]],[new it(I,n),[0,0,0],[0,0,-Math.PI/2]],[new it(f,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new it(f,r),[0,.5,0]],[new it(I,r)],[new it(f,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new it(f,o),[0,0,.5],[Math.PI/2,0,0]],[new it(I,o),[0,0,0],[Math.PI/2,0,0]],[new it(f,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new it(new Pt(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new it(new Pt(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new it(new Pt(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new it(new Pt(.1,.1,.1),p.clone())]]},z={X:[[new it(new Dt(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new it(new Dt(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new it(new Dt(.2,0,.6,4),i),[0,.3,0]],[new it(new Dt(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new it(new Dt(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new it(new Dt(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new it(new Pt(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new it(new Pt(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new it(new Pt(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new it(new Pt(.2,.2,.2),i),[0,0,0]]]},F={X:[[new Ie(E,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ie(E,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ie(E,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function x(w){const M=new gs;for(const Z in w)for(let V=w[Z].length;V--;){const J=w[Z][V][0].clone(),j=w[Z][V][1],nt=w[Z][V][2],k=w[Z][V][3],B=w[Z][V][4];J.name=Z,J.tag=B,j&&J.position.set(j[0],j[1],j[2]),nt&&J.rotation.set(nt[0],nt[1],nt[2]),k&&J.scale.set(k[0],k[1],k[2]),J.updateMatrix();const st=J.geometry.clone();st.applyMatrix4(J.matrix),J.geometry=st,J.renderOrder=1/0,J.position.set(0,0,0),J.rotation.set(0,0,0),J.scale.set(1,1,1),M.add(J)}return M}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=x(T)),this.add(this.gizmo.rotate=x(A)),this.add(this.gizmo.scale=x(P)),this.add(this.picker.translate=x(y)),this.add(this.picker.rotate=x(b)),this.add(this.picker.scale=x(z)),this.add(this.helper.translate=x(O)),this.add(this.helper.rotate=x(N)),this.add(this.helper.scale=x(F)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const e=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:ms;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let s=0;s<i.length;s++){const n=i[s];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(r*this.size/4),n.tag==="helper"){n.visible=!1,n.name==="AXIS"?(n.visible=!!this.axis,this.axis==="X"&&(yt.setFromEuler(as.set(0,0,0)),n.quaternion.copy(e).multiply(yt),Math.abs(It.copy(Oi).applyQuaternion(e).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Y"&&(yt.setFromEuler(as.set(0,0,Math.PI/2)),n.quaternion.copy(e).multiply(yt),Math.abs(It.copy(xe).applyQuaternion(e).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Z"&&(yt.setFromEuler(as.set(0,Math.PI/2,0)),n.quaternion.copy(e).multiply(yt),Math.abs(It.copy(bi).applyQuaternion(e).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="XYZE"&&(yt.setFromEuler(as.set(0,Math.PI/2,0)),It.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(Dr.lookAt(Mr,It,xe)),n.quaternion.multiply(yt),n.visible=this.dragging),this.axis==="E"&&(n.visible=!1)):n.name==="START"?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):n.name==="END"?(n.position.copy(this.worldPosition),n.visible=this.dragging):n.name==="DELTA"?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),Lt.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Lt.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(Lt),n.visible=this.dragging):(n.quaternion.copy(e),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=this.axis.search(n.name)!==-1));continue}n.quaternion.copy(e),this.mode==="translate"||this.mode==="scale"?(n.name==="X"&&Math.abs(It.copy(Oi).applyQuaternion(e).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Y"&&Math.abs(It.copy(xe).applyQuaternion(e).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Z"&&Math.abs(It.copy(bi).applyQuaternion(e).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XY"&&Math.abs(It.copy(bi).applyQuaternion(e).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="YZ"&&Math.abs(It.copy(Oi).applyQuaternion(e).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XZ"&&Math.abs(It.copy(xe).applyQuaternion(e).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)):this.mode==="rotate"&&(hs.copy(e),It.copy(this.eye).applyQuaternion(yt.copy(e).invert()),n.name.search("E")!==-1&&n.quaternion.setFromRotationMatrix(Dr.lookAt(this.eye,Mr,xe)),n.name==="X"&&(yt.setFromAxisAngle(Oi,Math.atan2(-It.y,It.z)),yt.multiplyQuaternions(hs,yt),n.quaternion.copy(yt)),n.name==="Y"&&(yt.setFromAxisAngle(xe,Math.atan2(It.x,It.z)),yt.multiplyQuaternions(hs,yt),n.quaternion.copy(yt)),n.name==="Z"&&(yt.setFromAxisAngle(bi,Math.atan2(It.y,It.x)),yt.multiplyQuaternions(hs,yt),n.quaternion.copy(yt))),n.visible=n.visible&&(n.name.indexOf("X")===-1||this.showX),n.visible=n.visible&&(n.name.indexOf("Y")===-1||this.showY),n.visible=n.visible&&(n.name.indexOf("Z")===-1||this.showZ),n.visible=n.visible&&(n.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some(function(o){return n.name===o}))&&(n.material.color.setHex(16776960),n.material.opacity=1)}super.updateMatrixWorld(t)}}class _l extends it{constructor(){super(new ws(1e5,1e5,2,2),new ni({visible:!1,wireframe:!0,side:Li,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),ls.copy(Oi).applyQuaternion(e==="local"?this.worldQuaternion:ms),yi.copy(xe).applyQuaternion(e==="local"?this.worldQuaternion:ms),Ri.copy(bi).applyQuaternion(e==="local"?this.worldQuaternion:ms),It.copy(yi),this.mode){case"translate":case"scale":switch(this.axis){case"X":It.copy(this.eye).cross(ls),le.copy(ls).cross(It);break;case"Y":It.copy(this.eye).cross(yi),le.copy(yi).cross(It);break;case"Z":It.copy(this.eye).cross(Ri),le.copy(Ri).cross(It);break;case"XY":le.copy(Ri);break;case"YZ":le.copy(ls);break;case"XZ":It.copy(Ri),le.copy(yi);break;case"XYZ":case"E":le.set(0,0,0);break}break;case"rotate":default:le.set(0,0,0)}le.length()===0?this.quaternion.copy(this.cameraQuaternion):(Ur.lookAt(Lt.set(0,0,0),le,It),this.quaternion.setFromRotationMatrix(Ur)),super.updateMatrixWorld(t)}}class Wn{constructor(t,e,i,s,n,r=5,o=!0){if(g(this,"onDraggingStarted",new $),g(this,"onDraggingEnded",new $),g(this,"onDisposed",new $),g(this,"normal"),g(this,"origin"),g(this,"three",new oi),g(this,"components"),g(this,"world"),g(this,"type","default"),g(this,"_helper"),g(this,"_visible",!0),g(this,"_enabled",!0),g(this,"_controlsActive",!1),g(this,"_arrowBoundBox",new it),g(this,"_planeMesh"),g(this,"_controls"),g(this,"_hiddenMaterial",new ni({visible:!1})),g(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),g(this,"changeDrag",h=>{this._visible=!h.value,this.preventCameraMovement(),this.notifyDraggingChanged(h)}),this.components=t,this.world=e,!e.renderer)throw new Error("The given world must have a renderer!");this.normal=s,this.origin=i,e.renderer.setPlane(!0,this.three),this._planeMesh=Wn.newPlaneMesh(r,n),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(s,i),o&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(t){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=t,this.world.renderer.setPlane(t,this.three)}get visible(){return this._visible}set visible(t){this._visible=t,this._controls.visible=t,this._helper.visible=t,this.toggleControls(t)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(t){this._planeMesh.material=t}get size(){return this._planeMesh.scale.x}set size(t){this._planeMesh.scale.set(t,t,t)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(t,e){this.reset(),this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const t=new U(1,0,0),e=new U;this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix()}toggleControls(t){if(t){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=t}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const t=this.world.camera.three,e=this.world.renderer.three.domElement,i=new fl(t,e);return this.initializeControls(i),this.world.scene.three.add(i),i}initializeControls(t){t.attach(this._helper),t.showX=!1,t.showY=!1,t.setSpace("local"),this.createArrowBoundingBox(),t.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new Dt(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(t){t.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const t=new gs;return t.lookAt(this.normal),t.position.copy(this.origin),this._planeMesh.position.z+=.01,t.add(this._planeMesh),this.world.scene.three.add(t),t}static newPlaneMesh(t,e){const i=new ws(1),s=new it(i,e);return s.scale.set(t,t,t),s}}const Ao=class mn extends St{constructor(t){super(t),g(this,"onBeforeDrag",new $),g(this,"onAfterDrag",new $),g(this,"onBeforeCreate",new $),g(this,"onBeforeCancel",new $),g(this,"onAfterCancel",new $),g(this,"onBeforeDelete",new $),g(this,"onAfterCreate",new $),g(this,"onAfterDelete",new $),g(this,"onDisposed",new $),g(this,"orthogonalY",!1),g(this,"toleranceOrthogonalY",.7),g(this,"Type",Wn),g(this,"list",[]),g(this,"_material",new ni({color:12255487,side:Li,transparent:!0,opacity:.2})),g(this,"_size",5),g(this,"_enabled",!1),g(this,"_visible",!0),g(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),g(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(mn.uuid,this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t;for(const e of this.list)e.enabled=t;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(t){this._visible=t;for(const e of this.list)e.visible=t}get material(){return this._material}set material(t){this._material=t;for(const e of this.list)e.planeMaterial=t}get size(){return this._size}set size(t){this._size=t;for(const e of this.list)e.size=t}dispose(){this._enabled=!1;for(const t of this.list)t.dispose();this.list.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(mn.uuid),this.onDisposed.reset()}create(t){const e=this.components.get(fn).get(t).castRay();return e?this.createPlaneFromIntersection(t,e):null}createFromNormalAndCoplanarPoint(t,e,i){const s=this.newPlane(t,i,e);return this.updateMaterialsAndPlanes(),s}delete(t,e){e||(e=this.pickPlane(t)),e&&this.deletePlane(e)}deleteAll(t){const e=[...this.list];for(const i of e)if(!t||t.has(i.type)){this.delete(i.world,i);const s=this.list.indexOf(i);s!==-1&&this.list.splice(s,1)}}deletePlane(t){const e=this.list.indexOf(t);if(e!==-1){if(this.list.splice(e,1),!t.world.renderer)throw new Error("Renderer not found for this plane's world!");t.world.renderer.setPlane(!1,t.three),t.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(t)}}pickPlane(t){const e=this.components.get(fn).get(t),i=this.getAllPlaneMeshes(),s=e.castRay(i);if(s){const n=s.object;return this.list.find(r=>r.meshes.includes(n))}}getAllPlaneMeshes(){const t=[];for(const e of this.list)t.push(...e.meshes);return t}createPlaneFromIntersection(t,e){var i;if(!t.renderer)throw new Error("The given world must have a renderer!");const s=e.point.distanceTo(new U(0,0,0)),n=(i=e.face)==null?void 0:i.normal;if(!s||!n)return null;const r=this.getWorldNormal(e,n),o=this.newPlane(t,e.point,r.negate());return o.visible=this._visible,o.size=this._size,t.renderer.setPlane(!0,o.three),this.updateMaterialsAndPlanes(),o}getWorldNormal(t,e){const i=t.object;let s=t.object.matrixWorld.clone();if(i instanceof Me&&t.instanceId!==void 0){const o=new ut;i.getMatrixAt(t.instanceId,o),s=o.multiply(s)}const n=new Pe().getNormalMatrix(s),r=e.clone().applyMatrix3(n).normalize();return this.normalizePlaneDirectionY(r),r}normalizePlaneDirectionY(t){this.orthogonalY&&(t.y>this.toleranceOrthogonalY&&(t.x=0,t.y=1,t.z=0),t.y<-this.toleranceOrthogonalY&&(t.x=0,t.y=-1,t.z=0))}newPlane(t,e,i){const s=new this.Type(this.components,t,e,i,this._material);return s.onDraggingStarted.add(this._onStartDragging),s.onDraggingEnded.add(this._onEndDragging),this.list.push(s),this.onAfterCreate.trigger(s),s}updateMaterialsAndPlanes(){const t=this.components.get(nl);for(const[e,i]of t.list){if(!i.renderer)continue;i.renderer.updateClippingPlanes();const{clippingPlanes:s}=i.renderer;for(const n of i.meshes)if(n.material)if(Array.isArray(n.material))for(const r of n.material)r.clippingPlanes=s;else n.material.clippingPlanes=s}}};g(Ao,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let wl=Ao;class yl{constructor(t){g(this,"enabled",!1),g(this,"id","FirstPerson"),this.camera=t}set(t){if(this.enabled=t,t){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const t=this.camera.controls,e=new U;t.distance--,t.getPosition(e),t.minDistance=1,t.maxDistance=1,t.distance=1,t.moveTo(e.x,e.y,e.z),t.truckSpeed=50,t.mouseButtons.wheel=Mt.ACTION.DOLLY,t.touches.two=Mt.ACTION.TOUCH_ZOOM_TRUCK}}class Rl{constructor(t){g(this,"enabled",!0),g(this,"id","Orbit"),this.camera=t,this.activateOrbitControls()}set(t){this.enabled=t,t&&this.activateOrbitControls()}activateOrbitControls(){const t=this.camera.controls;t.minDistance=1,t.maxDistance=300;const e=new U;t.getPosition(e);const i=e.length();t.distance=i,t.truckSpeed=2;const{rotation:s}=this.camera.three,n=new U(0,0,-1).applyEuler(s),r=e.addScaledVector(n,i);t.moveTo(r.x,r.y,r.z)}}class Fl{constructor(t){g(this,"enabled",!1),g(this,"id","Plan"),g(this,"mouseAction1"),g(this,"mouseAction2"),g(this,"mouseInitialized",!1),g(this,"defaultAzimuthSpeed"),g(this,"defaultPolarSpeed"),this.camera=t,this.defaultAzimuthSpeed=t.controls.azimuthRotateSpeed,this.defaultPolarSpeed=t.controls.polarRotateSpeed}set(t){this.enabled=t;const e=this.camera.controls;e.azimuthRotateSpeed=t?0:this.defaultAzimuthSpeed,e.polarRotateSpeed=t?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=e.touches.one,this.mouseAction2=e.touches.two,this.mouseInitialized=!0),t?(e.mouseButtons.left=Mt.ACTION.TRUCK,e.touches.one=Mt.ACTION.TOUCH_TRUCK,e.touches.two=Mt.ACTION.TOUCH_ZOOM):(e.mouseButtons.left=Mt.ACTION.ROTATE,e.touches.one=this.mouseAction1,e.touches.two=this.mouseAction2)}}class Sl{constructor(t){g(this,"onChanged",new $),g(this,"current","Perspective"),g(this,"camera"),g(this,"matchOrthoDistanceEnabled",!1),g(this,"_component"),g(this,"_previousDistance",-1),this._component=t,this.camera=t.three}async set(t){this.current!==t&&(t==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const t=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(t)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const t=this.getPerspectiveDims();if(!t)return;const{width:e,height:i}=t;this.setupOrthoCamera(i,e),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const t=this._component.currentWorld;if(!t||!t.renderer)return null;const e=new U;this._component.threePersp.getWorldDirection(e);const i=new U;this._component.controls.getTarget(i);const s=i.clone().sub(this._component.threePersp.position).dot(e),n=t.renderer.getSize(),r=n.x/n.y,o=this._component.threePersp,h=s*2*Math.atan(o.fov*(Math.PI/180)/2);return{width:h*r,height:h}}setupOrthoCamera(t,e){this._component.controls.mouseButtons.wheel=Mt.ACTION.ZOOM,this._component.controls.mouseButtons.middle=Mt.ACTION.ZOOM;const i=this._component.threePersp,s=this._component.threeOrtho;s.zoom=1,s.left=e/-2,s.right=e/2,s.top=t/2,s.bottom=t/-2,s.updateProjectionMatrix(),s.position.copy(i.position),s.quaternion.copy(i.quaternion),this._component.controls.camera=s}getDistance(){const t=this._component.threePersp,e=this._component.threeOrtho;return(e.top-e.bottom)/e.zoom/(2*Math.atan(t.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=Mt.ACTION.DOLLY,this._component.controls.mouseButtons.middle=Mt.ACTION.DOLLY;const t=this._component.threePersp,e=this._component.threeOrtho;t.position.copy(e.position),t.quaternion.copy(e.quaternion),this._component.controls.mouseButtons.wheel=Mt.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),t.updateProjectionMatrix(),this._component.controls.camera=t,this.camera=t,this.current="Perspective"}}class Al extends xi{constructor(t){super(t),g(this,"projection"),g(this,"threeOrtho"),g(this,"threePersp"),g(this,"_userInputButtons",{}),g(this,"_frustumSize",50),g(this,"_navigationModes",new Map),g(this,"_mode",null),g(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new Sl(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(e=>{this.three=e,this.updateAspect()}),this.onWorldChanged.add(({action:e})=>{e==="added"&&(this._navigationModes.clear(),this._navigationModes.set("Orbit",new Rl(this)),this._navigationModes.set("FirstPerson",new yl(this)),this._navigationModes.set("Plan",new Fl(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone()))})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(t){if(this.mode!==null&&this.mode.id!==t){if(this.mode.set(!1),!this._navigationModes.has(t))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(t),this.mode.set(!0)}}async fit(t,e=1.5){if(!this.enabled)return;const i=Number.MAX_VALUE,s=Number.MIN_VALUE,n=new U(i,i,i),r=new U(s,s,s);for(const u of t){const d=new Nt().setFromObject(u);d.min.x<n.x&&(n.x=d.min.x),d.min.y<n.y&&(n.y=d.min.y),d.min.z<n.z&&(n.z=d.min.z),d.max.x>r.x&&(r.x=d.max.x),d.max.y>r.y&&(r.y=d.max.y),d.max.z>r.z&&(r.z=d.max.z)}const o=new Nt(n,r),h=new U;o.getSize(h);const l=new U;o.getCenter(l);const c=Math.max(h.x,h.y,h.z)*e,p=new Ts(l,c);await this.controls.fitToSphere(p,!0)}setUserInput(t){t?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const t=window.innerWidth/window.innerHeight;return new De(this._frustumSize*t/-2,this._frustumSize*t/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const t=this.currentWorld.renderer.getSize(),e=this.threeOrtho.top,i=this.threeOrtho.right,s=t.y/this.previousSize.y,n=t.x/this.previousSize.x,r=e*s,o=i*n;this.threeOrtho.left=-o,this.threeOrtho.right=o,this.threeOrtho.top=r,this.threeOrtho.bottom=-r,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(t)}}const Br=new Map([[Di,{forRelated:"Decomposes",forRelating:"IsDecomposedBy"}],[On,{forRelated:"HasAssociations",forRelating:"AssociatedTo"}],[bn,{forRelated:"HasAssociations",forRelating:"ClassificationForObjects"}],[vn,{forRelated:"HasAssignments",forRelating:"IsGroupedBy"}],[Ui,{forRelated:"IsDefinedBy",forRelating:"DefinesOcurrence"}],[Nn,{forRelated:"IsTypedBy",forRelating:"Types"}],[xn,{forRelated:"IsDefinedBy",forRelating:"Defines"}],[Mi,{forRelated:"ContainedInStructure",forRelating:"ContainsElements"}],[Pn,{forRelated:"AssignedToFlowElement",forRelating:"HasControlElements"}],[Ln,{forRelated:"ConnectedFrom",forRelating:"ConnectedTo"}],[Mn,{forRelated:"HasAssignments",forRelating:"ReferencedBy"}],[Dn,{forRelated:"HasContext",forRelating:"Declares"}],[Un,{forRelated:"HasAssignments",forRelating:"Controls"}],[Bn,{forRelated:"Nests",forRelating:"IsNestedBy"}],[zn,{forRelated:"HasAssociations",forRelating:"DocumentRefForObjects"}]]),Oo={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};class ii{static async getUnits(t){var e,i,s;const{IFCUNITASSIGNMENT:n}=Qt,r=await t.getAllPropertiesOfType(n);if(!r)return 1;const o=Object.keys(r),h=r[parseInt(o[0],10)];for(const l of h.Units){if(l.value===void 0||l.value===null)continue;const c=await t.getProperties(l.value);if(!c||!c.UnitType||!c.UnitType.value||c.UnitType.value!=="LENGTHUNIT")continue;let p=1,u=1;return c.Name.value==="METRE"&&(u=1),c.Name.value==="FOOT"&&(u=.3048),((e=c.Prefix)==null?void 0:e.value)==="MILLI"?p=.001:((i=c.Prefix)==null?void 0:i.value)==="CENTI"?p=.01:((s=c.Prefix)==null?void 0:s.value)==="DECI"&&(p=.1),u*p}return 1}static async findItemByGuid(t,e){var i;const s=t.getAllPropertiesIDs();for(const n of s){const r=await t.getProperties(n);if(r&&((i=r.GlobalId)==null?void 0:i.value)===e)return r}return null}static async getRelationMap(t,e,i){var s;const n=i??(async()=>{}),r={},o=t.getAllPropertiesIDs();for(const h of o){const l=await t.getProperties(h);if(!l)continue;const c=l.type===e,p=Object.keys(l).find(E=>E.startsWith("Relating")),u=Object.keys(l).find(E=>E.startsWith("Related"));if(!(c&&p&&u))continue;const d=await t.getProperties((s=l[p])==null?void 0:s.value),m=l[u];if(!d||!m||!(m&&Array.isArray(m)))continue;const f=m.map(E=>E.value);await n(d.expressID,f),r[d.expressID]=f}return r}static async getQsetQuantities(t,e,i){const s=i??(()=>{}),n=await t.getProperties(e);return!n||n.type!==Aa?null:(n.Quantities??[{}]).map(r=>(r.value&&s(r.value),r.value)).filter(r=>r!==null)}static async getPsetProps(t,e,i){const s=i??(()=>{}),n=await t.getProperties(e);return!n||n.type!==tn?null:(n.HasProperties??[{}]).map(r=>(r.value&&s(r.value),r.value)).filter(r=>r!==null)}static async getPsetRel(t,e){var i;if(!await t.getProperties(e))return null;const s=await t.getAllPropertiesOfType(Ui);if(!s)return null;const n=Object.values(s);let r=null;for(const o of n)((i=o.RelatingPropertyDefinition)==null?void 0:i.value)===e&&(r=o.expressID);return r}static async getQsetRel(t,e){return ii.getPsetRel(t,e)}static async getEntityName(t,e){var i;const s=await t.getProperties(e);if(!s)return{key:null,name:null};const n=Object.keys(s).find(o=>o.endsWith("Name"))??null,r=n?(i=s[n])==null?void 0:i.value:null;return{key:n,name:r}}static async getQuantityValue(t,e){const i=await t.getProperties(e);if(!i)return{key:null,value:null};const s=Object.keys(i).find(r=>r.endsWith("Value"))??null;let n;return s===null||i[s]===void 0||i[s]===null?n=null:n=i[s].value,{key:s,value:n}}static isRel(t){return Oo[t].startsWith("IFCREL")}static async attributeExists(t,e,i){const s=await t.getProperties(e);return s?Object.keys(s).includes(i):!1}static async groupEntitiesByType(t,e){var i;const s=new Map;for(const n of e){const r=await t.getProperties(n);if(!r)continue;const o=r.type;s.get(o)||s.set(o,new Set),(i=s.get(o))==null||i.add(n)}return s}}let Ol=class{constructor(){g(this,"factor",1),g(this,"complement",1)}apply(a){const t=this.getScaleMatrix().multiply(a);a.copy(t)}setUp(a){var t,e,i;this.factor=1;const s=this.getLengthUnits(a);if(!s)return;const n=s==null,r=s.Name===void 0||s.Name===null;n||r||(s.Name.value==="FOOT"&&(this.factor=.3048),((t=s.Prefix)==null?void 0:t.value)==="MILLI"?this.complement=.001:((e=s.Prefix)==null?void 0:e.value)==="CENTI"?this.complement=.01:((i=s.Prefix)==null?void 0:i.value)==="DECI"&&(this.complement=.01))}getLengthUnits(a){try{const t=a.GetLineIDsWithType(0,so).get(0),e=a.GetLine(0,t);for(const i of e.Units){if(!i||i.value===null||i.value===void 0)continue;const s=a.GetLine(0,i.value);if(s.UnitType&&s.UnitType.value==="LENGTHUNIT")return s}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const a=this.factor;return new ut().fromArray([a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1])}},bo=class{constructor(){g(this,"itemsByFloor",{}),g(this,"_units",new Ol)}setUp(a){this._units.setUp(a),this.cleanUp();try{const t=a.GetLineIDsWithType(0,Mi),e=new Set,i=a.GetLineIDsWithType(0,re);for(let h=0;h<i.size();h++)e.add(i.get(h));const s=a.GetLineIDsWithType(0,Di),n=s.size();for(let h=0;h<n;h++){const l=s.get(h),c=a.GetLine(0,l);if(!c||!c.RelatingObject||!c.RelatedObjects)continue;const p=c.RelatingObject.value,u=c.RelatedObjects;for(const d of u){const m=d.value;e.has(m)&&(this.itemsByFloor[m]=p)}}const r={},o=t.size();for(let h=0;h<o;h++){const l=t.get(h),c=a.GetLine(0,l);if(!c||!c.RelatingStructure||!c.RelatedElements)continue;const p=c.RelatingStructure.value,u=c.RelatedElements;if(e.has(p))for(const d of u){r[p]||(r[p]=[]);const m=d.value;r[p].push(m)}else for(const d of u){const m=d.value;this.itemsByFloor[m]=p}}for(const h in r){const l=this.itemsByFloor[h];if(l!==void 0){const c=r[h];for(const p of c)this.itemsByFloor[p]=l}}for(let h=0;h<n;h++){const l=s.get(h),c=a.GetLine(0,l);if(!c||!c.RelatingObject||!c.RelatedObjects)continue;const p=c.RelatingObject.value,u=c.RelatedObjects;for(const d of u){const m=d.value,f=this.itemsByFloor[p];f!==void 0&&(this.itemsByFloor[m]=f)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}},jn=class{constructor(){g(this,"includeProperties",!0),g(this,"optionalCategories",[re]),g(this,"coordinate",!0),g(this,"wasm",{path:"",absolute:!1,logLevel:Qr.LOG_LEVEL_OFF}),g(this,"excludedCategories",new Set),g(this,"includedCategories",new Set),g(this,"saveLocations",!1),g(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),g(this,"autoSetWasm",!0),g(this,"customLocateFileHandler",null)}},vo=class{constructor(){g(this,"defLineMat",new An({color:16777215}))}read(a){const t=a.GetAllAlignments(0),e=a.GetAllCrossSections2D(0),i=a.GetAllCrossSections3D(0),s={IfcAlignment:t,IfcCrossSection2D:e,IfcCrossSection3D:i};return this.get(s)}get(a){if(a.IfcAlignment){const t=new Map;for(const e of a.IfcAlignment){const i=new Kr;i.absolute=this.getCurves(e.curve3D,i),i.horizontal=this.getCurves(e.horizontal,i),i.vertical=this.getCurves(e.vertical,i),t.set(t.size,i)}return{alignments:t,coordinationMatrix:new ut}}}getCurves(a,t){const e=[];let i=0;for(const s of a){const n={};if(s.data)for(const p of s.data){const[u,d]=p.split(": "),m=parseFloat(d);n[u]=m||d}const{points:r}=s,o=new Float32Array(r.length*3);for(let p=0;p<r.length;p++){const{x:u,y:d,z:m}=r[p];o[p*3]=u,o[p*3+1]=d,o[p*3+2]=m||0}const h=new Fe(o,3),l=new qr;l.setAttribute("position",h);const c=new Jr(i,n,t,l,this.defLineMat);e.push(c.curve),i++}return e}},No=class{getNameInfo(a){var t;const e={},{arguments:i}=a.GetHeaderLine(0,to)||{};if(!i)return e;const[s,n,r,o,h,l,c]=i;if(s!=null&&s.value&&(e.name=s.value),n!=null&&n.value&&(e.creationDate=new Date(n.value)),r){e.author={};const[p,u]=r;p!=null&&p.value&&(e.author.name=p.value),u!=null&&u.value&&(e.author.email=u.value)}return(t=o[0])!=null&&t.value&&(e.organization=o[0].value),h!=null&&h.value&&(e.preprocessorVersion=h==null?void 0:h.value),l!=null&&l.value&&(e.originatingSystem=l==null?void 0:l.value),c!=null&&c.value&&(e.authorization=c==null?void 0:c.value),e}getDescriptionInfo(a){var t;const e={},{arguments:i}=a.GetHeaderLine(0,eo)||{};if(!i)return e;const[s,n]=i;if((t=s[0])!=null&&t.value){const r=s[0].value.match(/\[([^\]]+)\]/);r&&r[1]&&(e.viewDefinition=r[1])}return n!=null&&n.value&&(e.implementationLevel=n.value),e}},xo=class{static get(a,t){const e=[ys,Rs,Fs,Ss,re,no,ro,oo,ao],i=a.data;for(const s of e){const n=t.GetLineIDsWithType(0,s),r=n.size();for(let o=0;o<r;o++){const h=n.get(o);i.has(h)||i.set(h,[[],[0,s]])}}}};const Po=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]),Lo=class Mo extends St{constructor(t){super(t),g(this,"enabled",!0),t.add(Mo.uuid,this)}async export(t,e,i=!1,s=!0){const n={},r=new Set(t.GetIfcEntityList(e)),o=new Set([ys,Rs,Fs,Ss,re]);for(const h of o)r.add(h);for(const h of r){if(Po.has(h))continue;const l=o.has(h)&&s,c=t.GetLineIDsWithType(e,h);for(const p of c){const u=t.GetLine(0,p,l,i);n[u.expressID]=u}}return n}};g(Lo,"uuid","b32c4332-cd67-436e-ba7f-196646c7a635");let Do=Lo;var Fi;let bl=(Fi=class extends St{constructor(a){super(a),g(this,"onDisposed",new $),g(this,"onIfcStartedLoading",new $),g(this,"onSetup",new $),g(this,"settings",new jn),g(this,"webIfc",new Re),g(this,"enabled",!0),g(this,"_material",new Is),g(this,"_spatialTree",new bo),g(this,"_metaData",new No),g(this,"_fragmentInstances",new Map),g(this,"_civil",new vo),g(this,"_visitedFragments",new Map),g(this,"_materialT",new Is({transparent:!0,opacity:.5})),this.components.add(Fi.uuid,this),this.settings.excludedCategories.add(Fn)}dispose(){this.webIfc=null,this.onDisposed.trigger(Fi.uuid),this.onDisposed.reset()}async setup(a){this.settings={...this.settings,...a},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(a,t=!0){const e=performance.now();this.onIfcStartedLoading.trigger(),await this.readIfcFile(a);const i=await this.getAllGeometries(),s=await this.components.get(Do).export(this.webIfc,0);i.setLocalProperties(s);const n=this.components.get(Tt);n.groups.set(i.uuid,i);for(const r of i.items)n.list.set(r.id,r),r.mesh.uuid=r.id,r.group=i;n.onFragmentsLoaded.trigger(i),t&&n.coordinate([i]);for(const[r]of i.data){const o=s[r];if(!o||!o.GlobalId)continue;const h=o.GlobalId.value||o.GlobalId;i.globalToExpressIDs.set(h,r)}return xo.get(i,this.webIfc),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-e} ms!`),i}async readIfcFile(a){const{path:t,absolute:e,logLevel:i}=this.settings.wasm;return this.webIfc.SetWasmPath(t,e),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(a,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new Re,this._visitedFragments.clear(),this._fragmentInstances.clear()}async getAllGeometries(){this._spatialTree.setUp(this.webIfc);const a=this.webIfc.GetIfcEntityList(0),t=new Sn;t.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};const e=[];for(const s of a){if(!this.webIfc.IsIfcElement(s)&&s!==re)continue;const n=this.settings.includedCategories;if(n.size>0&&!n.has(s)||this.settings.excludedCategories.has(s))continue;const r=this.webIfc.GetLineIDsWithType(0,s),o=r.size();for(let h=0;h<o;h++){const l=r.get(h);e.push(l);const c=this._spatialTree.itemsByFloor[l]||0;t.data.set(l,[[],[c,s]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,e,s=>{this.getMesh(s,t)});for(const s of this._visitedFragments){const{index:n,fragment:r}=s[1];t.keyFragments.set(n,r.id)}for(const s of t.items){const n=this._fragmentInstances.get(s.id);if(!n)throw new Error("Fragment not found!");const r=[];for(const[o,h]of n)r.push(h);s.add(r)}const i=this.webIfc.GetCoordinationMatrix(0);return t.coordinationMatrix.fromArray(i),t.civilData=this._civil.read(this.webIfc),t}getMesh(a,t){const e=a.geometries.size(),i=a.expressID;for(let s=0;s<e;s++){const n=a.geometries.get(s),{x:r,y:o,z:h,w:l}=n.color,c=l!==1,{geometryExpressID:p}=n,u=`${p}-${c}`;if(!this._visitedFragments.has(u)){const R=this.getGeometry(this.webIfc,p),T=c?this._materialT:this._material,y=new Zr(R,T,1);t.add(y.mesh),t.items.push(y);const O=this._visitedFragments.size;this._visitedFragments.set(u,{index:O,fragment:y})}const d=new ie().setRGB(r,o,h,"srgb"),m=new ut;m.fromArray(n.flatTransformation);const f=this._visitedFragments.get(u);if(f===void 0)throw new Error("Error getting geometry data for streaming!");const E=t.data.get(i);if(!E)throw new Error("Data not found!");E[0].push(f.index);const{fragment:I}=f;this._fragmentInstances.has(I.id)||this._fragmentInstances.set(I.id,new Map);const C=this._fragmentInstances.get(I.id);if(!C)throw new Error("Instances not found!");if(C.has(i)){const R=C.get(i);if(!R)throw new Error("Instance not found!");R.transforms.push(m),R.colors&&R.colors.push(d)}else C.set(i,{id:i,transforms:[m],colors:[d]})}}getGeometry(a,t){const e=a.GetGeometry(0,t),i=a.GetIndexArray(e.GetIndexData(),e.GetIndexDataSize()),s=a.GetVertexArray(e.GetVertexData(),e.GetVertexDataSize()),n=new Float32Array(s.length/2),r=new Float32Array(s.length/2);for(let c=0;c<s.length;c+=6)n[c/2]=s[c],n[c/2+1]=s[c+1],n[c/2+2]=s[c+2],r[c/2]=s[c+3],r[c/2+1]=s[c+4],r[c/2+2]=s[c+5];const o=new si,h=new Fe(n,3),l=new Fe(r,3);return o.setAttribute("position",h),o.setAttribute("normal",l),o.setIndex(Array.from(i)),e.delete(),o}async autoSetWasm(){const a=await fetch(`https://unpkg.com/@thatopen/components@${Eo.release}/package.json`);if(!a.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const t=await a.json();if(!("web-ifc"in t.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const e=t.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${e}/`,this.settings.wasm.absolute=!0}}},g(Fi,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624"),Fi);const vl={IfcRelAssignsToControl:{related:5,relating:7},IfcRelAssignsToGroup:{related:5,relating:7},IfcRelAssignsToProduct:{related:5,relating:7},IfcRelAssociatesClassification:{related:5,relating:6},IfcRelAssociatesMaterial:{related:5,relating:6},IfcRelAssociatesDocument:{related:5,relating:6},IfcRelContainedInSpatialStructure:{related:5,relating:6},IfcRelFlowControlElements:{related:5,relating:6},IfcRelConnectsElements:{related:7,relating:6},IfcRelDeclares:{related:6,relating:5},IfcRelAggregates:{related:6,relating:5},IfcRelNests:{related:6,relating:5},IfcRelDefinesByProperties:{related:5,relating:6},IfcRelDefinesByType:{related:5,relating:6},IfcRelDefinesByTemplate:{related:5,relating:6}},Nl={[Un]:"IfcRelAssignsToControl",[vn]:"IfcRelAssignsToGroup",[Mn]:"IfcRelAssignsToProduct",[bn]:"IfcRelAssociatesClassification",[On]:"IfcRelAssociatesMaterial",[zn]:"IfcRelAssociatesDocument",[Mi]:"IfcRelContainedInSpatialStructure",[Ln]:"IfcRelConnectsElements",[Pn]:"IfcRelFlowControlElements",[Dn]:"IfcRelDeclares",[Di]:"IfcRelAggregates",[Bn]:"IfcRelNests",[Ui]:"IfcRelDefinesByProperties",[Nn]:"IfcRelDefinesByType",[xn]:"IfcRelDefinesByTemplate"},Uo=class qe extends St{constructor(t){super(t),g(this,"onDisposed",new $),g(this,"onRequestFile",new $),g(this,"ifcToExport",null),g(this,"onElementToPset",new $),g(this,"onPropToPset",new $),g(this,"onPsetRemoved",new $),g(this,"onDataChanged",new $),g(this,"wasm",{path:"/",absolute:!1}),g(this,"enabled",!0),g(this,"attributeListeners",{}),g(this,"selectedModel"),g(this,"changeMap",{}),this.components.add(qe.uuid,this)}dispose(){this.selectedModel=void 0,this.attributeListeners={},this.changeMap={},this.onElementToPset.reset(),this.onPropToPset.reset(),this.onPsetRemoved.reset(),this.onDataChanged.reset(),this.onDisposed.trigger(qe.uuid),this.onDisposed.reset()}static getIFCSchema(t){const e=t.ifcMetadata.schema;if(!e)throw new Error("IFC Schema not found");return e.startsWith("IFC2X3")?"IFC2X3":e.startsWith("IFC4")&&e.replace("IFC4","")===""?"IFC4":e.startsWith("IFC4X3")?"IFC4X3":e}async setData(t,...e){for(const i of e){const{expressID:s}=i;(!s||s===-1)&&(i.expressID=this.getNewExpressID(t)),await t.setProperties(i.expressID,i),this.registerChange(t,i.expressID)}}async newPset(t,e,i){const s=qe.getIFCSchema(t),{ownerHistoryHandle:n}=await this.getOwnerHistory(t),r=this.newGUID(t),o=new Qt[s].IfcLabel(e),h=i?new Qt[s].IfcText(i):null,l=new Qt[s].IfcPropertySet(r,n,o,h,[]);l.expressID=this.getNewExpressID(t);const c=this.newGUID(t),p=new Qt[s].IfcRelDefinesByProperties(c,n,null,null,[],new fe(l.expressID));return p.expressID=this.getNewExpressID(t),await this.setData(t,l,p),{pset:l,rel:p}}async removePset(t,...e){for(const i of e){const s=await t.getProperties(i);if((s==null?void 0:s.type)!==tn)continue;const n=await ii.getPsetRel(t,i);if(n&&(await t.setProperties(n,null),this.registerChange(t,n)),s){for(const r of s.HasProperties)await t.setProperties(r.value,null);await t.setProperties(i,null),this.onPsetRemoved.trigger({model:t,psetID:i}),this.registerChange(t,i)}}}newSingleStringProperty(t,e,i,s){return this.newSingleProperty(t,e,i,s)}newSingleNumericProperty(t,e,i,s){return this.newSingleProperty(t,e,i,s)}newSingleBooleanProperty(t,e,i,s){return this.newSingleProperty(t,e,i,s)}async removePsetProp(t,e,i){const s=await t.getProperties(e),n=await t.getProperties(i);!s||!n||s.type===tn&&n&&(s.HasProperties=s.HasProperties.filter(r=>r.value!==i),await t.setProperties(i,null),this.registerChange(t,e,i))}addElementToPset(t,e,...i){this.components.get(Pi).addEntitiesRelation(t,e,{type:Ui,inv:"IsDefinedBy"},...i)}async addPropToPset(t,e,...i){const s=await t.getProperties(e);if(s){for(const n of i){if(s.HasProperties.includes(n))continue;const r=new fe(n);s.HasProperties.push(r),this.onPropToPset.trigger({model:t,psetID:e,propID:n})}this.registerChange(t,e)}}async createIfcRel(t,e,i,s){const n=Nl[e];if(!n)throw new Error(`IfcPropertiesManager: ${n} is unsoported.`);const r=t.ifcMetadata.schema,o=vl[n],h=Qt[r][n];if(!(o&&h))throw new Error(`IfcPropertiesManager: ${n} is unsoported.`);const l=[new Qt[r].IfcGloballyUniqueId(Ue.create())],{related:c,relating:p}=o,u=[...new Set(s)].map(f=>new fe(f)),d=(f,E)=>{for(let I=f;I<E-1;I++)l.push(null)};c<p?(d(1,c),l.push(u),d(c,p),l.push(new fe(i))):(d(1,p),d(p,c),l.push(new fe(i)),l.push(u));const m=new h(...l);return await this.setData(t,m),m}async saveToIfc(t,e){const i=this.components.get(bl),s=i.webIfc,n=await i.readIfcFile(e);await this.components.get(Pi).applyRelationChanges();const r=this.changeMap[t.uuid]??[];for(const h of r){const l=await t.getProperties(h);l?s.WriteLine(n,l):s.DeleteLine(n,h)}const o=s.SaveModel(n);return i.webIfc.CloseModel(n),i.cleanUp(),o}async getEntityRef(t,e){const i=await t.getAllPropertiesOfType(e);if(!i)return null;const s=[];for(const n in i){const r=new fe(Number(n));s.push(r)}return s}async setAttributeListener(t,e,i){this.attributeListeners[t.uuid]||(this.attributeListeners[t.uuid]={});const s=this.attributeListeners[t.uuid][e]?this.attributeListeners[t.uuid][e][i]:null;if(s)return s;const n=await t.getProperties(e);if(!n)throw new Error(`Entity with expressID ${e} doesn't exists.`);const r=n[i];if(Array.isArray(r)||!r)throw new Error(`Attribute ${i} is array or null, and it can't have a listener.`);const o=r.value;if(o===void 0||o==null)throw new Error(`Attribute ${i} has a badly defined handle.`);const h=new $;return Object.defineProperty(n[i],"value",{get(){return this._value},async set(l){this._value=l,h.trigger(l)}}),n[i].value=o,this.attributeListeners[t.uuid][e]||(this.attributeListeners[t.uuid][e]={}),this.attributeListeners[t.uuid][e][i]=h,h}getNewExpressID(t){return t.ifcMetadata.maxExpressID++,t.ifcMetadata.maxExpressID}newGUID(t){const e=qe.getIFCSchema(t);return new Qt[e].IfcGloballyUniqueId(Ue.create())}async getOwnerHistory(t){const e=await t.getAllPropertiesOfType(Ra);if(!e)throw new Error("No OwnerHistory was found.");const i=Object.keys(e).map(r=>parseInt(r,10)),s=e[i[0]],n=new fe(s.expressID);return{ownerHistory:s,ownerHistoryHandle:n}}registerChange(t,...e){this.changeMap[t.uuid]||(this.changeMap[t.uuid]=new Set);for(const i of e)this.changeMap[t.uuid].add(i),this.onDataChanged.trigger({model:t,expressID:i})}async newSingleProperty(t,e,i,s){const n=qe.getIFCSchema(t),r=new Qt[n].IfcIdentifier(i),o=new Qt[n][e](s),h=new Qt[n].IfcPropertySingleValue(r,null,o,null);return h.expressID=this.getNewExpressID(t),await this.setData(t,h),h}};g(Uo,"uuid","58c2d9f0-183c-48d6-a402-dfcf5b9a34df");let xl=Uo;const Bo=class En extends St{constructor(t){super(t),g(this,"onDisposed",new $),g(this,"onRelationsIndexed",new $),g(this,"relationMaps",{}),g(this,"enabled",!0),g(this,"_relToAttributesMap",Br),g(this,"_inverseAttributes",["IsDecomposedBy","Decomposes","AssociatedTo","HasAssociations","ClassificationForObjects","IsGroupedBy","HasAssignments","IsDefinedBy","DefinesOcurrence","IsTypedBy","Types","Defines","ContainedInStructure","ContainsElements","HasControlElements","AssignedToFlowElement","ConnectedTo","ConnectedFrom","ReferencedBy","Declares","HasContext","Controls","IsNestedBy","Nests","DocumentRefForObjects"]),g(this,"_ifcRels",[Di,On,bn,vn,Ui,Nn,xn,Mi,Pn,Ln,Mn,Dn,Un,Bn,zn]),g(this,"onFragmentsDisposed",e=>{delete this.relationMaps[e.groupID]}),g(this,"_changeMap",{}),g(this,"onEntitiesRelated",new $),this.components.add(En.uuid,this),t.get(Tt).onFragmentsDisposed.add(this.onFragmentsDisposed)}indexRelations(t,e,i,s){const n=Object.keys(e).find(c=>c.startsWith("Relating")),r=Object.keys(e).find(c=>c.startsWith("Related"));if(!(n&&r))return;const o=e[n].value,h=e[r].map(c=>c.value),l=this.getAttributeIndex(s);if(l!==null){let c=t.get(o);c||(c=new Map,t.set(o,c));let p=c.get(l);p||(p=[],c.set(l,p)),p.push(...h)}for(const c of h){const p=this.getAttributeIndex(i);if(p===null)continue;let u=t.get(c);u||(u=new Map,t.set(c,u));let d=u.get(p);d||(d=[],u.set(p,d)),d.push(o)}}getAttributeIndex(t){const e=this._inverseAttributes.indexOf(t);return e===-1?null:e}setRelationMap(t,e){this.relationMaps[t.uuid]=e,this.onRelationsIndexed.trigger({modelID:t.uuid,relationsMap:e})}async process(t){if(!t.hasProperties)throw new Error("FragmentsGroup properties not found");let e=this.relationMaps[t.uuid];if(e)return e;e=new Map;for(const i of this._ifcRels){const s=await t.getAllPropertiesOfType(i);if(!s)continue;const n=this._relToAttributesMap.get(i);if(!n)continue;const{forRelated:r,forRelating:o}=n;for(const h in s){const l=s[h];this.indexRelations(e,l,r,o)}}return this.setRelationMap(t,e),e}async processFromWebIfc(t,e){const i=new Map;for(const s of this._ifcRels){const n=this._relToAttributesMap.get(s);if(!n)continue;const{forRelated:r,forRelating:o}=n,h=t.GetLineIDsWithType(e,s);for(let l=0;l<h.size();l++){const c=await t.properties.getItemProperties(e,h.get(l));this.indexRelations(i,c,r,o)}}return this.onRelationsIndexed.trigger({modelID:e.toString(),relationsMap:i}),i}getEntityRelations(t,e,i){const s=this.relationMaps[t.uuid];if(!s)throw new Error(`IfcRelationsIndexer: model ${t.uuid} has no relations indexed.`);const n=s.get(e),r=this.getAttributeIndex(i);return n===void 0||r===null?null:n.get(r)||null}serializeRelations(t){const e={};for(const[i,s]of t.entries()){e[i]||(e[i]={});for(const[n,r]of s.entries())e[i][n]=r}return JSON.stringify(e)}serializeModelRelations(t){const e=this.relationMaps[t.uuid];return e?this.serializeRelations(e):null}serializeAllRelations(){const t={};for(const e in this.relationMaps){const i=this.relationMaps[e],s={};for(const[n,r]of i.entries()){s[n]||(s[n]={});for(const[o,h]of r.entries())s[n][o]=h}t[e]=s}return JSON.stringify(t)}getRelationsMapFromJSON(t){const e=JSON.parse(t),i=new Map;for(const s in e){const n=e[s],r=new Map;for(const o in n)r.set(Number(o),n[o]);i.set(Number(s),r)}return i}dispose(){this.relationMaps={},this.components.get(Tt).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(En.uuid),this.onDisposed.reset()}getEntitiesWithRelation(t,e,i){const s=this.relationMaps[t.uuid];if(!s)throw new Error("IfcRelationsIndexer: the model relations are not indexed!");const n=new Set;for(const[r,o]of s){const h=this.getAttributeIndex(e);if(h===null)throw new Error("IfcRelationsIndexer: invalid inverse attribute name");const l=o.get(h);l&&l.includes(i)&&n.add(r)}return n}addEntityRelations(t,e,i,...s){const n=this.getEntityRelations(t,e,i);if(n)n.push(...s);else{const r=this.getAttributeIndex(i);if(!r)throw new Error(`IfcRelationsIndexer: ${i} is not a valid relation name.`);const o=this.relationMaps[t.uuid].get(e);o==null||o.set(r,s)}}async applyRelationChanges(){const t=this.components.get(Tt),e=this.components.get(xl);for(const i in this._changeMap){const s=t.groups.get(i);if(!s)continue;const n=this._changeMap[i];for(const[r,o]of n)for(const[h,l]of o){const{related:c,relID:p}=l;if(p){const u=await s.getProperties(p);if(!u)continue;const d=Object.keys(u),m=d.find(E=>E.startsWith("Related")),f=d.find(E=>E.startsWith("Relating"));if(!(m&&f))continue;u[m]=[...c].map(E=>new fe(E)),u[f]=new fe(h),await e.setData(s,u)}else{const u=await e.createIfcRel(s,r,h,[...c]);if(!u)continue;l.relID=u.expressID}}}}addEntitiesRelation(t,e,i,...s){const{type:n,inv:r}=i,o=this.relationMaps[t.uuid];if(!o||!this._ifcRels.includes(n))return;const h=Br.get(n);if(!h)return;const{forRelated:l,forRelating:c}=h;if(!(l===r||c===r))return;let p=this._changeMap[t.uuid];p||(p=new Ae,this._changeMap[t.uuid]=p);const u=c===r?[e]:s,d=l===r?[e]:s;let m=p.get(n);m||(m=new Ae,m.onItemSet.add(()=>this.onEntitiesRelated.trigger({invAttribute:r,relType:n,relatingIDs:u,relatedIDs:d})),m.onItemUpdated.add(()=>this.onEntitiesRelated.trigger({invAttribute:r,relType:n,relatingIDs:u,relatedIDs:d})),p.set(n,m));for(const f of u){let E=m.get(f);E||(E={related:new ei},m.set(f,E)),E.related.add(...d)}for(const f of u){let E=o.get(f);E||(E=new Map,o.set(f,E));const I=this.getAttributeIndex(c);if(I!==null){let C=E.get(I);C||(C=[],E.set(I,C)),C.push(...d)}}for(const f of d){let E=o.get(f);E||(E=new Map,o.set(f,E));const I=this.getAttributeIndex(l);if(I===null)continue;let C=E.get(I);C||(C=[],E.set(I,C)),C.push(...u)}}getEntityChildren(t,e,i=new Set){if(i.add(e),this.relationMaps[t.uuid]===void 0)throw new Error("The provided model has no indices. You have to generate them first.");const s=this.getEntityRelations(t,e,"IsDecomposedBy");if(s)for(const r of s)this.getEntityChildren(t,r,i);const n=this.getEntityRelations(t,e,"ContainsElements");if(n)for(const r of n)this.getEntityChildren(t,r,i);return i}};g(Bo,"uuid","23a889ab-83b3-44a4-8bee-ead83438370b");let Pi=Bo;const zo=class ko extends St{constructor(t){super(t),g(this,"onDisposed",new $),g(this,"onFragmentsLoaded",new $),g(this,"onFragmentsDisposed",new $),g(this,"list",new Ae),g(this,"groups",new Ae),g(this,"baseCoordinationModel",""),g(this,"baseCoordinationMatrix",new ut),g(this,"enabled",!0),g(this,"_loader",new io),this.components.add(ko.uuid,this)}get meshes(){const t=[];for(const[e,i]of this.list)t.push(i.mesh);return t}dispose(){for(const[t,e]of this.groups)e.dispose(!0);this.baseCoordinationModel="",this.groups.clear(),this.list.clear(),this.onFragmentsLoaded.reset(),this.onFragmentsDisposed.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}disposeGroup(t){const{uuid:e}=t,i=[];for(const s of t.items)i.push(s.id),this.list.delete(s.id);t.dispose(!0),this.groups.delete(t.uuid),this.groups.size===0&&(this.baseCoordinationModel="",this.baseCoordinationMatrix=new ut),this.onFragmentsDisposed.trigger({groupID:e,fragmentIDs:i})}load(t,e){const i={coordinate:!0,...e},{coordinate:s,name:n,properties:r,relationsMap:o}=i,h=this._loader.import(t);e&&(h.isStreamed=e.isStreamed||!1),n&&(h.name=n);for(const l of h.items)l.group=h,this.list.set(l.id,l);return s&&this.coordinate([h]),this.groups.set(h.uuid,h),r&&h.setLocalProperties(r),o&&this.components.get(Pi).setRelationMap(h,o),this.onFragmentsLoaded.trigger(h),h}export(t){return this._loader.export(t)}getModelIdMap(t){const e={};for(const i in t){const s=this.list.get(i);if(!(s&&s.group))continue;const n=s.group;n.uuid in e||(e[n.uuid]=new Set);const r=t[i];for(const o of r)e[n.uuid].add(o)}return e}modelIdToFragmentIdMap(t){let e={};for(const i in t){const s=this.groups.get(i);if(!s)continue;const n=t[i],r=s.getFragmentMap(n);e={...e,...r}}return e}guidToFragmentIdMap(t){const e={};for(const[i,s]of this.groups){i in e||(e[i]=new Set);for(const n of t){const r=s.globalToExpressIDs.get(n);r&&e[i].add(r)}}return this.modelIdToFragmentIdMap(e)}fragmentIdMapToGuids(t){const e=[],i=this.getModelIdMap(t);for(const s in i){const n=this.groups.get(s);if(!n)continue;const r=i[s];for(const o of r)for(const[h,l]of n.globalToExpressIDs.entries())if(l===o){e.push(h);break}}return e}coordinate(t=Array.from(this.groups.values())){if(this.baseCoordinationModel.length===0){const e=t.pop();if(!e)return;this.baseCoordinationModel=e.uuid,this.baseCoordinationMatrix=e.coordinationMatrix.clone()}if(t.length)for(const e of t)e.coordinationMatrix.equals(this.baseCoordinationMatrix)||(e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1),e.updateMatrix(),this.applyBaseCoordinateSystem(e,e.coordinationMatrix))}applyBaseCoordinateSystem(t,e){e&&t.applyMatrix4(e.clone().invert()),t.applyMatrix4(this.baseCoordinationMatrix)}clone(t,e){const i=t.cloneGroup(e);this.groups.set(i.uuid,i);for(const s of i.items)this.list.set(s.id,s);return i}};g(zo,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let Tt=zo;var cs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pl(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function ds(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Yo={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(a,t){(function(e){a.exports=e()})(function(){return function e(i,s,n){function r(l,c){if(!s[l]){if(!i[l]){var p=typeof ds=="function"&&ds;if(!c&&p)return p(l,!0);if(o)return o(l,!0);var u=new Error("Cannot find module '"+l+"'");throw u.code="MODULE_NOT_FOUND",u}var d=s[l]={exports:{}};i[l][0].call(d.exports,function(m){var f=i[l][1][m];return r(f||m)},d,d.exports,e,i,s,n)}return s[l].exports}for(var o=typeof ds=="function"&&ds,h=0;h<n.length;h++)r(n[h]);return r}({1:[function(e,i,s){var n=e("./utils"),r=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(h){for(var l,c,p,u,d,m,f,E=[],I=0,C=h.length,R=C,T=n.getTypeOf(h)!=="string";I<h.length;)R=C-I,p=T?(l=h[I++],c=I<C?h[I++]:0,I<C?h[I++]:0):(l=h.charCodeAt(I++),c=I<C?h.charCodeAt(I++):0,I<C?h.charCodeAt(I++):0),u=l>>2,d=(3&l)<<4|c>>4,m=1<R?(15&c)<<2|p>>6:64,f=2<R?63&p:64,E.push(o.charAt(u)+o.charAt(d)+o.charAt(m)+o.charAt(f));return E.join("")},s.decode=function(h){var l,c,p,u,d,m,f=0,E=0,I="data:";if(h.substr(0,I.length)===I)throw new Error("Invalid base64 input, it looks like a data url.");var C,R=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===o.charAt(64)&&R--,h.charAt(h.length-2)===o.charAt(64)&&R--,R%1!=0)throw new Error("Invalid base64 input, bad content length.");for(C=r.uint8array?new Uint8Array(0|R):new Array(0|R);f<h.length;)l=o.indexOf(h.charAt(f++))<<2|(u=o.indexOf(h.charAt(f++)))>>4,c=(15&u)<<4|(d=o.indexOf(h.charAt(f++)))>>2,p=(3&d)<<6|(m=o.indexOf(h.charAt(f++))),C[E++]=l,d!==64&&(C[E++]=c),m!==64&&(C[E++]=p);return C}},{"./support":30,"./utils":32}],2:[function(e,i,s){var n=e("./external"),r=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),h=e("./stream/DataLengthProbe");function l(c,p,u,d,m){this.compressedSize=c,this.uncompressedSize=p,this.crc32=u,this.compression=d,this.compressedContent=m}l.prototype={getContentWorker:function(){var c=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),p=this;return c.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(c,p,u){return c.pipe(new o).pipe(new h("uncompressedSize")).pipe(p.compressWorker(u)).pipe(new h("compressedSize")).withStreamInfo("compression",p)},i.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,i,s){var n=e("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},s.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,i,s){var n=e("./utils"),r=function(){for(var o,h=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;h[l]=o}return h}();i.exports=function(o,h){return o!==void 0&&o.length?n.getTypeOf(o)!=="string"?function(l,c,p,u){var d=r,m=u+p;l^=-1;for(var f=u;f<m;f++)l=l>>>8^d[255&(l^c[f])];return-1^l}(0|h,o,o.length,0):function(l,c,p,u){var d=r,m=u+p;l^=-1;for(var f=u;f<m;f++)l=l>>>8^d[255&(l^c.charCodeAt(f))];return-1^l}(0|h,o,o.length,0):0}},{"./utils":32}],5:[function(e,i,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(e,i,s){var n=null;n=typeof Promise<"u"?Promise:e("lie"),i.exports={Promise:n}},{lie:37}],7:[function(e,i,s){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=e("pako"),o=e("./utils"),h=e("./stream/GenericWorker"),l=n?"uint8array":"array";function c(p,u){h.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=u,this.meta={}}s.magic="\b\0",o.inherits(c,h),c.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(l,p.data),!1)},c.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(u){p.push({data:u,meta:p.meta})}},s.compressWorker=function(p){return new c("Deflate",p)},s.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,i,s){function n(d,m){var f,E="";for(f=0;f<m;f++)E+=String.fromCharCode(255&d),d>>>=8;return E}function r(d,m,f,E,I,C){var R,T,y=d.file,O=d.compression,A=C!==l.utf8encode,N=o.transformTo("string",C(y.name)),b=o.transformTo("string",l.utf8encode(y.name)),P=y.comment,z=o.transformTo("string",C(P)),F=o.transformTo("string",l.utf8encode(P)),x=b.length!==y.name.length,w=F.length!==P.length,M="",Z="",V="",J=y.dir,j=y.date,nt={crc32:0,compressedSize:0,uncompressedSize:0};m&&!f||(nt.crc32=d.crc32,nt.compressedSize=d.compressedSize,nt.uncompressedSize=d.uncompressedSize);var k=0;m&&(k|=8),A||!x&&!w||(k|=2048);var B=0,st=0;J&&(B|=16),I==="UNIX"?(st=798,B|=function(q,wt){var Ft=q;return q||(Ft=wt?16893:33204),(65535&Ft)<<16}(y.unixPermissions,J)):(st=20,B|=function(q){return 63&(q||0)}(y.dosPermissions)),R=j.getUTCHours(),R<<=6,R|=j.getUTCMinutes(),R<<=5,R|=j.getUTCSeconds()/2,T=j.getUTCFullYear()-1980,T<<=4,T|=j.getUTCMonth()+1,T<<=5,T|=j.getUTCDate(),x&&(Z=n(1,1)+n(c(N),4)+b,M+="up"+n(Z.length,2)+Z),w&&(V=n(1,1)+n(c(z),4)+F,M+="uc"+n(V.length,2)+V);var tt="";return tt+=`
\0`,tt+=n(k,2),tt+=O.magic,tt+=n(R,2),tt+=n(T,2),tt+=n(nt.crc32,4),tt+=n(nt.compressedSize,4),tt+=n(nt.uncompressedSize,4),tt+=n(N.length,2),tt+=n(M.length,2),{fileRecord:p.LOCAL_FILE_HEADER+tt+N+M,dirRecord:p.CENTRAL_FILE_HEADER+n(st,2)+tt+n(z.length,2)+"\0\0\0\0"+n(B,4)+n(E,4)+N+M+z}}var o=e("../utils"),h=e("../stream/GenericWorker"),l=e("../utf8"),c=e("../crc32"),p=e("../signature");function u(d,m,f,E){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=f,this.encodeFileName=E,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(u,h),u.prototype.push=function(d){var m=d.meta.percent||0,f=this.entriesCount,E=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,h.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:f?(m+100*(f-E-1))/f:100}}))},u.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var m=this.streamFiles&&!d.file.dir;if(m){var f=r(d,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:f.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(d){this.accumulate=!1;var m=this.streamFiles&&!d.file.dir,f=r(d,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(f.dirRecord),m)this.push({data:function(E){return p.DATA_DESCRIPTOR+n(E.crc32,4)+n(E.compressedSize,4)+n(E.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:f.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var d=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var f=this.bytesWritten-d,E=function(I,C,R,T,y){var O=o.transformTo("string",y(T));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(I,2)+n(I,2)+n(C,4)+n(R,4)+n(O.length,2)+O}(this.dirRecords.length,f,d,this.zipComment,this.encodeFileName);this.push({data:E,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(d){this._sources.push(d);var m=this;return d.on("data",function(f){m.processChunk(f)}),d.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),d.on("error",function(f){m.error(f)}),this},u.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(d){var m=this._sources;if(!h.prototype.error.call(this,d))return!1;for(var f=0;f<m.length;f++)try{m[f].error(d)}catch{}return!0},u.prototype.lock=function(){h.prototype.lock.call(this);for(var d=this._sources,m=0;m<d.length;m++)d[m].lock()},i.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,i,s){var n=e("../compressions"),r=e("./ZipFileWorker");s.generateWorker=function(o,h,l){var c=new r(h.streamFiles,l,h.platform,h.encodeFileName),p=0;try{o.forEach(function(u,d){p++;var m=function(C,R){var T=C||R,y=n[T];if(!y)throw new Error(T+" is not a valid compression method !");return y}(d.options.compression,h.compression),f=d.options.compressionOptions||h.compressionOptions||{},E=d.dir,I=d.date;d._compressWorker(m,f).withStreamInfo("file",{name:u,dir:E,date:I,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(c)}),c.entriesCount=p}catch(u){c.error(u)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,i,s){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new n;for(var o in this)typeof this[o]!="function"&&(r[o]=this[o]);return r}}(n.prototype=e("./object")).loadAsync=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.version="3.10.1",n.loadAsync=function(r,o){return new n().loadAsync(r,o)},n.external=e("./external"),i.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,i,s){var n=e("./utils"),r=e("./external"),o=e("./utf8"),h=e("./zipEntries"),l=e("./stream/Crc32Probe"),c=e("./nodejsUtils");function p(u){return new r.Promise(function(d,m){var f=u.decompressed.getContentWorker().pipe(new l);f.on("error",function(E){m(E)}).on("end",function(){f.streamInfo.crc32!==u.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}i.exports=function(u,d){var m=this;return d=n.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(u)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",u,!0,d.optimizedBinaryString,d.base64).then(function(f){var E=new h(d);return E.load(f),E}).then(function(f){var E=[r.Promise.resolve(f)],I=f.files;if(d.checkCRC32)for(var C=0;C<I.length;C++)E.push(p(I[C]));return r.Promise.all(E)}).then(function(f){for(var E=f.shift(),I=E.files,C=0;C<I.length;C++){var R=I[C],T=R.fileNameStr,y=n.resolve(R.fileNameStr);m.file(y,R.decompressed,{binary:!0,optimizedBinaryString:!0,date:R.date,dir:R.dir,comment:R.fileCommentStr.length?R.fileCommentStr:null,unixPermissions:R.unixPermissions,dosPermissions:R.dosPermissions,createFolders:d.createFolders}),R.dir||(m.file(y).unsafeOriginalName=T)}return E.zipComment.length&&(m.comment=E.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,i,s){var n=e("../utils"),r=e("../stream/GenericWorker");function o(h,l){r.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(l)}n.inherits(o,r),o.prototype._bindStream=function(h){var l=this;(this._stream=h).pause(),h.on("data",function(c){l.push({data:c,meta:{percent:0}})}).on("error",function(c){l.isPaused?this.generatedError=c:l.error(c)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},o.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,i,s){var n=e("readable-stream").Readable;function r(o,h,l){n.call(this,h),this._helper=o;var c=this;o.on("data",function(p,u){c.push(p)||c._helper.pause(),l&&l(u)}).on("error",function(p){c.emit("error",p)}).on("end",function(){c.push(null)})}e("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},i.exports=r},{"../utils":32,"readable-stream":16}],14:[function(e,i,s){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,r);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,r)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var r=new Buffer(n);return r.fill(0),r},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(e,i,s){function n(y,O,A){var N,b=o.getTypeOf(O),P=o.extend(A||{},c);P.date=P.date||new Date,P.compression!==null&&(P.compression=P.compression.toUpperCase()),typeof P.unixPermissions=="string"&&(P.unixPermissions=parseInt(P.unixPermissions,8)),P.unixPermissions&&16384&P.unixPermissions&&(P.dir=!0),P.dosPermissions&&16&P.dosPermissions&&(P.dir=!0),P.dir&&(y=I(y)),P.createFolders&&(N=E(y))&&C.call(this,N,!0);var z=b==="string"&&P.binary===!1&&P.base64===!1;A&&A.binary!==void 0||(P.binary=!z),(O instanceof p&&O.uncompressedSize===0||P.dir||!O||O.length===0)&&(P.base64=!1,P.binary=!0,O="",P.compression="STORE",b="string");var F=null;F=O instanceof p||O instanceof h?O:m.isNode&&m.isStream(O)?new f(y,O):o.prepareContent(y,O,P.binary,P.optimizedBinaryString,P.base64);var x=new u(y,F,P);this.files[y]=x}var r=e("./utf8"),o=e("./utils"),h=e("./stream/GenericWorker"),l=e("./stream/StreamHelper"),c=e("./defaults"),p=e("./compressedObject"),u=e("./zipObject"),d=e("./generate"),m=e("./nodejsUtils"),f=e("./nodejs/NodejsStreamInputAdapter"),E=function(y){y.slice(-1)==="/"&&(y=y.substring(0,y.length-1));var O=y.lastIndexOf("/");return 0<O?y.substring(0,O):""},I=function(y){return y.slice(-1)!=="/"&&(y+="/"),y},C=function(y,O){return O=O!==void 0?O:c.createFolders,y=I(y),this.files[y]||n.call(this,y,null,{dir:!0,createFolders:O}),this.files[y]};function R(y){return Object.prototype.toString.call(y)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(y){var O,A,N;for(O in this.files)N=this.files[O],(A=O.slice(this.root.length,O.length))&&O.slice(0,this.root.length)===this.root&&y(A,N)},filter:function(y){var O=[];return this.forEach(function(A,N){y(A,N)&&O.push(N)}),O},file:function(y,O,A){if(arguments.length!==1)return y=this.root+y,n.call(this,y,O,A),this;if(R(y)){var N=y;return this.filter(function(P,z){return!z.dir&&N.test(P)})}var b=this.files[this.root+y];return b&&!b.dir?b:null},folder:function(y){if(!y)return this;if(R(y))return this.filter(function(b,P){return P.dir&&y.test(b)});var O=this.root+y,A=C.call(this,O),N=this.clone();return N.root=A.name,N},remove:function(y){y=this.root+y;var O=this.files[y];if(O||(y.slice(-1)!=="/"&&(y+="/"),O=this.files[y]),O&&!O.dir)delete this.files[y];else for(var A=this.filter(function(b,P){return P.name.slice(0,y.length)===y}),N=0;N<A.length;N++)delete this.files[A[N].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(y){var O,A={};try{if((A=o.extend(y||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=A.type.toLowerCase(),A.compression=A.compression.toUpperCase(),A.type==="binarystring"&&(A.type="string"),!A.type)throw new Error("No output type specified.");o.checkSupport(A.type),A.platform!=="darwin"&&A.platform!=="freebsd"&&A.platform!=="linux"&&A.platform!=="sunos"||(A.platform="UNIX"),A.platform==="win32"&&(A.platform="DOS");var N=A.comment||this.comment||"";O=d.generateWorker(this,A,N)}catch(b){(O=new h("error")).error(b)}return new l(O,A.type||"string",A.mimeType)},generateAsync:function(y,O){return this.generateInternalStream(y).accumulate(O)},generateNodeStream:function(y,O){return(y=y||{}).type||(y.type="nodebuffer"),this.generateInternalStream(y).toNodejsStream(O)}};i.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,i,s){i.exports=e("stream")},{stream:void 0}],17:[function(e,i,s){var n=e("./DataReader");function r(o){n.call(this,o);for(var h=0;h<this.data.length;h++)o[h]=255&o[h]}e("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data[this.zero+o]},r.prototype.lastIndexOfSignature=function(o){for(var h=o.charCodeAt(0),l=o.charCodeAt(1),c=o.charCodeAt(2),p=o.charCodeAt(3),u=this.length-4;0<=u;--u)if(this.data[u]===h&&this.data[u+1]===l&&this.data[u+2]===c&&this.data[u+3]===p)return u-this.zero;return-1},r.prototype.readAndCheckSignature=function(o){var h=o.charCodeAt(0),l=o.charCodeAt(1),c=o.charCodeAt(2),p=o.charCodeAt(3),u=this.readData(4);return h===u[0]&&l===u[1]&&c===u[2]&&p===u[3]},r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,h},i.exports=r},{"../utils":32,"./DataReader":18}],18:[function(e,i,s){var n=e("../utils");function r(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var h,l=0;for(this.checkOffset(o),h=this.index+o-1;h>=this.index;h--)l=(l<<8)+this.byteAt(h);return this.index+=o,l},readString:function(o){return n.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},i.exports=r},{"../utils":32}],19:[function(e,i,s){var n=e("./Uint8ArrayReader");function r(o){n.call(this,o)}e("../utils").inherits(r,n),r.prototype.readData=function(o){this.checkOffset(o);var h=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,h},i.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,i,s){var n=e("./DataReader");function r(o){n.call(this,o)}e("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},r.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},r.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},r.prototype.readData=function(o){this.checkOffset(o);var h=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,h},i.exports=r},{"../utils":32,"./DataReader":18}],21:[function(e,i,s){var n=e("./ArrayReader");function r(o){n.call(this,o)}e("../utils").inherits(r,n),r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,h},i.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(e,i,s){var n=e("../utils"),r=e("../support"),o=e("./ArrayReader"),h=e("./StringReader"),l=e("./NodeBufferReader"),c=e("./Uint8ArrayReader");i.exports=function(p){var u=n.getTypeOf(p);return n.checkSupport(u),u!=="string"||r.uint8array?u==="nodebuffer"?new l(p):r.uint8array?new c(n.transformTo("uint8array",p)):new o(n.transformTo("array",p)):new h(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,i,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,i,s){var n=e("./GenericWorker"),r=e("../utils");function o(h){n.call(this,"ConvertWorker to "+h),this.destType=h}r.inherits(o,n),o.prototype.processChunk=function(h){this.push({data:r.transformTo(this.destType,h.data),meta:h.meta})},i.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,i,s){var n=e("./GenericWorker"),r=e("../crc32");function o(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,n),o.prototype.processChunk=function(h){this.streamInfo.crc32=r(h.data,this.streamInfo.crc32||0),this.push(h)},i.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,i,s){var n=e("../utils"),r=e("./GenericWorker");function o(h){r.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}n.inherits(o,r),o.prototype.processChunk=function(h){if(h){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+h.data.length}r.prototype.processChunk.call(this,h)},i.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,i,s){var n=e("../utils"),r=e("./GenericWorker");function o(h){r.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(c){l.dataIsReady=!0,l.data=c,l.max=c&&c.length||0,l.type=n.getTypeOf(c),l.isPaused||l._tickAndRepeat()},function(c){l.error(c)})}n.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,l);break;case"uint8array":h=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":h=this.data.slice(this.index,l)}return this.index=l,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,i,s){function n(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,o){return this._listeners[r].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,o){if(this._listeners[r])for(var h=0;h<this._listeners[r].length;h++)this._listeners[r][h].call(this,o)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var o=this;return r.on("data",function(h){o.processChunk(h)}),r.on("end",function(){o.end()}),r.on("error",function(h){o.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,o){return this.extraStreamInfo[r]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},i.exports=n},{}],29:[function(e,i,s){var n=e("../utils"),r=e("./ConvertWorker"),o=e("./GenericWorker"),h=e("../base64"),l=e("../support"),c=e("../external"),p=null;if(l.nodestream)try{p=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function u(m,f){return new c.Promise(function(E,I){var C=[],R=m._internalType,T=m._outputType,y=m._mimeType;m.on("data",function(O,A){C.push(O),f&&f(A)}).on("error",function(O){C=[],I(O)}).on("end",function(){try{var O=function(A,N,b){switch(A){case"blob":return n.newBlob(n.transformTo("arraybuffer",N),b);case"base64":return h.encode(N);default:return n.transformTo(A,N)}}(T,function(A,N){var b,P=0,z=null,F=0;for(b=0;b<N.length;b++)F+=N[b].length;switch(A){case"string":return N.join("");case"array":return Array.prototype.concat.apply([],N);case"uint8array":for(z=new Uint8Array(F),b=0;b<N.length;b++)z.set(N[b],P),P+=N[b].length;return z;case"nodebuffer":return Buffer.concat(N);default:throw new Error("concat : unsupported type '"+A+"'")}}(R,C),y);E(O)}catch(A){I(A)}C=[]}).resume()})}function d(m,f,E){var I=f;switch(f){case"blob":case"arraybuffer":I="uint8array";break;case"base64":I="string"}try{this._internalType=I,this._outputType=f,this._mimeType=E,n.checkSupport(I),this._worker=m.pipe(new r(I)),m.lock()}catch(C){this._worker=new o("error"),this._worker.error(C)}}d.prototype={accumulate:function(m){return u(this,m)},on:function(m,f){var E=this;return m==="data"?this._worker.on(m,function(I){f.call(E,I.data,I.meta)}):this._worker.on(m,function(){n.delay(f,arguments,E)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},m)}},i.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,i,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var n=new ArrayBuffer(0);try{s.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),s.blob=r.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!e("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(e,i,s){for(var n=e("./utils"),r=e("./support"),o=e("./nodejsUtils"),h=e("./stream/GenericWorker"),l=new Array(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;l[254]=l[254]=1;function p(){h.call(this,"utf-8 decode"),this.leftOver=null}function u(){h.call(this,"utf-8 encode")}s.utf8encode=function(d){return r.nodebuffer?o.newBufferFrom(d,"utf-8"):function(m){var f,E,I,C,R,T=m.length,y=0;for(C=0;C<T;C++)(64512&(E=m.charCodeAt(C)))==55296&&C+1<T&&(64512&(I=m.charCodeAt(C+1)))==56320&&(E=65536+(E-55296<<10)+(I-56320),C++),y+=E<128?1:E<2048?2:E<65536?3:4;for(f=r.uint8array?new Uint8Array(y):new Array(y),C=R=0;R<y;C++)(64512&(E=m.charCodeAt(C)))==55296&&C+1<T&&(64512&(I=m.charCodeAt(C+1)))==56320&&(E=65536+(E-55296<<10)+(I-56320),C++),E<128?f[R++]=E:(E<2048?f[R++]=192|E>>>6:(E<65536?f[R++]=224|E>>>12:(f[R++]=240|E>>>18,f[R++]=128|E>>>12&63),f[R++]=128|E>>>6&63),f[R++]=128|63&E);return f}(d)},s.utf8decode=function(d){return r.nodebuffer?n.transformTo("nodebuffer",d).toString("utf-8"):function(m){var f,E,I,C,R=m.length,T=new Array(2*R);for(f=E=0;f<R;)if((I=m[f++])<128)T[E++]=I;else if(4<(C=l[I]))T[E++]=65533,f+=C-1;else{for(I&=C===2?31:C===3?15:7;1<C&&f<R;)I=I<<6|63&m[f++],C--;1<C?T[E++]=65533:I<65536?T[E++]=I:(I-=65536,T[E++]=55296|I>>10&1023,T[E++]=56320|1023&I)}return T.length!==E&&(T.subarray?T=T.subarray(0,E):T.length=E),n.applyFromCharCode(T)}(d=n.transformTo(r.uint8array?"uint8array":"array",d))},n.inherits(p,h),p.prototype.processChunk=function(d){var m=n.transformTo(r.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var f=m;(m=new Uint8Array(f.length+this.leftOver.length)).set(this.leftOver,0),m.set(f,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var E=function(C,R){var T;for((R=R||C.length)>C.length&&(R=C.length),T=R-1;0<=T&&(192&C[T])==128;)T--;return T<0||T===0?R:T+l[C[T]]>R?T:R}(m),I=m;E!==m.length&&(r.uint8array?(I=m.subarray(0,E),this.leftOver=m.subarray(E,m.length)):(I=m.slice(0,E),this.leftOver=m.slice(E,m.length))),this.push({data:s.utf8decode(I),meta:d.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=p,n.inherits(u,h),u.prototype.processChunk=function(d){this.push({data:s.utf8encode(d.data),meta:d.meta})},s.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,i,s){var n=e("./support"),r=e("./base64"),o=e("./nodejsUtils"),h=e("./external");function l(f){return f}function c(f,E){for(var I=0;I<f.length;++I)E[I]=255&f.charCodeAt(I);return E}e("setimmediate"),s.newBlob=function(f,E){s.checkSupport("blob");try{return new Blob([f],{type:E})}catch{try{var I=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return I.append(f),I.getBlob(E)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(f,E,I){var C=[],R=0,T=f.length;if(T<=I)return String.fromCharCode.apply(null,f);for(;R<T;)E==="array"||E==="nodebuffer"?C.push(String.fromCharCode.apply(null,f.slice(R,Math.min(R+I,T)))):C.push(String.fromCharCode.apply(null,f.subarray(R,Math.min(R+I,T)))),R+=I;return C.join("")},stringifyByChar:function(f){for(var E="",I=0;I<f.length;I++)E+=String.fromCharCode(f[I]);return E},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function u(f){var E=65536,I=s.getTypeOf(f),C=!0;if(I==="uint8array"?C=p.applyCanBeUsed.uint8array:I==="nodebuffer"&&(C=p.applyCanBeUsed.nodebuffer),C)for(;1<E;)try{return p.stringifyByChunk(f,I,E)}catch{E=Math.floor(E/2)}return p.stringifyByChar(f)}function d(f,E){for(var I=0;I<f.length;I++)E[I]=f[I];return E}s.applyFromCharCode=u;var m={};m.string={string:l,array:function(f){return c(f,new Array(f.length))},arraybuffer:function(f){return m.string.uint8array(f).buffer},uint8array:function(f){return c(f,new Uint8Array(f.length))},nodebuffer:function(f){return c(f,o.allocBuffer(f.length))}},m.array={string:u,array:l,arraybuffer:function(f){return new Uint8Array(f).buffer},uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return o.newBufferFrom(f)}},m.arraybuffer={string:function(f){return u(new Uint8Array(f))},array:function(f){return d(new Uint8Array(f),new Array(f.byteLength))},arraybuffer:l,uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return o.newBufferFrom(new Uint8Array(f))}},m.uint8array={string:u,array:function(f){return d(f,new Array(f.length))},arraybuffer:function(f){return f.buffer},uint8array:l,nodebuffer:function(f){return o.newBufferFrom(f)}},m.nodebuffer={string:u,array:function(f){return d(f,new Array(f.length))},arraybuffer:function(f){return m.nodebuffer.uint8array(f).buffer},uint8array:function(f){return d(f,new Uint8Array(f.length))},nodebuffer:l},s.transformTo=function(f,E){if(E=E||"",!f)return E;s.checkSupport(f);var I=s.getTypeOf(E);return m[I][f](E)},s.resolve=function(f){for(var E=f.split("/"),I=[],C=0;C<E.length;C++){var R=E[C];R==="."||R===""&&C!==0&&C!==E.length-1||(R===".."?I.pop():I.push(R))}return I.join("/")},s.getTypeOf=function(f){return typeof f=="string"?"string":Object.prototype.toString.call(f)==="[object Array]"?"array":n.nodebuffer&&o.isBuffer(f)?"nodebuffer":n.uint8array&&f instanceof Uint8Array?"uint8array":n.arraybuffer&&f instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(f){if(!n[f.toLowerCase()])throw new Error(f+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(f){var E,I,C="";for(I=0;I<(f||"").length;I++)C+="\\x"+((E=f.charCodeAt(I))<16?"0":"")+E.toString(16).toUpperCase();return C},s.delay=function(f,E,I){setImmediate(function(){f.apply(I||null,E||[])})},s.inherits=function(f,E){function I(){}I.prototype=E.prototype,f.prototype=new I},s.extend=function(){var f,E,I={};for(f=0;f<arguments.length;f++)for(E in arguments[f])Object.prototype.hasOwnProperty.call(arguments[f],E)&&I[E]===void 0&&(I[E]=arguments[f][E]);return I},s.prepareContent=function(f,E,I,C,R){return h.Promise.resolve(E).then(function(T){return n.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1)&&typeof FileReader<"u"?new h.Promise(function(y,O){var A=new FileReader;A.onload=function(N){y(N.target.result)},A.onerror=function(N){O(N.target.error)},A.readAsArrayBuffer(T)}):T}).then(function(T){var y=s.getTypeOf(T);return y?(y==="arraybuffer"?T=s.transformTo("uint8array",T):y==="string"&&(R?T=r.decode(T):I&&C!==!0&&(T=function(O){return c(O,n.uint8array?new Uint8Array(O.length):new Array(O.length))}(T))),T):h.Promise.reject(new Error("Can't read the data of '"+f+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,i,s){var n=e("./reader/readerFor"),r=e("./utils"),o=e("./signature"),h=e("./zipEntry"),l=e("./support");function c(p){this.files=[],this.loadOptions=p}c.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var u=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(u)+", expected "+r.pretty(p)+")")}},isSignature:function(p,u){var d=this.reader.index;this.reader.setIndex(p);var m=this.reader.readString(4)===u;return this.reader.setIndex(d),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),u=l.uint8array?"uint8array":"array",d=r.transformTo(u,p);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,u,d,m=this.zip64EndOfCentralSize-44;0<m;)p=this.reader.readInt(2),u=this.reader.readInt(4),d=this.reader.readData(u),this.zip64ExtensibleData[p]={id:p,length:u,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,u;for(p=0;p<this.files.length;p++)u=this.files[p],this.reader.setIndex(u.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),u.readLocalPart(this.reader),u.handleUTF8(),u.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(p=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var u=p;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var m=u-d;if(0<m)this.isSignature(u,o.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(p){this.reader=n(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,i,s){var n=e("./reader/readerFor"),r=e("./utils"),o=e("./compressedObject"),h=e("./crc32"),l=e("./utf8"),c=e("./compressions"),p=e("./support");function u(d,m){this.options=d,this.loadOptions=m}u.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var m,f;if(d.skip(22),this.fileNameLength=d.readInt(2),f=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(f),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(E){for(var I in c)if(Object.prototype.hasOwnProperty.call(c,I)&&c[I].magic===E)return c[I];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,m,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var m=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(m),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var m,f,E,I=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<I;)m=d.readInt(2),f=d.readInt(2),E=d.readData(f),this.extraFields[m]={id:m,length:f,value:E};d.setIndex(I)},handleUTF8:function(){var d=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var f=r.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(f)}var E=this.findExtraFieldUnicodeComment();if(E!==null)this.fileCommentStr=E;else{var I=r.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(I)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var m=n(d.value);return m.readInt(1)!==1||h(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var m=n(d.value);return m.readInt(1)!==1||h(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(d.length-5))}return null}},i.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,i,s){function n(m,f,E){this.name=m,this.dir=E.dir,this.date=E.date,this.comment=E.comment,this.unixPermissions=E.unixPermissions,this.dosPermissions=E.dosPermissions,this._data=f,this._dataBinary=E.binary,this.options={compression:E.compression,compressionOptions:E.compressionOptions}}var r=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),h=e("./utf8"),l=e("./compressedObject"),c=e("./stream/GenericWorker");n.prototype={internalStream:function(m){var f=null,E="string";try{if(!m)throw new Error("No output type specified.");var I=(E=m.toLowerCase())==="string"||E==="text";E!=="binarystring"&&E!=="text"||(E="string"),f=this._decompressWorker();var C=!this._dataBinary;C&&!I&&(f=f.pipe(new h.Utf8EncodeWorker)),!C&&I&&(f=f.pipe(new h.Utf8DecodeWorker))}catch(R){(f=new c("error")).error(R)}return new r(f,E,"")},async:function(m,f){return this.internalStream(m).accumulate(f)},nodeStream:function(m,f){return this.internalStream(m||"nodebuffer").toNodejsStream(f)},_compressWorker:function(m,f){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var E=this._decompressWorker();return this._dataBinary||(E=E.pipe(new h.Utf8EncodeWorker)),l.createWorkerFrom(E,m,f)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof c?this._data:new o(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<p.length;d++)n.prototype[p[d]]=u;i.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,i,s){(function(n){var r,o,h=n.MutationObserver||n.WebKitMutationObserver;if(h){var l=0,c=new h(m),p=n.document.createTextNode("");c.observe(p,{characterData:!0}),r=function(){p.data=l=++l%2}}else if(n.setImmediate||n.MessageChannel===void 0)r="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var f=n.document.createElement("script");f.onreadystatechange=function(){m(),f.onreadystatechange=null,f.parentNode.removeChild(f),f=null},n.document.documentElement.appendChild(f)}:function(){setTimeout(m,0)};else{var u=new n.MessageChannel;u.port1.onmessage=m,r=function(){u.port2.postMessage(0)}}var d=[];function m(){var f,E;o=!0;for(var I=d.length;I;){for(E=d,d=[],f=-1;++f<I;)E[f]();I=d.length}o=!1}i.exports=function(f){d.push(f)!==1||o||r()}}).call(this,typeof cs<"u"?cs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,i,s){var n=e("immediate");function r(){}var o={},h=["REJECTED"],l=["FULFILLED"],c=["PENDING"];function p(I){if(typeof I!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,I!==r&&f(this,I)}function u(I,C,R){this.promise=I,typeof C=="function"&&(this.onFulfilled=C,this.callFulfilled=this.otherCallFulfilled),typeof R=="function"&&(this.onRejected=R,this.callRejected=this.otherCallRejected)}function d(I,C,R){n(function(){var T;try{T=C(R)}catch(y){return o.reject(I,y)}T===I?o.reject(I,new TypeError("Cannot resolve promise with itself")):o.resolve(I,T)})}function m(I){var C=I&&I.then;if(I&&(typeof I=="object"||typeof I=="function")&&typeof C=="function")return function(){C.apply(I,arguments)}}function f(I,C){var R=!1;function T(A){R||(R=!0,o.reject(I,A))}function y(A){R||(R=!0,o.resolve(I,A))}var O=E(function(){C(y,T)});O.status==="error"&&T(O.value)}function E(I,C){var R={};try{R.value=I(C),R.status="success"}catch(T){R.status="error",R.value=T}return R}(i.exports=p).prototype.finally=function(I){if(typeof I!="function")return this;var C=this.constructor;return this.then(function(R){return C.resolve(I()).then(function(){return R})},function(R){return C.resolve(I()).then(function(){throw R})})},p.prototype.catch=function(I){return this.then(null,I)},p.prototype.then=function(I,C){if(typeof I!="function"&&this.state===l||typeof C!="function"&&this.state===h)return this;var R=new this.constructor(r);return this.state!==c?d(R,this.state===l?I:C,this.outcome):this.queue.push(new u(R,I,C)),R},u.prototype.callFulfilled=function(I){o.resolve(this.promise,I)},u.prototype.otherCallFulfilled=function(I){d(this.promise,this.onFulfilled,I)},u.prototype.callRejected=function(I){o.reject(this.promise,I)},u.prototype.otherCallRejected=function(I){d(this.promise,this.onRejected,I)},o.resolve=function(I,C){var R=E(m,C);if(R.status==="error")return o.reject(I,R.value);var T=R.value;if(T)f(I,T);else{I.state=l,I.outcome=C;for(var y=-1,O=I.queue.length;++y<O;)I.queue[y].callFulfilled(C)}return I},o.reject=function(I,C){I.state=h,I.outcome=C;for(var R=-1,T=I.queue.length;++R<T;)I.queue[R].callRejected(C);return I},p.resolve=function(I){return I instanceof this?I:o.resolve(new this(r),I)},p.reject=function(I){var C=new this(r);return o.reject(C,I)},p.all=function(I){var C=this;if(Object.prototype.toString.call(I)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=I.length,T=!1;if(!R)return this.resolve([]);for(var y=new Array(R),O=0,A=-1,N=new this(r);++A<R;)b(I[A],A);return N;function b(P,z){C.resolve(P).then(function(F){y[z]=F,++O!==R||T||(T=!0,o.resolve(N,y))},function(F){T||(T=!0,o.reject(N,F))})}},p.race=function(I){var C=this;if(Object.prototype.toString.call(I)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=I.length,T=!1;if(!R)return this.resolve([]);for(var y=-1,O=new this(r);++y<R;)A=I[y],C.resolve(A).then(function(N){T||(T=!0,o.resolve(O,N))},function(N){T||(T=!0,o.reject(O,N))});var A;return O}},{immediate:36}],38:[function(e,i,s){var n={};(0,e("./lib/utils/common").assign)(n,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),i.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,i,s){var n=e("./zlib/deflate"),r=e("./utils/common"),o=e("./utils/strings"),h=e("./zlib/messages"),l=e("./zlib/zstream"),c=Object.prototype.toString,p=0,u=-1,d=0,m=8;function f(I){if(!(this instanceof f))return new f(I);this.options=r.assign({level:u,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},I||{});var C=this.options;C.raw&&0<C.windowBits?C.windowBits=-C.windowBits:C.gzip&&0<C.windowBits&&C.windowBits<16&&(C.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var R=n.deflateInit2(this.strm,C.level,C.method,C.windowBits,C.memLevel,C.strategy);if(R!==p)throw new Error(h[R]);if(C.header&&n.deflateSetHeader(this.strm,C.header),C.dictionary){var T;if(T=typeof C.dictionary=="string"?o.string2buf(C.dictionary):c.call(C.dictionary)==="[object ArrayBuffer]"?new Uint8Array(C.dictionary):C.dictionary,(R=n.deflateSetDictionary(this.strm,T))!==p)throw new Error(h[R]);this._dict_set=!0}}function E(I,C){var R=new f(C);if(R.push(I,!0),R.err)throw R.msg||h[R.err];return R.result}f.prototype.push=function(I,C){var R,T,y=this.strm,O=this.options.chunkSize;if(this.ended)return!1;T=C===~~C?C:C===!0?4:0,typeof I=="string"?y.input=o.string2buf(I):c.call(I)==="[object ArrayBuffer]"?y.input=new Uint8Array(I):y.input=I,y.next_in=0,y.avail_in=y.input.length;do{if(y.avail_out===0&&(y.output=new r.Buf8(O),y.next_out=0,y.avail_out=O),(R=n.deflate(y,T))!==1&&R!==p)return this.onEnd(R),!(this.ended=!0);y.avail_out!==0&&(y.avail_in!==0||T!==4&&T!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(r.shrinkBuf(y.output,y.next_out))):this.onData(r.shrinkBuf(y.output,y.next_out)))}while((0<y.avail_in||y.avail_out===0)&&R!==1);return T===4?(R=n.deflateEnd(this.strm),this.onEnd(R),this.ended=!0,R===p):T!==2||(this.onEnd(p),!(y.avail_out=0))},f.prototype.onData=function(I){this.chunks.push(I)},f.prototype.onEnd=function(I){I===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=I,this.msg=this.strm.msg},s.Deflate=f,s.deflate=E,s.deflateRaw=function(I,C){return(C=C||{}).raw=!0,E(I,C)},s.gzip=function(I,C){return(C=C||{}).gzip=!0,E(I,C)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,i,s){var n=e("./zlib/inflate"),r=e("./utils/common"),o=e("./utils/strings"),h=e("./zlib/constants"),l=e("./zlib/messages"),c=e("./zlib/zstream"),p=e("./zlib/gzheader"),u=Object.prototype.toString;function d(f){if(!(this instanceof d))return new d(f);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},f||{});var E=this.options;E.raw&&0<=E.windowBits&&E.windowBits<16&&(E.windowBits=-E.windowBits,E.windowBits===0&&(E.windowBits=-15)),!(0<=E.windowBits&&E.windowBits<16)||f&&f.windowBits||(E.windowBits+=32),15<E.windowBits&&E.windowBits<48&&!(15&E.windowBits)&&(E.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var I=n.inflateInit2(this.strm,E.windowBits);if(I!==h.Z_OK)throw new Error(l[I]);this.header=new p,n.inflateGetHeader(this.strm,this.header)}function m(f,E){var I=new d(E);if(I.push(f,!0),I.err)throw I.msg||l[I.err];return I.result}d.prototype.push=function(f,E){var I,C,R,T,y,O,A=this.strm,N=this.options.chunkSize,b=this.options.dictionary,P=!1;if(this.ended)return!1;C=E===~~E?E:E===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof f=="string"?A.input=o.binstring2buf(f):u.call(f)==="[object ArrayBuffer]"?A.input=new Uint8Array(f):A.input=f,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new r.Buf8(N),A.next_out=0,A.avail_out=N),(I=n.inflate(A,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&b&&(O=typeof b=="string"?o.string2buf(b):u.call(b)==="[object ArrayBuffer]"?new Uint8Array(b):b,I=n.inflateSetDictionary(this.strm,O)),I===h.Z_BUF_ERROR&&P===!0&&(I=h.Z_OK,P=!1),I!==h.Z_STREAM_END&&I!==h.Z_OK)return this.onEnd(I),!(this.ended=!0);A.next_out&&(A.avail_out!==0&&I!==h.Z_STREAM_END&&(A.avail_in!==0||C!==h.Z_FINISH&&C!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(R=o.utf8border(A.output,A.next_out),T=A.next_out-R,y=o.buf2string(A.output,R),A.next_out=T,A.avail_out=N-T,T&&r.arraySet(A.output,A.output,R,T,0),this.onData(y)):this.onData(r.shrinkBuf(A.output,A.next_out)))),A.avail_in===0&&A.avail_out===0&&(P=!0)}while((0<A.avail_in||A.avail_out===0)&&I!==h.Z_STREAM_END);return I===h.Z_STREAM_END&&(C=h.Z_FINISH),C===h.Z_FINISH?(I=n.inflateEnd(this.strm),this.onEnd(I),this.ended=!0,I===h.Z_OK):C!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(A.avail_out=0))},d.prototype.onData=function(f){this.chunks.push(f)},d.prototype.onEnd=function(f){f===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},s.Inflate=d,s.inflate=m,s.inflateRaw=function(f,E){return(E=E||{}).raw=!0,m(f,E)},s.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,i,s){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(h){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var c=l.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var p in c)c.hasOwnProperty(p)&&(h[p]=c[p])}}return h},s.shrinkBuf=function(h,l){return h.length===l?h:h.subarray?h.subarray(0,l):(h.length=l,h)};var r={arraySet:function(h,l,c,p,u){if(l.subarray&&h.subarray)h.set(l.subarray(c,c+p),u);else for(var d=0;d<p;d++)h[u+d]=l[c+d]},flattenChunks:function(h){var l,c,p,u,d,m;for(l=p=0,c=h.length;l<c;l++)p+=h[l].length;for(m=new Uint8Array(p),l=u=0,c=h.length;l<c;l++)d=h[l],m.set(d,u),u+=d.length;return m}},o={arraySet:function(h,l,c,p,u){for(var d=0;d<p;d++)h[u+d]=l[c+d]},flattenChunks:function(h){return[].concat.apply([],h)}};s.setTyped=function(h){h?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,r)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,o))},s.setTyped(n)},{}],42:[function(e,i,s){var n=e("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var h=new n.Buf8(256),l=0;l<256;l++)h[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(p,u){if(u<65537&&(p.subarray&&o||!p.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(p,u));for(var d="",m=0;m<u;m++)d+=String.fromCharCode(p[m]);return d}h[254]=h[254]=1,s.string2buf=function(p){var u,d,m,f,E,I=p.length,C=0;for(f=0;f<I;f++)(64512&(d=p.charCodeAt(f)))==55296&&f+1<I&&(64512&(m=p.charCodeAt(f+1)))==56320&&(d=65536+(d-55296<<10)+(m-56320),f++),C+=d<128?1:d<2048?2:d<65536?3:4;for(u=new n.Buf8(C),f=E=0;E<C;f++)(64512&(d=p.charCodeAt(f)))==55296&&f+1<I&&(64512&(m=p.charCodeAt(f+1)))==56320&&(d=65536+(d-55296<<10)+(m-56320),f++),d<128?u[E++]=d:(d<2048?u[E++]=192|d>>>6:(d<65536?u[E++]=224|d>>>12:(u[E++]=240|d>>>18,u[E++]=128|d>>>12&63),u[E++]=128|d>>>6&63),u[E++]=128|63&d);return u},s.buf2binstring=function(p){return c(p,p.length)},s.binstring2buf=function(p){for(var u=new n.Buf8(p.length),d=0,m=u.length;d<m;d++)u[d]=p.charCodeAt(d);return u},s.buf2string=function(p,u){var d,m,f,E,I=u||p.length,C=new Array(2*I);for(d=m=0;d<I;)if((f=p[d++])<128)C[m++]=f;else if(4<(E=h[f]))C[m++]=65533,d+=E-1;else{for(f&=E===2?31:E===3?15:7;1<E&&d<I;)f=f<<6|63&p[d++],E--;1<E?C[m++]=65533:f<65536?C[m++]=f:(f-=65536,C[m++]=55296|f>>10&1023,C[m++]=56320|1023&f)}return c(C,m)},s.utf8border=function(p,u){var d;for((u=u||p.length)>p.length&&(u=p.length),d=u-1;0<=d&&(192&p[d])==128;)d--;return d<0||d===0?u:d+h[p[d]]>u?d:u}},{"./common":41}],43:[function(e,i,s){i.exports=function(n,r,o,h){for(var l=65535&n|0,c=n>>>16&65535|0,p=0;o!==0;){for(o-=p=2e3<o?2e3:o;c=c+(l=l+r[h++]|0)|0,--p;);l%=65521,c%=65521}return l|c<<16|0}},{}],44:[function(e,i,s){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,i,s){var n=function(){for(var r,o=[],h=0;h<256;h++){r=h;for(var l=0;l<8;l++)r=1&r?3988292384^r>>>1:r>>>1;o[h]=r}return o}();i.exports=function(r,o,h,l){var c=n,p=l+h;r^=-1;for(var u=l;u<p;u++)r=r>>>8^c[255&(r^o[u])];return-1^r}},{}],46:[function(e,i,s){var n,r=e("../utils/common"),o=e("./trees"),h=e("./adler32"),l=e("./crc32"),c=e("./messages"),p=0,u=4,d=0,m=-2,f=-1,E=4,I=2,C=8,R=9,T=286,y=30,O=19,A=2*T+1,N=15,b=3,P=258,z=P+b+1,F=42,x=113,w=1,M=2,Z=3,V=4;function J(_,H){return _.msg=c[H],H}function j(_){return(_<<1)-(4<_?9:0)}function nt(_){for(var H=_.length;0<=--H;)_[H]=0}function k(_){var H=_.state,Y=H.pending;Y>_.avail_out&&(Y=_.avail_out),Y!==0&&(r.arraySet(_.output,H.pending_buf,H.pending_out,Y,_.next_out),_.next_out+=Y,H.pending_out+=Y,_.total_out+=Y,_.avail_out-=Y,H.pending-=Y,H.pending===0&&(H.pending_out=0))}function B(_,H){o._tr_flush_block(_,0<=_.block_start?_.block_start:-1,_.strstart-_.block_start,H),_.block_start=_.strstart,k(_.strm)}function st(_,H){_.pending_buf[_.pending++]=H}function tt(_,H){_.pending_buf[_.pending++]=H>>>8&255,_.pending_buf[_.pending++]=255&H}function q(_,H){var Y,v,S=_.max_chain_length,L=_.strstart,W=_.prev_length,X=_.nice_match,D=_.strstart>_.w_size-z?_.strstart-(_.w_size-z):0,Q=_.window,et=_.w_mask,K=_.prev,ot=_.strstart+P,gt=Q[L+W-1],pt=Q[L+W];_.prev_length>=_.good_match&&(S>>=2),X>_.lookahead&&(X=_.lookahead);do if(Q[(Y=H)+W]===pt&&Q[Y+W-1]===gt&&Q[Y]===Q[L]&&Q[++Y]===Q[L+1]){L+=2,Y++;do;while(Q[++L]===Q[++Y]&&Q[++L]===Q[++Y]&&Q[++L]===Q[++Y]&&Q[++L]===Q[++Y]&&Q[++L]===Q[++Y]&&Q[++L]===Q[++Y]&&Q[++L]===Q[++Y]&&Q[++L]===Q[++Y]&&L<ot);if(v=P-(ot-L),L=ot-P,W<v){if(_.match_start=H,X<=(W=v))break;gt=Q[L+W-1],pt=Q[L+W]}}while((H=K[H&et])>D&&--S!=0);return W<=_.lookahead?W:_.lookahead}function wt(_){var H,Y,v,S,L,W,X,D,Q,et,K=_.w_size;do{if(S=_.window_size-_.lookahead-_.strstart,_.strstart>=K+(K-z)){for(r.arraySet(_.window,_.window,K,K,0),_.match_start-=K,_.strstart-=K,_.block_start-=K,H=Y=_.hash_size;v=_.head[--H],_.head[H]=K<=v?v-K:0,--Y;);for(H=Y=K;v=_.prev[--H],_.prev[H]=K<=v?v-K:0,--Y;);S+=K}if(_.strm.avail_in===0)break;if(W=_.strm,X=_.window,D=_.strstart+_.lookahead,Q=S,et=void 0,et=W.avail_in,Q<et&&(et=Q),Y=et===0?0:(W.avail_in-=et,r.arraySet(X,W.input,W.next_in,et,D),W.state.wrap===1?W.adler=h(W.adler,X,et,D):W.state.wrap===2&&(W.adler=l(W.adler,X,et,D)),W.next_in+=et,W.total_in+=et,et),_.lookahead+=Y,_.lookahead+_.insert>=b)for(L=_.strstart-_.insert,_.ins_h=_.window[L],_.ins_h=(_.ins_h<<_.hash_shift^_.window[L+1])&_.hash_mask;_.insert&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[L+b-1])&_.hash_mask,_.prev[L&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=L,L++,_.insert--,!(_.lookahead+_.insert<b)););}while(_.lookahead<z&&_.strm.avail_in!==0)}function Ft(_,H){for(var Y,v;;){if(_.lookahead<z){if(wt(_),_.lookahead<z&&H===p)return w;if(_.lookahead===0)break}if(Y=0,_.lookahead>=b&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+b-1])&_.hash_mask,Y=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),Y!==0&&_.strstart-Y<=_.w_size-z&&(_.match_length=q(_,Y)),_.match_length>=b)if(v=o._tr_tally(_,_.strstart-_.match_start,_.match_length-b),_.lookahead-=_.match_length,_.match_length<=_.max_lazy_match&&_.lookahead>=b){for(_.match_length--;_.strstart++,_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+b-1])&_.hash_mask,Y=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart,--_.match_length!=0;);_.strstart++}else _.strstart+=_.match_length,_.match_length=0,_.ins_h=_.window[_.strstart],_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+1])&_.hash_mask;else v=o._tr_tally(_,0,_.window[_.strstart]),_.lookahead--,_.strstart++;if(v&&(B(_,!1),_.strm.avail_out===0))return w}return _.insert=_.strstart<b-1?_.strstart:b-1,H===u?(B(_,!0),_.strm.avail_out===0?Z:V):_.last_lit&&(B(_,!1),_.strm.avail_out===0)?w:M}function rt(_,H){for(var Y,v,S;;){if(_.lookahead<z){if(wt(_),_.lookahead<z&&H===p)return w;if(_.lookahead===0)break}if(Y=0,_.lookahead>=b&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+b-1])&_.hash_mask,Y=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),_.prev_length=_.match_length,_.prev_match=_.match_start,_.match_length=b-1,Y!==0&&_.prev_length<_.max_lazy_match&&_.strstart-Y<=_.w_size-z&&(_.match_length=q(_,Y),_.match_length<=5&&(_.strategy===1||_.match_length===b&&4096<_.strstart-_.match_start)&&(_.match_length=b-1)),_.prev_length>=b&&_.match_length<=_.prev_length){for(S=_.strstart+_.lookahead-b,v=o._tr_tally(_,_.strstart-1-_.prev_match,_.prev_length-b),_.lookahead-=_.prev_length-1,_.prev_length-=2;++_.strstart<=S&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+b-1])&_.hash_mask,Y=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),--_.prev_length!=0;);if(_.match_available=0,_.match_length=b-1,_.strstart++,v&&(B(_,!1),_.strm.avail_out===0))return w}else if(_.match_available){if((v=o._tr_tally(_,0,_.window[_.strstart-1]))&&B(_,!1),_.strstart++,_.lookahead--,_.strm.avail_out===0)return w}else _.match_available=1,_.strstart++,_.lookahead--}return _.match_available&&(v=o._tr_tally(_,0,_.window[_.strstart-1]),_.match_available=0),_.insert=_.strstart<b-1?_.strstart:b-1,H===u?(B(_,!0),_.strm.avail_out===0?Z:V):_.last_lit&&(B(_,!1),_.strm.avail_out===0)?w:M}function dt(_,H,Y,v,S){this.good_length=_,this.max_lazy=H,this.nice_length=Y,this.max_chain=v,this.func=S}function ct(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=C,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*A),this.dyn_dtree=new r.Buf16(2*(2*y+1)),this.bl_tree=new r.Buf16(2*(2*O+1)),nt(this.dyn_ltree),nt(this.dyn_dtree),nt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(N+1),this.heap=new r.Buf16(2*T+1),nt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*T+1),nt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Et(_){var H;return _&&_.state?(_.total_in=_.total_out=0,_.data_type=I,(H=_.state).pending=0,H.pending_out=0,H.wrap<0&&(H.wrap=-H.wrap),H.status=H.wrap?F:x,_.adler=H.wrap===2?0:1,H.last_flush=p,o._tr_init(H),d):J(_,m)}function Gt(_){var H=Et(_);return H===d&&function(Y){Y.window_size=2*Y.w_size,nt(Y.head),Y.max_lazy_match=n[Y.level].max_lazy,Y.good_match=n[Y.level].good_length,Y.nice_match=n[Y.level].nice_length,Y.max_chain_length=n[Y.level].max_chain,Y.strstart=0,Y.block_start=0,Y.lookahead=0,Y.insert=0,Y.match_length=Y.prev_length=b-1,Y.match_available=0,Y.ins_h=0}(_.state),H}function xt(_,H,Y,v,S,L){if(!_)return m;var W=1;if(H===f&&(H=6),v<0?(W=0,v=-v):15<v&&(W=2,v-=16),S<1||R<S||Y!==C||v<8||15<v||H<0||9<H||L<0||E<L)return J(_,m);v===8&&(v=9);var X=new ct;return(_.state=X).strm=_,X.wrap=W,X.gzhead=null,X.w_bits=v,X.w_size=1<<X.w_bits,X.w_mask=X.w_size-1,X.hash_bits=S+7,X.hash_size=1<<X.hash_bits,X.hash_mask=X.hash_size-1,X.hash_shift=~~((X.hash_bits+b-1)/b),X.window=new r.Buf8(2*X.w_size),X.head=new r.Buf16(X.hash_size),X.prev=new r.Buf16(X.w_size),X.lit_bufsize=1<<S+6,X.pending_buf_size=4*X.lit_bufsize,X.pending_buf=new r.Buf8(X.pending_buf_size),X.d_buf=1*X.lit_bufsize,X.l_buf=3*X.lit_bufsize,X.level=H,X.strategy=L,X.method=Y,Gt(_)}n=[new dt(0,0,0,0,function(_,H){var Y=65535;for(Y>_.pending_buf_size-5&&(Y=_.pending_buf_size-5);;){if(_.lookahead<=1){if(wt(_),_.lookahead===0&&H===p)return w;if(_.lookahead===0)break}_.strstart+=_.lookahead,_.lookahead=0;var v=_.block_start+Y;if((_.strstart===0||_.strstart>=v)&&(_.lookahead=_.strstart-v,_.strstart=v,B(_,!1),_.strm.avail_out===0)||_.strstart-_.block_start>=_.w_size-z&&(B(_,!1),_.strm.avail_out===0))return w}return _.insert=0,H===u?(B(_,!0),_.strm.avail_out===0?Z:V):(_.strstart>_.block_start&&(B(_,!1),_.strm.avail_out),w)}),new dt(4,4,8,4,Ft),new dt(4,5,16,8,Ft),new dt(4,6,32,32,Ft),new dt(4,4,16,16,rt),new dt(8,16,32,32,rt),new dt(8,16,128,128,rt),new dt(8,32,128,256,rt),new dt(32,128,258,1024,rt),new dt(32,258,258,4096,rt)],s.deflateInit=function(_,H){return xt(_,H,C,15,8,0)},s.deflateInit2=xt,s.deflateReset=Gt,s.deflateResetKeep=Et,s.deflateSetHeader=function(_,H){return _&&_.state?_.state.wrap!==2?m:(_.state.gzhead=H,d):m},s.deflate=function(_,H){var Y,v,S,L;if(!_||!_.state||5<H||H<0)return _?J(_,m):m;if(v=_.state,!_.output||!_.input&&_.avail_in!==0||v.status===666&&H!==u)return J(_,_.avail_out===0?-5:m);if(v.strm=_,Y=v.last_flush,v.last_flush=H,v.status===F)if(v.wrap===2)_.adler=0,st(v,31),st(v,139),st(v,8),v.gzhead?(st(v,(v.gzhead.text?1:0)+(v.gzhead.hcrc?2:0)+(v.gzhead.extra?4:0)+(v.gzhead.name?8:0)+(v.gzhead.comment?16:0)),st(v,255&v.gzhead.time),st(v,v.gzhead.time>>8&255),st(v,v.gzhead.time>>16&255),st(v,v.gzhead.time>>24&255),st(v,v.level===9?2:2<=v.strategy||v.level<2?4:0),st(v,255&v.gzhead.os),v.gzhead.extra&&v.gzhead.extra.length&&(st(v,255&v.gzhead.extra.length),st(v,v.gzhead.extra.length>>8&255)),v.gzhead.hcrc&&(_.adler=l(_.adler,v.pending_buf,v.pending,0)),v.gzindex=0,v.status=69):(st(v,0),st(v,0),st(v,0),st(v,0),st(v,0),st(v,v.level===9?2:2<=v.strategy||v.level<2?4:0),st(v,3),v.status=x);else{var W=C+(v.w_bits-8<<4)<<8;W|=(2<=v.strategy||v.level<2?0:v.level<6?1:v.level===6?2:3)<<6,v.strstart!==0&&(W|=32),W+=31-W%31,v.status=x,tt(v,W),v.strstart!==0&&(tt(v,_.adler>>>16),tt(v,65535&_.adler)),_.adler=1}if(v.status===69)if(v.gzhead.extra){for(S=v.pending;v.gzindex<(65535&v.gzhead.extra.length)&&(v.pending!==v.pending_buf_size||(v.gzhead.hcrc&&v.pending>S&&(_.adler=l(_.adler,v.pending_buf,v.pending-S,S)),k(_),S=v.pending,v.pending!==v.pending_buf_size));)st(v,255&v.gzhead.extra[v.gzindex]),v.gzindex++;v.gzhead.hcrc&&v.pending>S&&(_.adler=l(_.adler,v.pending_buf,v.pending-S,S)),v.gzindex===v.gzhead.extra.length&&(v.gzindex=0,v.status=73)}else v.status=73;if(v.status===73)if(v.gzhead.name){S=v.pending;do{if(v.pending===v.pending_buf_size&&(v.gzhead.hcrc&&v.pending>S&&(_.adler=l(_.adler,v.pending_buf,v.pending-S,S)),k(_),S=v.pending,v.pending===v.pending_buf_size)){L=1;break}L=v.gzindex<v.gzhead.name.length?255&v.gzhead.name.charCodeAt(v.gzindex++):0,st(v,L)}while(L!==0);v.gzhead.hcrc&&v.pending>S&&(_.adler=l(_.adler,v.pending_buf,v.pending-S,S)),L===0&&(v.gzindex=0,v.status=91)}else v.status=91;if(v.status===91)if(v.gzhead.comment){S=v.pending;do{if(v.pending===v.pending_buf_size&&(v.gzhead.hcrc&&v.pending>S&&(_.adler=l(_.adler,v.pending_buf,v.pending-S,S)),k(_),S=v.pending,v.pending===v.pending_buf_size)){L=1;break}L=v.gzindex<v.gzhead.comment.length?255&v.gzhead.comment.charCodeAt(v.gzindex++):0,st(v,L)}while(L!==0);v.gzhead.hcrc&&v.pending>S&&(_.adler=l(_.adler,v.pending_buf,v.pending-S,S)),L===0&&(v.status=103)}else v.status=103;if(v.status===103&&(v.gzhead.hcrc?(v.pending+2>v.pending_buf_size&&k(_),v.pending+2<=v.pending_buf_size&&(st(v,255&_.adler),st(v,_.adler>>8&255),_.adler=0,v.status=x)):v.status=x),v.pending!==0){if(k(_),_.avail_out===0)return v.last_flush=-1,d}else if(_.avail_in===0&&j(H)<=j(Y)&&H!==u)return J(_,-5);if(v.status===666&&_.avail_in!==0)return J(_,-5);if(_.avail_in!==0||v.lookahead!==0||H!==p&&v.status!==666){var X=v.strategy===2?function(D,Q){for(var et;;){if(D.lookahead===0&&(wt(D),D.lookahead===0)){if(Q===p)return w;break}if(D.match_length=0,et=o._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,et&&(B(D,!1),D.strm.avail_out===0))return w}return D.insert=0,Q===u?(B(D,!0),D.strm.avail_out===0?Z:V):D.last_lit&&(B(D,!1),D.strm.avail_out===0)?w:M}(v,H):v.strategy===3?function(D,Q){for(var et,K,ot,gt,pt=D.window;;){if(D.lookahead<=P){if(wt(D),D.lookahead<=P&&Q===p)return w;if(D.lookahead===0)break}if(D.match_length=0,D.lookahead>=b&&0<D.strstart&&(K=pt[ot=D.strstart-1])===pt[++ot]&&K===pt[++ot]&&K===pt[++ot]){gt=D.strstart+P;do;while(K===pt[++ot]&&K===pt[++ot]&&K===pt[++ot]&&K===pt[++ot]&&K===pt[++ot]&&K===pt[++ot]&&K===pt[++ot]&&K===pt[++ot]&&ot<gt);D.match_length=P-(gt-ot),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=b?(et=o._tr_tally(D,1,D.match_length-b),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(et=o._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),et&&(B(D,!1),D.strm.avail_out===0))return w}return D.insert=0,Q===u?(B(D,!0),D.strm.avail_out===0?Z:V):D.last_lit&&(B(D,!1),D.strm.avail_out===0)?w:M}(v,H):n[v.level].func(v,H);if(X!==Z&&X!==V||(v.status=666),X===w||X===Z)return _.avail_out===0&&(v.last_flush=-1),d;if(X===M&&(H===1?o._tr_align(v):H!==5&&(o._tr_stored_block(v,0,0,!1),H===3&&(nt(v.head),v.lookahead===0&&(v.strstart=0,v.block_start=0,v.insert=0))),k(_),_.avail_out===0))return v.last_flush=-1,d}return H!==u?d:v.wrap<=0?1:(v.wrap===2?(st(v,255&_.adler),st(v,_.adler>>8&255),st(v,_.adler>>16&255),st(v,_.adler>>24&255),st(v,255&_.total_in),st(v,_.total_in>>8&255),st(v,_.total_in>>16&255),st(v,_.total_in>>24&255)):(tt(v,_.adler>>>16),tt(v,65535&_.adler)),k(_),0<v.wrap&&(v.wrap=-v.wrap),v.pending!==0?d:1)},s.deflateEnd=function(_){var H;return _&&_.state?(H=_.state.status)!==F&&H!==69&&H!==73&&H!==91&&H!==103&&H!==x&&H!==666?J(_,m):(_.state=null,H===x?J(_,-3):d):m},s.deflateSetDictionary=function(_,H){var Y,v,S,L,W,X,D,Q,et=H.length;if(!_||!_.state||(L=(Y=_.state).wrap)===2||L===1&&Y.status!==F||Y.lookahead)return m;for(L===1&&(_.adler=h(_.adler,H,et,0)),Y.wrap=0,et>=Y.w_size&&(L===0&&(nt(Y.head),Y.strstart=0,Y.block_start=0,Y.insert=0),Q=new r.Buf8(Y.w_size),r.arraySet(Q,H,et-Y.w_size,Y.w_size,0),H=Q,et=Y.w_size),W=_.avail_in,X=_.next_in,D=_.input,_.avail_in=et,_.next_in=0,_.input=H,wt(Y);Y.lookahead>=b;){for(v=Y.strstart,S=Y.lookahead-(b-1);Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[v+b-1])&Y.hash_mask,Y.prev[v&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=v,v++,--S;);Y.strstart=v,Y.lookahead=b-1,wt(Y)}return Y.strstart+=Y.lookahead,Y.block_start=Y.strstart,Y.insert=Y.lookahead,Y.lookahead=0,Y.match_length=Y.prev_length=b-1,Y.match_available=0,_.next_in=X,_.input=D,_.avail_in=W,Y.wrap=L,d},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,i,s){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,i,s){i.exports=function(n,r){var o,h,l,c,p,u,d,m,f,E,I,C,R,T,y,O,A,N,b,P,z,F,x,w,M;o=n.state,h=n.next_in,w=n.input,l=h+(n.avail_in-5),c=n.next_out,M=n.output,p=c-(r-n.avail_out),u=c+(n.avail_out-257),d=o.dmax,m=o.wsize,f=o.whave,E=o.wnext,I=o.window,C=o.hold,R=o.bits,T=o.lencode,y=o.distcode,O=(1<<o.lenbits)-1,A=(1<<o.distbits)-1;t:do{R<15&&(C+=w[h++]<<R,R+=8,C+=w[h++]<<R,R+=8),N=T[C&O];e:for(;;){if(C>>>=b=N>>>24,R-=b,(b=N>>>16&255)===0)M[c++]=65535&N;else{if(!(16&b)){if(!(64&b)){N=T[(65535&N)+(C&(1<<b)-1)];continue e}if(32&b){o.mode=12;break t}n.msg="invalid literal/length code",o.mode=30;break t}P=65535&N,(b&=15)&&(R<b&&(C+=w[h++]<<R,R+=8),P+=C&(1<<b)-1,C>>>=b,R-=b),R<15&&(C+=w[h++]<<R,R+=8,C+=w[h++]<<R,R+=8),N=y[C&A];i:for(;;){if(C>>>=b=N>>>24,R-=b,!(16&(b=N>>>16&255))){if(!(64&b)){N=y[(65535&N)+(C&(1<<b)-1)];continue i}n.msg="invalid distance code",o.mode=30;break t}if(z=65535&N,R<(b&=15)&&(C+=w[h++]<<R,(R+=8)<b&&(C+=w[h++]<<R,R+=8)),d<(z+=C&(1<<b)-1)){n.msg="invalid distance too far back",o.mode=30;break t}if(C>>>=b,R-=b,(b=c-p)<z){if(f<(b=z-b)&&o.sane){n.msg="invalid distance too far back",o.mode=30;break t}if(x=I,(F=0)===E){if(F+=m-b,b<P){for(P-=b;M[c++]=I[F++],--b;);F=c-z,x=M}}else if(E<b){if(F+=m+E-b,(b-=E)<P){for(P-=b;M[c++]=I[F++],--b;);if(F=0,E<P){for(P-=b=E;M[c++]=I[F++],--b;);F=c-z,x=M}}}else if(F+=E-b,b<P){for(P-=b;M[c++]=I[F++],--b;);F=c-z,x=M}for(;2<P;)M[c++]=x[F++],M[c++]=x[F++],M[c++]=x[F++],P-=3;P&&(M[c++]=x[F++],1<P&&(M[c++]=x[F++]))}else{for(F=c-z;M[c++]=M[F++],M[c++]=M[F++],M[c++]=M[F++],2<(P-=3););P&&(M[c++]=M[F++],1<P&&(M[c++]=M[F++]))}break}}break}}while(h<l&&c<u);h-=P=R>>3,C&=(1<<(R-=P<<3))-1,n.next_in=h,n.next_out=c,n.avail_in=h<l?l-h+5:5-(h-l),n.avail_out=c<u?u-c+257:257-(c-u),o.hold=C,o.bits=R}},{}],49:[function(e,i,s){var n=e("../utils/common"),r=e("./adler32"),o=e("./crc32"),h=e("./inffast"),l=e("./inftrees"),c=1,p=2,u=0,d=-2,m=1,f=852,E=592;function I(F){return(F>>>24&255)+(F>>>8&65280)+((65280&F)<<8)+((255&F)<<24)}function C(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function R(F){var x;return F&&F.state?(x=F.state,F.total_in=F.total_out=x.total=0,F.msg="",x.wrap&&(F.adler=1&x.wrap),x.mode=m,x.last=0,x.havedict=0,x.dmax=32768,x.head=null,x.hold=0,x.bits=0,x.lencode=x.lendyn=new n.Buf32(f),x.distcode=x.distdyn=new n.Buf32(E),x.sane=1,x.back=-1,u):d}function T(F){var x;return F&&F.state?((x=F.state).wsize=0,x.whave=0,x.wnext=0,R(F)):d}function y(F,x){var w,M;return F&&F.state?(M=F.state,x<0?(w=0,x=-x):(w=1+(x>>4),x<48&&(x&=15)),x&&(x<8||15<x)?d:(M.window!==null&&M.wbits!==x&&(M.window=null),M.wrap=w,M.wbits=x,T(F))):d}function O(F,x){var w,M;return F?(M=new C,(F.state=M).window=null,(w=y(F,x))!==u&&(F.state=null),w):d}var A,N,b=!0;function P(F){if(b){var x;for(A=new n.Buf32(512),N=new n.Buf32(32),x=0;x<144;)F.lens[x++]=8;for(;x<256;)F.lens[x++]=9;for(;x<280;)F.lens[x++]=7;for(;x<288;)F.lens[x++]=8;for(l(c,F.lens,0,288,A,0,F.work,{bits:9}),x=0;x<32;)F.lens[x++]=5;l(p,F.lens,0,32,N,0,F.work,{bits:5}),b=!1}F.lencode=A,F.lenbits=9,F.distcode=N,F.distbits=5}function z(F,x,w,M){var Z,V=F.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new n.Buf8(V.wsize)),M>=V.wsize?(n.arraySet(V.window,x,w-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(M<(Z=V.wsize-V.wnext)&&(Z=M),n.arraySet(V.window,x,w-M,Z,V.wnext),(M-=Z)?(n.arraySet(V.window,x,w-M,M,0),V.wnext=M,V.whave=V.wsize):(V.wnext+=Z,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=Z))),0}s.inflateReset=T,s.inflateReset2=y,s.inflateResetKeep=R,s.inflateInit=function(F){return O(F,15)},s.inflateInit2=O,s.inflate=function(F,x){var w,M,Z,V,J,j,nt,k,B,st,tt,q,wt,Ft,rt,dt,ct,Et,Gt,xt,_,H,Y,v,S=0,L=new n.Buf8(4),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!F||!F.state||!F.output||!F.input&&F.avail_in!==0)return d;(w=F.state).mode===12&&(w.mode=13),J=F.next_out,Z=F.output,nt=F.avail_out,V=F.next_in,M=F.input,j=F.avail_in,k=w.hold,B=w.bits,st=j,tt=nt,H=u;t:for(;;)switch(w.mode){case m:if(w.wrap===0){w.mode=13;break}for(;B<16;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}if(2&w.wrap&&k===35615){L[w.check=0]=255&k,L[1]=k>>>8&255,w.check=o(w.check,L,2,0),B=k=0,w.mode=2;break}if(w.flags=0,w.head&&(w.head.done=!1),!(1&w.wrap)||(((255&k)<<8)+(k>>8))%31){F.msg="incorrect header check",w.mode=30;break}if((15&k)!=8){F.msg="unknown compression method",w.mode=30;break}if(B-=4,_=8+(15&(k>>>=4)),w.wbits===0)w.wbits=_;else if(_>w.wbits){F.msg="invalid window size",w.mode=30;break}w.dmax=1<<_,F.adler=w.check=1,w.mode=512&k?10:12,B=k=0;break;case 2:for(;B<16;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}if(w.flags=k,(255&w.flags)!=8){F.msg="unknown compression method",w.mode=30;break}if(57344&w.flags){F.msg="unknown header flags set",w.mode=30;break}w.head&&(w.head.text=k>>8&1),512&w.flags&&(L[0]=255&k,L[1]=k>>>8&255,w.check=o(w.check,L,2,0)),B=k=0,w.mode=3;case 3:for(;B<32;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}w.head&&(w.head.time=k),512&w.flags&&(L[0]=255&k,L[1]=k>>>8&255,L[2]=k>>>16&255,L[3]=k>>>24&255,w.check=o(w.check,L,4,0)),B=k=0,w.mode=4;case 4:for(;B<16;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}w.head&&(w.head.xflags=255&k,w.head.os=k>>8),512&w.flags&&(L[0]=255&k,L[1]=k>>>8&255,w.check=o(w.check,L,2,0)),B=k=0,w.mode=5;case 5:if(1024&w.flags){for(;B<16;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}w.length=k,w.head&&(w.head.extra_len=k),512&w.flags&&(L[0]=255&k,L[1]=k>>>8&255,w.check=o(w.check,L,2,0)),B=k=0}else w.head&&(w.head.extra=null);w.mode=6;case 6:if(1024&w.flags&&(j<(q=w.length)&&(q=j),q&&(w.head&&(_=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),n.arraySet(w.head.extra,M,V,q,_)),512&w.flags&&(w.check=o(w.check,M,q,V)),j-=q,V+=q,w.length-=q),w.length))break t;w.length=0,w.mode=7;case 7:if(2048&w.flags){if(j===0)break t;for(q=0;_=M[V+q++],w.head&&_&&w.length<65536&&(w.head.name+=String.fromCharCode(_)),_&&q<j;);if(512&w.flags&&(w.check=o(w.check,M,q,V)),j-=q,V+=q,_)break t}else w.head&&(w.head.name=null);w.length=0,w.mode=8;case 8:if(4096&w.flags){if(j===0)break t;for(q=0;_=M[V+q++],w.head&&_&&w.length<65536&&(w.head.comment+=String.fromCharCode(_)),_&&q<j;);if(512&w.flags&&(w.check=o(w.check,M,q,V)),j-=q,V+=q,_)break t}else w.head&&(w.head.comment=null);w.mode=9;case 9:if(512&w.flags){for(;B<16;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}if(k!==(65535&w.check)){F.msg="header crc mismatch",w.mode=30;break}B=k=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0),F.adler=w.check=0,w.mode=12;break;case 10:for(;B<32;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}F.adler=w.check=I(k),B=k=0,w.mode=11;case 11:if(w.havedict===0)return F.next_out=J,F.avail_out=nt,F.next_in=V,F.avail_in=j,w.hold=k,w.bits=B,2;F.adler=w.check=1,w.mode=12;case 12:if(x===5||x===6)break t;case 13:if(w.last){k>>>=7&B,B-=7&B,w.mode=27;break}for(;B<3;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}switch(w.last=1&k,B-=1,3&(k>>>=1)){case 0:w.mode=14;break;case 1:if(P(w),w.mode=20,x!==6)break;k>>>=2,B-=2;break t;case 2:w.mode=17;break;case 3:F.msg="invalid block type",w.mode=30}k>>>=2,B-=2;break;case 14:for(k>>>=7&B,B-=7&B;B<32;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}if((65535&k)!=(k>>>16^65535)){F.msg="invalid stored block lengths",w.mode=30;break}if(w.length=65535&k,B=k=0,w.mode=15,x===6)break t;case 15:w.mode=16;case 16:if(q=w.length){if(j<q&&(q=j),nt<q&&(q=nt),q===0)break t;n.arraySet(Z,M,V,q,J),j-=q,V+=q,nt-=q,J+=q,w.length-=q;break}w.mode=12;break;case 17:for(;B<14;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}if(w.nlen=257+(31&k),k>>>=5,B-=5,w.ndist=1+(31&k),k>>>=5,B-=5,w.ncode=4+(15&k),k>>>=4,B-=4,286<w.nlen||30<w.ndist){F.msg="too many length or distance symbols",w.mode=30;break}w.have=0,w.mode=18;case 18:for(;w.have<w.ncode;){for(;B<3;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}w.lens[W[w.have++]]=7&k,k>>>=3,B-=3}for(;w.have<19;)w.lens[W[w.have++]]=0;if(w.lencode=w.lendyn,w.lenbits=7,Y={bits:w.lenbits},H=l(0,w.lens,0,19,w.lencode,0,w.work,Y),w.lenbits=Y.bits,H){F.msg="invalid code lengths set",w.mode=30;break}w.have=0,w.mode=19;case 19:for(;w.have<w.nlen+w.ndist;){for(;dt=(S=w.lencode[k&(1<<w.lenbits)-1])>>>16&255,ct=65535&S,!((rt=S>>>24)<=B);){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}if(ct<16)k>>>=rt,B-=rt,w.lens[w.have++]=ct;else{if(ct===16){for(v=rt+2;B<v;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}if(k>>>=rt,B-=rt,w.have===0){F.msg="invalid bit length repeat",w.mode=30;break}_=w.lens[w.have-1],q=3+(3&k),k>>>=2,B-=2}else if(ct===17){for(v=rt+3;B<v;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}B-=rt,_=0,q=3+(7&(k>>>=rt)),k>>>=3,B-=3}else{for(v=rt+7;B<v;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}B-=rt,_=0,q=11+(127&(k>>>=rt)),k>>>=7,B-=7}if(w.have+q>w.nlen+w.ndist){F.msg="invalid bit length repeat",w.mode=30;break}for(;q--;)w.lens[w.have++]=_}}if(w.mode===30)break;if(w.lens[256]===0){F.msg="invalid code -- missing end-of-block",w.mode=30;break}if(w.lenbits=9,Y={bits:w.lenbits},H=l(c,w.lens,0,w.nlen,w.lencode,0,w.work,Y),w.lenbits=Y.bits,H){F.msg="invalid literal/lengths set",w.mode=30;break}if(w.distbits=6,w.distcode=w.distdyn,Y={bits:w.distbits},H=l(p,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,Y),w.distbits=Y.bits,H){F.msg="invalid distances set",w.mode=30;break}if(w.mode=20,x===6)break t;case 20:w.mode=21;case 21:if(6<=j&&258<=nt){F.next_out=J,F.avail_out=nt,F.next_in=V,F.avail_in=j,w.hold=k,w.bits=B,h(F,tt),J=F.next_out,Z=F.output,nt=F.avail_out,V=F.next_in,M=F.input,j=F.avail_in,k=w.hold,B=w.bits,w.mode===12&&(w.back=-1);break}for(w.back=0;dt=(S=w.lencode[k&(1<<w.lenbits)-1])>>>16&255,ct=65535&S,!((rt=S>>>24)<=B);){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}if(dt&&!(240&dt)){for(Et=rt,Gt=dt,xt=ct;dt=(S=w.lencode[xt+((k&(1<<Et+Gt)-1)>>Et)])>>>16&255,ct=65535&S,!(Et+(rt=S>>>24)<=B);){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}k>>>=Et,B-=Et,w.back+=Et}if(k>>>=rt,B-=rt,w.back+=rt,w.length=ct,dt===0){w.mode=26;break}if(32&dt){w.back=-1,w.mode=12;break}if(64&dt){F.msg="invalid literal/length code",w.mode=30;break}w.extra=15&dt,w.mode=22;case 22:if(w.extra){for(v=w.extra;B<v;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}w.length+=k&(1<<w.extra)-1,k>>>=w.extra,B-=w.extra,w.back+=w.extra}w.was=w.length,w.mode=23;case 23:for(;dt=(S=w.distcode[k&(1<<w.distbits)-1])>>>16&255,ct=65535&S,!((rt=S>>>24)<=B);){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}if(!(240&dt)){for(Et=rt,Gt=dt,xt=ct;dt=(S=w.distcode[xt+((k&(1<<Et+Gt)-1)>>Et)])>>>16&255,ct=65535&S,!(Et+(rt=S>>>24)<=B);){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}k>>>=Et,B-=Et,w.back+=Et}if(k>>>=rt,B-=rt,w.back+=rt,64&dt){F.msg="invalid distance code",w.mode=30;break}w.offset=ct,w.extra=15&dt,w.mode=24;case 24:if(w.extra){for(v=w.extra;B<v;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}w.offset+=k&(1<<w.extra)-1,k>>>=w.extra,B-=w.extra,w.back+=w.extra}if(w.offset>w.dmax){F.msg="invalid distance too far back",w.mode=30;break}w.mode=25;case 25:if(nt===0)break t;if(q=tt-nt,w.offset>q){if((q=w.offset-q)>w.whave&&w.sane){F.msg="invalid distance too far back",w.mode=30;break}wt=q>w.wnext?(q-=w.wnext,w.wsize-q):w.wnext-q,q>w.length&&(q=w.length),Ft=w.window}else Ft=Z,wt=J-w.offset,q=w.length;for(nt<q&&(q=nt),nt-=q,w.length-=q;Z[J++]=Ft[wt++],--q;);w.length===0&&(w.mode=21);break;case 26:if(nt===0)break t;Z[J++]=w.length,nt--,w.mode=21;break;case 27:if(w.wrap){for(;B<32;){if(j===0)break t;j--,k|=M[V++]<<B,B+=8}if(tt-=nt,F.total_out+=tt,w.total+=tt,tt&&(F.adler=w.check=w.flags?o(w.check,Z,tt,J-tt):r(w.check,Z,tt,J-tt)),tt=nt,(w.flags?k:I(k))!==w.check){F.msg="incorrect data check",w.mode=30;break}B=k=0}w.mode=28;case 28:if(w.wrap&&w.flags){for(;B<32;){if(j===0)break t;j--,k+=M[V++]<<B,B+=8}if(k!==(4294967295&w.total)){F.msg="incorrect length check",w.mode=30;break}B=k=0}w.mode=29;case 29:H=1;break t;case 30:H=-3;break t;case 31:return-4;case 32:default:return d}return F.next_out=J,F.avail_out=nt,F.next_in=V,F.avail_in=j,w.hold=k,w.bits=B,(w.wsize||tt!==F.avail_out&&w.mode<30&&(w.mode<27||x!==4))&&z(F,F.output,F.next_out,tt-F.avail_out)?(w.mode=31,-4):(st-=F.avail_in,tt-=F.avail_out,F.total_in+=st,F.total_out+=tt,w.total+=tt,w.wrap&&tt&&(F.adler=w.check=w.flags?o(w.check,Z,tt,F.next_out-tt):r(w.check,Z,tt,F.next_out-tt)),F.data_type=w.bits+(w.last?64:0)+(w.mode===12?128:0)+(w.mode===20||w.mode===15?256:0),(st==0&&tt===0||x===4)&&H===u&&(H=-5),H)},s.inflateEnd=function(F){if(!F||!F.state)return d;var x=F.state;return x.window&&(x.window=null),F.state=null,u},s.inflateGetHeader=function(F,x){var w;return F&&F.state&&2&(w=F.state).wrap?((w.head=x).done=!1,u):d},s.inflateSetDictionary=function(F,x){var w,M=x.length;return F&&F.state?(w=F.state).wrap!==0&&w.mode!==11?d:w.mode===11&&r(1,x,M,0)!==w.check?-3:z(F,x,M,M)?(w.mode=31,-4):(w.havedict=1,u):d},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,i,s){var n=e("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(c,p,u,d,m,f,E,I){var C,R,T,y,O,A,N,b,P,z=I.bits,F=0,x=0,w=0,M=0,Z=0,V=0,J=0,j=0,nt=0,k=0,B=null,st=0,tt=new n.Buf16(16),q=new n.Buf16(16),wt=null,Ft=0;for(F=0;F<=15;F++)tt[F]=0;for(x=0;x<d;x++)tt[p[u+x]]++;for(Z=z,M=15;1<=M&&tt[M]===0;M--);if(M<Z&&(Z=M),M===0)return m[f++]=20971520,m[f++]=20971520,I.bits=1,0;for(w=1;w<M&&tt[w]===0;w++);for(Z<w&&(Z=w),F=j=1;F<=15;F++)if(j<<=1,(j-=tt[F])<0)return-1;if(0<j&&(c===0||M!==1))return-1;for(q[1]=0,F=1;F<15;F++)q[F+1]=q[F]+tt[F];for(x=0;x<d;x++)p[u+x]!==0&&(E[q[p[u+x]]++]=x);if(A=c===0?(B=wt=E,19):c===1?(B=r,st-=257,wt=o,Ft-=257,256):(B=h,wt=l,-1),F=w,O=f,J=x=k=0,T=-1,y=(nt=1<<(V=Z))-1,c===1&&852<nt||c===2&&592<nt)return 1;for(;;){for(N=F-J,P=E[x]<A?(b=0,E[x]):E[x]>A?(b=wt[Ft+E[x]],B[st+E[x]]):(b=96,0),C=1<<F-J,w=R=1<<V;m[O+(k>>J)+(R-=C)]=N<<24|b<<16|P|0,R!==0;);for(C=1<<F-1;k&C;)C>>=1;if(C!==0?(k&=C-1,k+=C):k=0,x++,--tt[F]==0){if(F===M)break;F=p[u+E[x]]}if(Z<F&&(k&y)!==T){for(J===0&&(J=Z),O+=w,j=1<<(V=F-J);V+J<M&&!((j-=tt[V+J])<=0);)V++,j<<=1;if(nt+=1<<V,c===1&&852<nt||c===2&&592<nt)return 1;m[T=k&y]=Z<<24|V<<16|O-f|0}}return k!==0&&(m[O+k]=F-J<<24|64<<16|0),I.bits=Z,0}},{"../utils/common":41}],51:[function(e,i,s){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,i,s){var n=e("../utils/common"),r=0,o=1;function h(S){for(var L=S.length;0<=--L;)S[L]=0}var l=0,c=29,p=256,u=p+1+c,d=30,m=19,f=2*u+1,E=15,I=16,C=7,R=256,T=16,y=17,O=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],N=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=new Array(2*(u+2));h(z);var F=new Array(2*d);h(F);var x=new Array(512);h(x);var w=new Array(256);h(w);var M=new Array(c);h(M);var Z,V,J,j=new Array(d);function nt(S,L,W,X,D){this.static_tree=S,this.extra_bits=L,this.extra_base=W,this.elems=X,this.max_length=D,this.has_stree=S&&S.length}function k(S,L){this.dyn_tree=S,this.max_code=0,this.stat_desc=L}function B(S){return S<256?x[S]:x[256+(S>>>7)]}function st(S,L){S.pending_buf[S.pending++]=255&L,S.pending_buf[S.pending++]=L>>>8&255}function tt(S,L,W){S.bi_valid>I-W?(S.bi_buf|=L<<S.bi_valid&65535,st(S,S.bi_buf),S.bi_buf=L>>I-S.bi_valid,S.bi_valid+=W-I):(S.bi_buf|=L<<S.bi_valid&65535,S.bi_valid+=W)}function q(S,L,W){tt(S,W[2*L],W[2*L+1])}function wt(S,L){for(var W=0;W|=1&S,S>>>=1,W<<=1,0<--L;);return W>>>1}function Ft(S,L,W){var X,D,Q=new Array(E+1),et=0;for(X=1;X<=E;X++)Q[X]=et=et+W[X-1]<<1;for(D=0;D<=L;D++){var K=S[2*D+1];K!==0&&(S[2*D]=wt(Q[K]++,K))}}function rt(S){var L;for(L=0;L<u;L++)S.dyn_ltree[2*L]=0;for(L=0;L<d;L++)S.dyn_dtree[2*L]=0;for(L=0;L<m;L++)S.bl_tree[2*L]=0;S.dyn_ltree[2*R]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function dt(S){8<S.bi_valid?st(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function ct(S,L,W,X){var D=2*L,Q=2*W;return S[D]<S[Q]||S[D]===S[Q]&&X[L]<=X[W]}function Et(S,L,W){for(var X=S.heap[W],D=W<<1;D<=S.heap_len&&(D<S.heap_len&&ct(L,S.heap[D+1],S.heap[D],S.depth)&&D++,!ct(L,X,S.heap[D],S.depth));)S.heap[W]=S.heap[D],W=D,D<<=1;S.heap[W]=X}function Gt(S,L,W){var X,D,Q,et,K=0;if(S.last_lit!==0)for(;X=S.pending_buf[S.d_buf+2*K]<<8|S.pending_buf[S.d_buf+2*K+1],D=S.pending_buf[S.l_buf+K],K++,X===0?q(S,D,L):(q(S,(Q=w[D])+p+1,L),(et=A[Q])!==0&&tt(S,D-=M[Q],et),q(S,Q=B(--X),W),(et=N[Q])!==0&&tt(S,X-=j[Q],et)),K<S.last_lit;);q(S,R,L)}function xt(S,L){var W,X,D,Q=L.dyn_tree,et=L.stat_desc.static_tree,K=L.stat_desc.has_stree,ot=L.stat_desc.elems,gt=-1;for(S.heap_len=0,S.heap_max=f,W=0;W<ot;W++)Q[2*W]!==0?(S.heap[++S.heap_len]=gt=W,S.depth[W]=0):Q[2*W+1]=0;for(;S.heap_len<2;)Q[2*(D=S.heap[++S.heap_len]=gt<2?++gt:0)]=1,S.depth[D]=0,S.opt_len--,K&&(S.static_len-=et[2*D+1]);for(L.max_code=gt,W=S.heap_len>>1;1<=W;W--)Et(S,Q,W);for(D=ot;W=S.heap[1],S.heap[1]=S.heap[S.heap_len--],Et(S,Q,1),X=S.heap[1],S.heap[--S.heap_max]=W,S.heap[--S.heap_max]=X,Q[2*D]=Q[2*W]+Q[2*X],S.depth[D]=(S.depth[W]>=S.depth[X]?S.depth[W]:S.depth[X])+1,Q[2*W+1]=Q[2*X+1]=D,S.heap[1]=D++,Et(S,Q,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(pt,Ht){var hi,oe,li,At,Bi,vs,de=Ht.dyn_tree,Qn=Ht.max_code,ua=Ht.stat_desc.static_tree,pa=Ht.stat_desc.has_stree,fa=Ht.stat_desc.extra_bits,Kn=Ht.stat_desc.extra_base,ci=Ht.stat_desc.max_length,zi=0;for(At=0;At<=E;At++)pt.bl_count[At]=0;for(de[2*pt.heap[pt.heap_max]+1]=0,hi=pt.heap_max+1;hi<f;hi++)ci<(At=de[2*de[2*(oe=pt.heap[hi])+1]+1]+1)&&(At=ci,zi++),de[2*oe+1]=At,Qn<oe||(pt.bl_count[At]++,Bi=0,Kn<=oe&&(Bi=fa[oe-Kn]),vs=de[2*oe],pt.opt_len+=vs*(At+Bi),pa&&(pt.static_len+=vs*(ua[2*oe+1]+Bi)));if(zi!==0){do{for(At=ci-1;pt.bl_count[At]===0;)At--;pt.bl_count[At]--,pt.bl_count[At+1]+=2,pt.bl_count[ci]--,zi-=2}while(0<zi);for(At=ci;At!==0;At--)for(oe=pt.bl_count[At];oe!==0;)Qn<(li=pt.heap[--hi])||(de[2*li+1]!==At&&(pt.opt_len+=(At-de[2*li+1])*de[2*li],de[2*li+1]=At),oe--)}}(S,L),Ft(Q,gt,S.bl_count)}function _(S,L,W){var X,D,Q=-1,et=L[1],K=0,ot=7,gt=4;for(et===0&&(ot=138,gt=3),L[2*(W+1)+1]=65535,X=0;X<=W;X++)D=et,et=L[2*(X+1)+1],++K<ot&&D===et||(K<gt?S.bl_tree[2*D]+=K:D!==0?(D!==Q&&S.bl_tree[2*D]++,S.bl_tree[2*T]++):K<=10?S.bl_tree[2*y]++:S.bl_tree[2*O]++,Q=D,gt=(K=0)===et?(ot=138,3):D===et?(ot=6,3):(ot=7,4))}function H(S,L,W){var X,D,Q=-1,et=L[1],K=0,ot=7,gt=4;for(et===0&&(ot=138,gt=3),X=0;X<=W;X++)if(D=et,et=L[2*(X+1)+1],!(++K<ot&&D===et)){if(K<gt)for(;q(S,D,S.bl_tree),--K!=0;);else D!==0?(D!==Q&&(q(S,D,S.bl_tree),K--),q(S,T,S.bl_tree),tt(S,K-3,2)):K<=10?(q(S,y,S.bl_tree),tt(S,K-3,3)):(q(S,O,S.bl_tree),tt(S,K-11,7));Q=D,gt=(K=0)===et?(ot=138,3):D===et?(ot=6,3):(ot=7,4)}}h(j);var Y=!1;function v(S,L,W,X){tt(S,(l<<1)+(X?1:0),3),function(D,Q,et,K){dt(D),st(D,et),st(D,~et),n.arraySet(D.pending_buf,D.window,Q,et,D.pending),D.pending+=et}(S,L,W)}s._tr_init=function(S){Y||(function(){var L,W,X,D,Q,et=new Array(E+1);for(D=X=0;D<c-1;D++)for(M[D]=X,L=0;L<1<<A[D];L++)w[X++]=D;for(w[X-1]=D,D=Q=0;D<16;D++)for(j[D]=Q,L=0;L<1<<N[D];L++)x[Q++]=D;for(Q>>=7;D<d;D++)for(j[D]=Q<<7,L=0;L<1<<N[D]-7;L++)x[256+Q++]=D;for(W=0;W<=E;W++)et[W]=0;for(L=0;L<=143;)z[2*L+1]=8,L++,et[8]++;for(;L<=255;)z[2*L+1]=9,L++,et[9]++;for(;L<=279;)z[2*L+1]=7,L++,et[7]++;for(;L<=287;)z[2*L+1]=8,L++,et[8]++;for(Ft(z,u+1,et),L=0;L<d;L++)F[2*L+1]=5,F[2*L]=wt(L,5);Z=new nt(z,A,p+1,u,E),V=new nt(F,N,0,d,E),J=new nt(new Array(0),b,0,m,C)}(),Y=!0),S.l_desc=new k(S.dyn_ltree,Z),S.d_desc=new k(S.dyn_dtree,V),S.bl_desc=new k(S.bl_tree,J),S.bi_buf=0,S.bi_valid=0,rt(S)},s._tr_stored_block=v,s._tr_flush_block=function(S,L,W,X){var D,Q,et=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(K){var ot,gt=4093624447;for(ot=0;ot<=31;ot++,gt>>>=1)if(1&gt&&K.dyn_ltree[2*ot]!==0)return r;if(K.dyn_ltree[18]!==0||K.dyn_ltree[20]!==0||K.dyn_ltree[26]!==0)return o;for(ot=32;ot<p;ot++)if(K.dyn_ltree[2*ot]!==0)return o;return r}(S)),xt(S,S.l_desc),xt(S,S.d_desc),et=function(K){var ot;for(_(K,K.dyn_ltree,K.l_desc.max_code),_(K,K.dyn_dtree,K.d_desc.max_code),xt(K,K.bl_desc),ot=m-1;3<=ot&&K.bl_tree[2*P[ot]+1]===0;ot--);return K.opt_len+=3*(ot+1)+5+5+4,ot}(S),D=S.opt_len+3+7>>>3,(Q=S.static_len+3+7>>>3)<=D&&(D=Q)):D=Q=W+5,W+4<=D&&L!==-1?v(S,L,W,X):S.strategy===4||Q===D?(tt(S,2+(X?1:0),3),Gt(S,z,F)):(tt(S,4+(X?1:0),3),function(K,ot,gt,pt){var Ht;for(tt(K,ot-257,5),tt(K,gt-1,5),tt(K,pt-4,4),Ht=0;Ht<pt;Ht++)tt(K,K.bl_tree[2*P[Ht]+1],3);H(K,K.dyn_ltree,ot-1),H(K,K.dyn_dtree,gt-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,et+1),Gt(S,S.dyn_ltree,S.dyn_dtree)),rt(S),X&&dt(S)},s._tr_tally=function(S,L,W){return S.pending_buf[S.d_buf+2*S.last_lit]=L>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&L,S.pending_buf[S.l_buf+S.last_lit]=255&W,S.last_lit++,L===0?S.dyn_ltree[2*W]++:(S.matches++,L--,S.dyn_ltree[2*(w[W]+p+1)]++,S.dyn_dtree[2*B(L)]++),S.last_lit===S.lit_bufsize-1},s._tr_align=function(S){tt(S,2,3),q(S,R,z),function(L){L.bi_valid===16?(st(L,L.bi_buf),L.bi_buf=0,L.bi_valid=0):8<=L.bi_valid&&(L.pending_buf[L.pending++]=255&L.bi_buf,L.bi_buf>>=8,L.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(e,i,s){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,i,s){(function(n){(function(r,o){if(!r.setImmediate){var h,l,c,p,u=1,d={},m=!1,f=r.document,E=Object.getPrototypeOf&&Object.getPrototypeOf(r);E=E&&E.setTimeout?E:r,h={}.toString.call(r.process)==="[object process]"?function(T){process.nextTick(function(){C(T)})}:function(){if(r.postMessage&&!r.importScripts){var T=!0,y=r.onmessage;return r.onmessage=function(){T=!1},r.postMessage("","*"),r.onmessage=y,T}}()?(p="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",R,!1):r.attachEvent("onmessage",R),function(T){r.postMessage(p+T,"*")}):r.MessageChannel?((c=new MessageChannel).port1.onmessage=function(T){C(T.data)},function(T){c.port2.postMessage(T)}):f&&"onreadystatechange"in f.createElement("script")?(l=f.documentElement,function(T){var y=f.createElement("script");y.onreadystatechange=function(){C(T),y.onreadystatechange=null,l.removeChild(y),y=null},l.appendChild(y)}):function(T){setTimeout(C,0,T)},E.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var y=new Array(arguments.length-1),O=0;O<y.length;O++)y[O]=arguments[O+1];var A={callback:T,args:y};return d[u]=A,h(u),u++},E.clearImmediate=I}function I(T){delete d[T]}function C(T){if(m)setTimeout(C,0,T);else{var y=d[T];if(y){m=!0;try{(function(O){var A=O.callback,N=O.args;switch(N.length){case 0:A();break;case 1:A(N[0]);break;case 2:A(N[0],N[1]);break;case 3:A(N[0],N[1],N[2]);break;default:A.apply(o,N)}})(y)}finally{I(T),m=!1}}}}function R(T){T.source===r&&typeof T.data=="string"&&T.data.indexOf(p)===0&&C(+T.data.slice(p.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof cs<"u"?cs:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Yo);var Ll=Yo.exports;const zr=Pl(Ll);var Xn={},bs={};(function(a){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",e=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",i="["+t+"]["+e+"]*",s=new RegExp("^"+i+"$"),n=function(o,h){const l=[];let c=h.exec(o);for(;c;){const p=[];p.startIndex=h.lastIndex-c[0].length;const u=c.length;for(let d=0;d<u;d++)p.push(c[d]);l.push(p),c=h.exec(o)}return l},r=function(o){const h=s.exec(o);return!(h===null||typeof h>"u")};a.isExist=function(o){return typeof o<"u"},a.isEmptyObject=function(o){return Object.keys(o).length===0},a.merge=function(o,h,l){if(h){const c=Object.keys(h),p=c.length;for(let u=0;u<p;u++)l==="strict"?o[c[u]]=[h[c[u]]]:o[c[u]]=h[c[u]]}},a.getValue=function(o){return a.isExist(o)?o:""},a.isName=r,a.getAllMatches=n,a.nameRegexp=i})(bs);const Zn=bs,Ml={allowBooleanAttributes:!1,unpairedTags:[]};Xn.validate=function(a,t){t=Object.assign({},Ml,t);const e=[];let i=!1,s=!1;a[0]==="\uFEFF"&&(a=a.substr(1));for(let n=0;n<a.length;n++)if(a[n]==="<"&&a[n+1]==="?"){if(n+=2,n=Yr(a,n),n.err)return n}else if(a[n]==="<"){let r=n;if(n++,a[n]==="!"){n=Vr(a,n);continue}else{let o=!1;a[n]==="/"&&(o=!0,n++);let h="";for(;n<a.length&&a[n]!==">"&&a[n]!==" "&&a[n]!=="	"&&a[n]!==`
`&&a[n]!=="\r";n++)h+=a[n];if(h=h.trim(),h[h.length-1]==="/"&&(h=h.substring(0,h.length-1),n--),!Gl(h)){let p;return h.trim().length===0?p="Invalid space after '<'.":p="Tag '"+h+"' is an invalid name.",Ot("InvalidTag",p,Ut(a,n))}const l=Bl(a,n);if(l===!1)return Ot("InvalidAttr","Attributes for '"+h+"' have open quote.",Ut(a,n));let c=l.value;if(n=l.index,c[c.length-1]==="/"){const p=n-c.length;c=c.substring(0,c.length-1);const u=Gr(c,t);if(u===!0)i=!0;else return Ot(u.err.code,u.err.msg,Ut(a,p+u.err.line))}else if(o)if(l.tagClosed){if(c.trim().length>0)return Ot("InvalidTag","Closing tag '"+h+"' can't have attributes or invalid starting.",Ut(a,r));if(e.length===0)return Ot("InvalidTag","Closing tag '"+h+"' has not been opened.",Ut(a,r));{const p=e.pop();if(h!==p.tagName){let u=Ut(a,p.tagStartPos);return Ot("InvalidTag","Expected closing tag '"+p.tagName+"' (opened in line "+u.line+", col "+u.col+") instead of closing tag '"+h+"'.",Ut(a,r))}e.length==0&&(s=!0)}}else return Ot("InvalidTag","Closing tag '"+h+"' doesn't have proper closing.",Ut(a,n));else{const p=Gr(c,t);if(p!==!0)return Ot(p.err.code,p.err.msg,Ut(a,n-c.length+p.err.line));if(s===!0)return Ot("InvalidXml","Multiple possible root nodes found.",Ut(a,n));t.unpairedTags.indexOf(h)!==-1||e.push({tagName:h,tagStartPos:r}),i=!0}for(n++;n<a.length;n++)if(a[n]==="<")if(a[n+1]==="!"){n++,n=Vr(a,n);continue}else if(a[n+1]==="?"){if(n=Yr(a,++n),n.err)return n}else break;else if(a[n]==="&"){const p=Yl(a,n);if(p==-1)return Ot("InvalidChar","char '&' is not expected.",Ut(a,n));n=p}else if(s===!0&&!kr(a[n]))return Ot("InvalidXml","Extra text at the end",Ut(a,n));a[n]==="<"&&n--}}else{if(kr(a[n]))continue;return Ot("InvalidChar","char '"+a[n]+"' is not expected.",Ut(a,n))}if(i){if(e.length==1)return Ot("InvalidTag","Unclosed tag '"+e[0].tagName+"'.",Ut(a,e[0].tagStartPos));if(e.length>0)return Ot("InvalidXml","Invalid '"+JSON.stringify(e.map(n=>n.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Ot("InvalidXml","Start tag expected.",1);return!0};function kr(a){return a===" "||a==="	"||a===`
`||a==="\r"}function Yr(a,t){const e=t;for(;t<a.length;t++)if(a[t]=="?"||a[t]==" "){const i=a.substr(e,t-e);if(t>5&&i==="xml")return Ot("InvalidXml","XML declaration allowed only at the start of the document.",Ut(a,t));if(a[t]=="?"&&a[t+1]==">"){t++;break}else continue}return t}function Vr(a,t){if(a.length>t+5&&a[t+1]==="-"&&a[t+2]==="-"){for(t+=3;t<a.length;t++)if(a[t]==="-"&&a[t+1]==="-"&&a[t+2]===">"){t+=2;break}}else if(a.length>t+8&&a[t+1]==="D"&&a[t+2]==="O"&&a[t+3]==="C"&&a[t+4]==="T"&&a[t+5]==="Y"&&a[t+6]==="P"&&a[t+7]==="E"){let e=1;for(t+=8;t<a.length;t++)if(a[t]==="<")e++;else if(a[t]===">"&&(e--,e===0))break}else if(a.length>t+9&&a[t+1]==="["&&a[t+2]==="C"&&a[t+3]==="D"&&a[t+4]==="A"&&a[t+5]==="T"&&a[t+6]==="A"&&a[t+7]==="["){for(t+=8;t<a.length;t++)if(a[t]==="]"&&a[t+1]==="]"&&a[t+2]===">"){t+=2;break}}return t}const Dl='"',Ul="'";function Bl(a,t){let e="",i="",s=!1;for(;t<a.length;t++){if(a[t]===Dl||a[t]===Ul)i===""?i=a[t]:i!==a[t]||(i="");else if(a[t]===">"&&i===""){s=!0;break}e+=a[t]}return i!==""?!1:{value:e,index:t,tagClosed:s}}const zl=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function Gr(a,t){const e=Zn.getAllMatches(a,zl),i={};for(let s=0;s<e.length;s++){if(e[s][1].length===0)return Ot("InvalidAttr","Attribute '"+e[s][2]+"' has no space in starting.",Si(e[s]));if(e[s][3]!==void 0&&e[s][4]===void 0)return Ot("InvalidAttr","Attribute '"+e[s][2]+"' is without value.",Si(e[s]));if(e[s][3]===void 0&&!t.allowBooleanAttributes)return Ot("InvalidAttr","boolean attribute '"+e[s][2]+"' is not allowed.",Si(e[s]));const n=e[s][2];if(!Vl(n))return Ot("InvalidAttr","Attribute '"+n+"' is an invalid name.",Si(e[s]));if(!i.hasOwnProperty(n))i[n]=1;else return Ot("InvalidAttr","Attribute '"+n+"' is repeated.",Si(e[s]))}return!0}function kl(a,t){let e=/\d/;for(a[t]==="x"&&(t++,e=/[\da-fA-F]/);t<a.length;t++){if(a[t]===";")return t;if(!a[t].match(e))break}return-1}function Yl(a,t){if(t++,a[t]===";")return-1;if(a[t]==="#")return t++,kl(a,t);let e=0;for(;t<a.length;t++,e++)if(!(a[t].match(/\w/)&&e<20)){if(a[t]===";")break;return-1}return t}function Ot(a,t,e){return{err:{code:a,msg:t,line:e.line||e,col:e.col}}}function Vl(a){return Zn.isName(a)}function Gl(a){return Zn.isName(a)}function Ut(a,t){const e=a.substring(0,t).split(/\r?\n/);return{line:e.length,col:e[e.length-1].length+1}}function Si(a){return a.startIndex+a[1].length}var $n={};const Vo={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(a,t){return t},attributeValueProcessor:function(a,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(a,t,e){return a}},Hl=function(a){return Object.assign({},Vo,a)};$n.buildOptions=Hl;$n.defaultOptions=Vo;class Wl{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}var jl=Wl;const Xl=bs;function Zl(a,t){const e={};if(a[t+3]==="O"&&a[t+4]==="C"&&a[t+5]==="T"&&a[t+6]==="Y"&&a[t+7]==="P"&&a[t+8]==="E"){t=t+9;let i=1,s=!1,n=!1,r="";for(;t<a.length;t++)if(a[t]==="<"&&!n){if(s&&Kl(a,t))t+=7,[entityName,val,t]=$l(a,t+1),val.indexOf("&")===-1&&(e[ec(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(s&&ql(a,t))t+=8;else if(s&&Jl(a,t))t+=8;else if(s&&tc(a,t))t+=9;else if(Ql)n=!0;else throw new Error("Invalid DOCTYPE");i++,r=""}else if(a[t]===">"){if(n?a[t-1]==="-"&&a[t-2]==="-"&&(n=!1,i--):i--,i===0)break}else a[t]==="["?s=!0:r+=a[t];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:e,i:t}}function $l(a,t){let e="";for(;t<a.length&&a[t]!=="'"&&a[t]!=='"';t++)e+=a[t];if(e=e.trim(),e.indexOf(" ")!==-1)throw new Error("External entites are not supported");const i=a[t++];let s="";for(;t<a.length&&a[t]!==i;t++)s+=a[t];return[e,s,t]}function Ql(a,t){return a[t+1]==="!"&&a[t+2]==="-"&&a[t+3]==="-"}function Kl(a,t){return a[t+1]==="!"&&a[t+2]==="E"&&a[t+3]==="N"&&a[t+4]==="T"&&a[t+5]==="I"&&a[t+6]==="T"&&a[t+7]==="Y"}function ql(a,t){return a[t+1]==="!"&&a[t+2]==="E"&&a[t+3]==="L"&&a[t+4]==="E"&&a[t+5]==="M"&&a[t+6]==="E"&&a[t+7]==="N"&&a[t+8]==="T"}function Jl(a,t){return a[t+1]==="!"&&a[t+2]==="A"&&a[t+3]==="T"&&a[t+4]==="T"&&a[t+5]==="L"&&a[t+6]==="I"&&a[t+7]==="S"&&a[t+8]==="T"}function tc(a,t){return a[t+1]==="!"&&a[t+2]==="N"&&a[t+3]==="O"&&a[t+4]==="T"&&a[t+5]==="A"&&a[t+6]==="T"&&a[t+7]==="I"&&a[t+8]==="O"&&a[t+9]==="N"}function ec(a){if(Xl.isName(a))return a;throw new Error(`Invalid entity name ${a}`)}var ic=Zl;const sc=/^[-+]?0x[a-fA-F0-9]+$/,nc=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const rc={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function oc(a,t={}){if(t=Object.assign({},rc,t),!a||typeof a!="string")return a;let e=a.trim();if(t.skipLike!==void 0&&t.skipLike.test(e))return a;if(t.hex&&sc.test(e))return Number.parseInt(e,16);{const i=nc.exec(e);if(i){const s=i[1],n=i[2];let r=ac(i[3]);const o=i[4]||i[6];if(!t.leadingZeros&&n.length>0&&s&&e[2]!=="."||!t.leadingZeros&&n.length>0&&!s&&e[1]!==".")return a;{const h=Number(e),l=""+h;return l.search(/[eE]/)!==-1||o?t.eNotation?h:a:e.indexOf(".")!==-1?l==="0"&&r===""||l===r||s&&l==="-"+r?h:a:n?r===l||s+r===l?h:a:e===l||e===s+l?h:a}}else return a}}function ac(a){return a&&a.indexOf(".")!==-1&&(a=a.replace(/0+$/,""),a==="."?a="0":a[0]==="."?a="0"+a:a[a.length-1]==="."&&(a=a.substr(0,a.length-1))),a}var hc=oc;const Go=bs,Ai=jl,lc=ic,cc=hc;let dc=class{constructor(a){this.options=a,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(t,e)=>String.fromCharCode(Number.parseInt(e,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(t,e)=>String.fromCharCode(Number.parseInt(e,16))}},this.addExternalEntities=uc,this.parseXml=Ic,this.parseTextData=pc,this.resolveNameSpace=fc,this.buildAttributesMap=Ec,this.isItStopNode=_c,this.replaceEntitiesValue=Cc,this.readStopNodeData=yc,this.saveTextToParentTag=Tc,this.addChild=gc}};function uc(a){const t=Object.keys(a);for(let e=0;e<t.length;e++){const i=t[e];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:a[i]}}}function pc(a,t,e,i,s,n,r){if(a!==void 0&&(this.options.trimValues&&!i&&(a=a.trim()),a.length>0)){r||(a=this.replaceEntitiesValue(a));const o=this.options.tagValueProcessor(t,a,e,s,n);return o==null?a:typeof o!=typeof a||o!==a?o:this.options.trimValues?gn(a,this.options.parseTagValue,this.options.numberParseOptions):a.trim()===a?gn(a,this.options.parseTagValue,this.options.numberParseOptions):a}}function fc(a){if(this.options.removeNSPrefix){const t=a.split(":"),e=a.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(a=e+t[1])}return a}const mc=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Ec(a,t,e){if(!this.options.ignoreAttributes&&typeof a=="string"){const i=Go.getAllMatches(a,mc),s=i.length,n={};for(let r=0;r<s;r++){const o=this.resolveNameSpace(i[r][1]);let h=i[r][4],l=this.options.attributeNamePrefix+o;if(o.length)if(this.options.transformAttributeName&&(l=this.options.transformAttributeName(l)),l==="__proto__"&&(l="#__proto__"),h!==void 0){this.options.trimValues&&(h=h.trim()),h=this.replaceEntitiesValue(h);const c=this.options.attributeValueProcessor(o,h,t);c==null?n[l]=h:typeof c!=typeof h||c!==h?n[l]=c:n[l]=gn(h,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(n[l]=!0)}if(!Object.keys(n).length)return;if(this.options.attributesGroupName){const r={};return r[this.options.attributesGroupName]=n,r}return n}}const Ic=function(a){a=a.replace(/\r\n?/g,`
`);const t=new Ai("!xml");let e=t,i="",s="";for(let n=0;n<a.length;n++)if(a[n]==="<")if(a[n+1]==="/"){const r=Le(a,">",n,"Closing Tag is not closed.");let o=a.substring(n+2,r).trim();if(this.options.removeNSPrefix){const c=o.indexOf(":");c!==-1&&(o=o.substr(c+1))}this.options.transformTagName&&(o=this.options.transformTagName(o)),e&&(i=this.saveTextToParentTag(i,e,s));const h=s.substring(s.lastIndexOf(".")+1);if(o&&this.options.unpairedTags.indexOf(o)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${o}>`);let l=0;h&&this.options.unpairedTags.indexOf(h)!==-1?(l=s.lastIndexOf(".",s.lastIndexOf(".")-1),this.tagsNodeStack.pop()):l=s.lastIndexOf("."),s=s.substring(0,l),e=this.tagsNodeStack.pop(),i="",n=r}else if(a[n+1]==="?"){let r=In(a,n,!1,"?>");if(!r)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,e,s),!(this.options.ignoreDeclaration&&r.tagName==="?xml"||this.options.ignorePiTags)){const o=new Ai(r.tagName);o.add(this.options.textNodeName,""),r.tagName!==r.tagExp&&r.attrExpPresent&&(o[":@"]=this.buildAttributesMap(r.tagExp,s,r.tagName)),this.addChild(e,o,s)}n=r.closeIndex+1}else if(a.substr(n+1,3)==="!--"){const r=Le(a,"-->",n+4,"Comment is not closed.");if(this.options.commentPropName){const o=a.substring(n+4,r-2);i=this.saveTextToParentTag(i,e,s),e.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}n=r}else if(a.substr(n+1,2)==="!D"){const r=lc(a,n);this.docTypeEntities=r.entities,n=r.i}else if(a.substr(n+1,2)==="!["){const r=Le(a,"]]>",n,"CDATA is not closed.")-2,o=a.substring(n+9,r);i=this.saveTextToParentTag(i,e,s);let h=this.parseTextData(o,e.tagname,s,!0,!1,!0,!0);h==null&&(h=""),this.options.cdataPropName?e.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]):e.add(this.options.textNodeName,h),n=r+2}else{let r=In(a,n,this.options.removeNSPrefix),o=r.tagName;const h=r.rawTagName;let l=r.tagExp,c=r.attrExpPresent,p=r.closeIndex;this.options.transformTagName&&(o=this.options.transformTagName(o)),e&&i&&e.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,e,s,!1));const u=e;if(u&&this.options.unpairedTags.indexOf(u.tagname)!==-1&&(e=this.tagsNodeStack.pop(),s=s.substring(0,s.lastIndexOf("."))),o!==t.tagname&&(s+=s?"."+o:o),this.isItStopNode(this.options.stopNodes,s,o)){let d="";if(l.length>0&&l.lastIndexOf("/")===l.length-1)o[o.length-1]==="/"?(o=o.substr(0,o.length-1),s=s.substr(0,s.length-1),l=o):l=l.substr(0,l.length-1),n=r.closeIndex;else if(this.options.unpairedTags.indexOf(o)!==-1)n=r.closeIndex;else{const f=this.readStopNodeData(a,h,p+1);if(!f)throw new Error(`Unexpected end of ${h}`);n=f.i,d=f.tagContent}const m=new Ai(o);o!==l&&c&&(m[":@"]=this.buildAttributesMap(l,s,o)),d&&(d=this.parseTextData(d,o,s,!0,c,!0,!0)),s=s.substr(0,s.lastIndexOf(".")),m.add(this.options.textNodeName,d),this.addChild(e,m,s)}else{if(l.length>0&&l.lastIndexOf("/")===l.length-1){o[o.length-1]==="/"?(o=o.substr(0,o.length-1),s=s.substr(0,s.length-1),l=o):l=l.substr(0,l.length-1),this.options.transformTagName&&(o=this.options.transformTagName(o));const d=new Ai(o);o!==l&&c&&(d[":@"]=this.buildAttributesMap(l,s,o)),this.addChild(e,d,s),s=s.substr(0,s.lastIndexOf("."))}else{const d=new Ai(o);this.tagsNodeStack.push(e),o!==l&&c&&(d[":@"]=this.buildAttributesMap(l,s,o)),this.addChild(e,d,s),e=d}i="",n=p}}else i+=a[n];return t.child};function gc(a,t,e){const i=this.options.updateTag(t.tagname,e,t[":@"]);i===!1||(typeof i=="string"&&(t.tagname=i),a.addChild(t))}const Cc=function(a){if(this.options.processEntities){for(let t in this.docTypeEntities){const e=this.docTypeEntities[t];a=a.replace(e.regx,e.val)}for(let t in this.lastEntities){const e=this.lastEntities[t];a=a.replace(e.regex,e.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const e=this.htmlEntities[t];a=a.replace(e.regex,e.val)}a=a.replace(this.ampEntity.regex,this.ampEntity.val)}return a};function Tc(a,t,e,i){return a&&(i===void 0&&(i=Object.keys(t.child).length===0),a=this.parseTextData(a,t.tagname,e,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,i),a!==void 0&&a!==""&&t.add(this.options.textNodeName,a),a=""),a}function _c(a,t,e){const i="*."+e;for(const s in a){const n=a[s];if(i===n||t===n)return!0}return!1}function wc(a,t,e=">"){let i,s="";for(let n=t;n<a.length;n++){let r=a[n];if(i)r===i&&(i="");else if(r==='"'||r==="'")i=r;else if(r===e[0])if(e[1]){if(a[n+1]===e[1])return{data:s,index:n}}else return{data:s,index:n};else r==="	"&&(r=" ");s+=r}}function Le(a,t,e,i){const s=a.indexOf(t,e);if(s===-1)throw new Error(i);return s+t.length-1}function In(a,t,e,i=">"){const s=wc(a,t+1,i);if(!s)return;let n=s.data;const r=s.index,o=n.search(/\s/);let h=n,l=!0;o!==-1&&(h=n.substring(0,o),n=n.substring(o+1).trimStart());const c=h;if(e){const p=h.indexOf(":");p!==-1&&(h=h.substr(p+1),l=h!==s.data.substr(p+1))}return{tagName:h,tagExp:n,closeIndex:r,attrExpPresent:l,rawTagName:c}}function yc(a,t,e){const i=e;let s=1;for(;e<a.length;e++)if(a[e]==="<")if(a[e+1]==="/"){const n=Le(a,">",e,`${t} is not closed`);if(a.substring(e+2,n).trim()===t&&(s--,s===0))return{tagContent:a.substring(i,e),i:n};e=n}else if(a[e+1]==="?")e=Le(a,"?>",e+1,"StopNode is not closed.");else if(a.substr(e+1,3)==="!--")e=Le(a,"-->",e+3,"StopNode is not closed.");else if(a.substr(e+1,2)==="![")e=Le(a,"]]>",e,"StopNode is not closed.")-2;else{const n=In(a,e,">");n&&((n&&n.tagName)===t&&n.tagExp[n.tagExp.length-1]!=="/"&&s++,e=n.closeIndex)}}function gn(a,t,e){if(t&&typeof a=="string"){const i=a.trim();return i==="true"?!0:i==="false"?!1:cc(a,e)}else return Go.isExist(a)?a:""}var Rc=dc,Ho={};function Fc(a,t){return Wo(a,t)}function Wo(a,t,e){let i;const s={};for(let n=0;n<a.length;n++){const r=a[n],o=Sc(r);let h="";if(e===void 0?h=o:h=e+"."+o,o===t.textNodeName)i===void 0?i=r[o]:i+=""+r[o];else{if(o===void 0)continue;if(r[o]){let l=Wo(r[o],t,h);const c=Oc(l,t);r[":@"]?Ac(l,r[":@"],h,t):Object.keys(l).length===1&&l[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?l=l[t.textNodeName]:Object.keys(l).length===0&&(t.alwaysCreateTextNode?l[t.textNodeName]="":l=""),s[o]!==void 0&&s.hasOwnProperty(o)?(Array.isArray(s[o])||(s[o]=[s[o]]),s[o].push(l)):t.isArray(o,h,c)?s[o]=[l]:s[o]=l}}}return typeof i=="string"?i.length>0&&(s[t.textNodeName]=i):i!==void 0&&(s[t.textNodeName]=i),s}function Sc(a){const t=Object.keys(a);for(let e=0;e<t.length;e++){const i=t[e];if(i!==":@")return i}}function Ac(a,t,e,i){if(t){const s=Object.keys(t),n=s.length;for(let r=0;r<n;r++){const o=s[r];i.isArray(o,e+"."+o,!0,!0)?a[o]=[t[o]]:a[o]=t[o]}}}function Oc(a,t){const{textNodeName:e}=t,i=Object.keys(a).length;return!!(i===0||i===1&&(a[e]||typeof a[e]=="boolean"||a[e]===0))}Ho.prettify=Fc;const{buildOptions:bc}=$n,vc=Rc,{prettify:Nc}=Ho,xc=Xn;let Pc=class{constructor(a){this.externalEntities={},this.options=bc(a)}parse(a,t){if(typeof a!="string")if(a.toString)a=a.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(t){t===!0&&(t={});const s=xc.validate(a,t);if(s!==!0)throw Error(`${s.err.msg}:${s.err.line}:${s.err.col}`)}const e=new vc(this.options);e.addExternalEntities(this.externalEntities);const i=e.parseXml(a);return this.options.preserveOrder||i===void 0?i:Nc(i,this.options)}addEntity(a,t){if(t.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(a.indexOf("&")!==-1||a.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(t==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[a]=t}};var Lc=Pc;const Mc=`
`;function Dc(a,t){let e="";return t.format&&t.indentBy.length>0&&(e=Mc),jo(a,t,"",e)}function jo(a,t,e,i){let s="",n=!1;for(let r=0;r<a.length;r++){const o=a[r],h=Uc(o);if(h===void 0)continue;let l="";if(e.length===0?l=h:l=`${e}.${h}`,h===t.textNodeName){let m=o[h];Bc(l,t)||(m=t.tagValueProcessor(h,m),m=Xo(m,t)),n&&(s+=i),s+=m,n=!1;continue}else if(h===t.cdataPropName){n&&(s+=i),s+=`<![CDATA[${o[h][0][t.textNodeName]}]]>`,n=!1;continue}else if(h===t.commentPropName){s+=i+`<!--${o[h][0][t.textNodeName]}-->`,n=!0;continue}else if(h[0]==="?"){const m=Hr(o[":@"],t),f=h==="?xml"?"":i;let E=o[h][0][t.textNodeName];E=E.length!==0?" "+E:"",s+=f+`<${h}${E}${m}?>`,n=!0;continue}let c=i;c!==""&&(c+=t.indentBy);const p=Hr(o[":@"],t),u=i+`<${h}${p}`,d=jo(o[h],t,l,c);t.unpairedTags.indexOf(h)!==-1?t.suppressUnpairedNode?s+=u+">":s+=u+"/>":(!d||d.length===0)&&t.suppressEmptyNode?s+=u+"/>":d&&d.endsWith(">")?s+=u+`>${d}${i}</${h}>`:(s+=u+">",d&&i!==""&&(d.includes("/>")||d.includes("</"))?s+=i+t.indentBy+d+i:s+=d,s+=`</${h}>`),n=!0}return s}function Uc(a){const t=Object.keys(a);for(let e=0;e<t.length;e++){const i=t[e];if(a.hasOwnProperty(i)&&i!==":@")return i}}function Hr(a,t){let e="";if(a&&!t.ignoreAttributes)for(let i in a){if(!a.hasOwnProperty(i))continue;let s=t.attributeValueProcessor(i,a[i]);s=Xo(s,t),s===!0&&t.suppressBooleanAttributes?e+=` ${i.substr(t.attributeNamePrefix.length)}`:e+=` ${i.substr(t.attributeNamePrefix.length)}="${s}"`}return e}function Bc(a,t){a=a.substr(0,a.length-t.textNodeName.length-1);let e=a.substr(a.lastIndexOf(".")+1);for(let i in t.stopNodes)if(t.stopNodes[i]===a||t.stopNodes[i]==="*."+e)return!0;return!1}function Xo(a,t){if(a&&a.length>0&&t.processEntities)for(let e=0;e<t.entities.length;e++){const i=t.entities[e];a=a.replace(i.regex,i.val)}return a}var zc=Dc;const kc=zc,Yc={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(a,t){return t},attributeValueProcessor:function(a,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Oe(a){this.options=Object.assign({},Yc,a),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Hc),this.processTextOrObjNode=Vc,this.options.format?(this.indentate=Gc,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Oe.prototype.build=function(a){return this.options.preserveOrder?kc(a,this.options):(Array.isArray(a)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(a={[this.options.arrayNodeName]:a}),this.j2x(a,0).val)};Oe.prototype.j2x=function(a,t){let e="",i="";for(let s in a)if(Object.prototype.hasOwnProperty.call(a,s))if(typeof a[s]>"u")this.isAttribute(s)&&(i+="");else if(a[s]===null)this.isAttribute(s)?i+="":s[0]==="?"?i+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if(a[s]instanceof Date)i+=this.buildTextValNode(a[s],s,"",t);else if(typeof a[s]!="object"){const n=this.isAttribute(s);if(n)e+=this.buildAttrPairStr(n,""+a[s]);else if(s===this.options.textNodeName){let r=this.options.tagValueProcessor(s,""+a[s]);i+=this.replaceEntitiesValue(r)}else i+=this.buildTextValNode(a[s],s,"",t)}else if(Array.isArray(a[s])){const n=a[s].length;let r="",o="";for(let h=0;h<n;h++){const l=a[s][h];if(!(typeof l>"u"))if(l===null)s[0]==="?"?i+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if(typeof l=="object")if(this.options.oneListGroup){const c=this.j2x(l,t+1);r+=c.val,this.options.attributesGroupName&&l.hasOwnProperty(this.options.attributesGroupName)&&(o+=c.attrStr)}else r+=this.processTextOrObjNode(l,s,t);else if(this.options.oneListGroup){let c=this.options.tagValueProcessor(s,l);c=this.replaceEntitiesValue(c),r+=c}else r+=this.buildTextValNode(l,s,"",t)}this.options.oneListGroup&&(r=this.buildObjectNode(r,s,o,t)),i+=r}else if(this.options.attributesGroupName&&s===this.options.attributesGroupName){const n=Object.keys(a[s]),r=n.length;for(let o=0;o<r;o++)e+=this.buildAttrPairStr(n[o],""+a[s][n[o]])}else i+=this.processTextOrObjNode(a[s],s,t);return{attrStr:e,val:i}};Oe.prototype.buildAttrPairStr=function(a,t){return t=this.options.attributeValueProcessor(a,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+a:" "+a+'="'+t+'"'};function Vc(a,t,e){const i=this.j2x(a,e+1);return a[this.options.textNodeName]!==void 0&&Object.keys(a).length===1?this.buildTextValNode(a[this.options.textNodeName],t,i.attrStr,e):this.buildObjectNode(i.val,t,i.attrStr,e)}Oe.prototype.buildObjectNode=function(a,t,e,i){if(a==="")return t[0]==="?"?this.indentate(i)+"<"+t+e+"?"+this.tagEndChar:this.indentate(i)+"<"+t+e+this.closeTag(t)+this.tagEndChar;{let s="</"+t+this.tagEndChar,n="";return t[0]==="?"&&(n="?",s=""),(e||e==="")&&a.indexOf("<")===-1?this.indentate(i)+"<"+t+e+n+">"+a+s:this.options.commentPropName!==!1&&t===this.options.commentPropName&&n.length===0?this.indentate(i)+`<!--${a}-->`+this.newLine:this.indentate(i)+"<"+t+e+n+this.tagEndChar+a+this.indentate(i)+s}};Oe.prototype.closeTag=function(a){let t="";return this.options.unpairedTags.indexOf(a)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${a}`,t};Oe.prototype.buildTextValNode=function(a,t,e,i){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${a}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(i)+`<!--${a}-->`+this.newLine;if(t[0]==="?")return this.indentate(i)+"<"+t+e+"?"+this.tagEndChar;{let s=this.options.tagValueProcessor(t,a);return s=this.replaceEntitiesValue(s),s===""?this.indentate(i)+"<"+t+e+this.closeTag(t)+this.tagEndChar:this.indentate(i)+"<"+t+e+">"+s+"</"+t+this.tagEndChar}};Oe.prototype.replaceEntitiesValue=function(a){if(a&&a.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const e=this.options.entities[t];a=a.replace(e.regex,e.val)}return a};function Gc(a){return this.options.indentBy.repeat(a)}function Hc(a){return a.startsWith(this.options.attributeNamePrefix)&&a!==this.options.textNodeName?a.substr(this.attrPrefixLen):!1}var Wc=Oe;const jc=Xn,Xc=Lc,Zc=Wc;var $c={XMLParser:Xc,XMLValidator:jc,XMLBuilder:Zc};class Cn{constructor(t,e){g(this,"date",new Date),g(this,"author"),g(this,"guid",Ue.create()),g(this,"viewpoint"),g(this,"modifiedAuthor"),g(this,"modifiedDate"),g(this,"topic"),g(this,"_components"),g(this,"_comment",""),this._components=t,this._comment=e;const i=this._components.get(Bt);this.author=i.config.author}set comment(t){var e;const i=this._components.get(Bt);this._comment=t,this.modifiedDate=new Date,this.modifiedAuthor=i.config.author,(e=this.topic)==null||e.comments.set(this.guid,this)}get comment(){return this._comment}serialize(){let t=null;this.viewpoint&&(t=`<Viewpoint Guid="${this.viewpoint.guid}"/>`);let e=null;this.modifiedDate&&(e=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let i=null;return this.modifiedAuthor&&(i=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`),`
      <Comment Guid="${this.guid}">
        <Date>${this.date.toISOString()}</Date>
        <Author>${this.author}</Author>
        <Comment>${this.comment}</Comment>
        ${t??""}
        ${i??""}
        ${e??""}
      </Comment>
    `}}const Zo=class _e{constructor(t){g(this,"guid",Ue.create()),g(this,"title",_e.default.title),g(this,"creationDate",new Date),g(this,"creationAuthor",""),g(this,"viewpoints",new ei),g(this,"relatedTopics",new ei),g(this,"comments",new Ae),g(this,"customData",{}),g(this,"description"),g(this,"serverAssignedId"),g(this,"dueDate"),g(this,"modifiedAuthor"),g(this,"modifiedDate"),g(this,"index"),g(this,"_type",_e.default.type),g(this,"_status",_e.default.status),g(this,"_priority",_e.default.priority),g(this,"_stage",_e.default.priority),g(this,"_assignedTo",_e.default.assignedTo),g(this,"_labels",_e.default.labels),g(this,"_components"),this._components=t;const e=t.get(Bt);this.creationAuthor=e.config.author,this.relatedTopics.guard=i=>i!==this.guid}set type(t){const e=this._components.get(Bt),{strict:i,types:s}=e.config;(!i||s.has(t))&&(this._type=t)}get type(){return this._type}set status(t){const e=this._components.get(Bt),{strict:i,statuses:s}=e.config;(!i||s.has(t))&&(this._status=t)}get status(){return this._status}set priority(t){const e=this._components.get(Bt);if(t){const{strict:i,priorities:s}=e.config;if(!(!i||s.has(t)))return;this._priority=t}else this._priority=t}get priority(){return this._priority}set stage(t){const e=this._components.get(Bt);if(t){const{strict:i,stages:s}=e.config;if(!(!i||s.has(t)))return;this._stage=t}else this._stage=t}get stage(){return this._stage}set assignedTo(t){const e=this._components.get(Bt);if(t){const{strict:i,users:s}=e.config;if(!(!i||s.has(t)))return;this._assignedTo=t}else this._assignedTo=t}get assignedTo(){return this._assignedTo}set labels(t){const e=this._components.get(Bt),{strict:i,labels:s}=e.config;if(i){const n=new Set;for(const r of t)(!i||s.has(r))&&n.add(r);this._labels=n}else this._labels=t}get labels(){return this._labels}get _managerVersion(){return this._components.get(Bt).config.version}set(t){const e=t,i=this;for(const s in t){if(s==="guid")continue;const n=e[s];s in this&&(i[s]=n)}return this._components.get(Bt).list.set(this.guid,this),this}createComment(t,e){const i=new Cn(this._components,t);return i.viewpoint=e,i.topic=this,this.comments.set(i.guid,i),i}createLabelTags(t=this._managerVersion){let e="Labels";t==="2.1"&&(e="Labels"),t==="3"&&(e="Label");let i=[...this.labels].map(s=>`<${e}>${s}</${e}>`).join(`
`);for(const s in this.customData){const n=this.customData[s];typeof n=="string"&&(i+=`
<${e}>${n}</${e}>`)}return t==="2.1"?i:t==="3"?i.length!==0?`<Labels>
${i}
</Labels>`:"<Labels/>":i}createCommentTags(t=this._managerVersion){const e=[...this.comments.values()].map(i=>i.serialize()).join(`
`);return t==="2.1"?e:t==="3"?e.length!==0?`<Comments>
${e}
</Comments>`:"<Comments/>":e}createViewpointTags(t=this._managerVersion){let e="Viewpoints";t==="2.1"&&(e="Viewpoints"),t==="3"&&(e="ViewPoint");const i=this._components.get(me),s=[...this.viewpoints].map(n=>i.list.get(n)).filter(n=>n).map(n=>`<${e} Guid="${n.guid}">
          <Viewpoint>${n.guid}.bcfv</Viewpoint>
          <Snapshot>${n.guid}.jpeg</Snapshot>
        </${e}>
      `).join(`
`);return t==="2.1"?s:t==="3"?s.length!==0?`<Viewpoints>
${s}
</Viewpoints>`:"<Viewpoints />":s}createRelatedTopicTags(t=this._managerVersion){const e=[...this.relatedTopics].map(i=>`<RelatedTopic Guid="${i}"></RelatedTopic>
      `).join(`
`);return t==="2.1"?e:t==="3"?e.length!==0?`<RelatedTopics>
${e}
</RelatedTopics>`:"<RelatedTopics />":e}serialize(){const t=this._managerVersion;let e=null;this.serverAssignedId&&(e=`ServerAssignedId="${this.serverAssignedId}"`);let i=null;this.priority&&(i=`<Priority>${this.priority}</Priority>`);let s=null;this.index&&t==="2.1"&&(s=`<Index>${this.index}</Index>`);let n=null;this.modifiedDate&&(n=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let r=null;this.modifiedAuthor&&(r=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`);let o=null;this.dueDate&&(o=`<DueDate>${this.dueDate.toISOString()}</DueDate>`);let h=null;this.assignedTo&&(h=`<AssignedTo>${this.assignedTo}</AssignedTo>`);let l=null;this.description&&(l=`<Description>${this.description}</Description>`);let c=null;this.stage&&(c=`<Stage>${this.stage}</Stage>`);const p=this.createCommentTags(t),u=this.createViewpointTags(t),d=this.createLabelTags(t),m=this.createRelatedTopicTags(t);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Markup>
        <Topic Guid="${this.guid}" TopicType="${this.type}" TopicStatus="${this.status}" ${e??""}>
          <Title>${this.title}</Title>
          <CreationDate>${this.creationDate.toISOString()}</CreationDate>
          <CreationAuthor>${this.creationAuthor}</CreationAuthor>
          ${i??""}
          ${s??""}
          ${n??""}
          ${r??""}
          ${o??""}
          ${h??""}
          ${l??""}
          ${c??""}
          ${d}
          ${m}
          ${t==="3"?p:""}
          ${t==="3"?u:""}
        </Topic>
        ${t==="2.1"?p:""}
        ${t==="2.1"?u:""}
      </Markup>
    `}};g(Zo,"default",{title:"BCF Topic",type:"Issue",status:"Active",labels:new Set});let Wr=Zo;const Qc=(a,t)=>{if(t.trim()==="")return;const e=Bt.xmlParser.parse(t).Extensions;if(!e)return;const{Priorities:i,TopicStatuses:s,TopicTypes:n,Users:r}=e;if(i&&i.Priority){const o=Array.isArray(i.Priority)?i.Priority:[i.Priority];for(const h of o)a.config.priorities.add(h)}if(s&&s.TopicStatus){const o=Array.isArray(s.TopicStatus)?s.TopicStatus:[s.TopicStatus];for(const h of o)a.config.statuses.add(h)}if(n&&n.TopicType){const o=Array.isArray(n.TopicType)?n.TopicType:[n.TopicType];for(const h of o)a.config.types.add(h)}if(r&&r.User){const o=Array.isArray(r.User)?r.User:[r.User];for(const h of o)a.config.users.add(h)}},Tn=class Es extends St{constructor(){super(...arguments),g(this,"enabled",!1),g(this,"config",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1}),g(this,"list",new Ae),g(this,"onSetup",new $),g(this,"isSetup",!1),g(this,"onBCFImported",new $),g(this,"onDisposed",new $)}setup(t){this.isSetup||(this.config={...this.config,...t},this.isSetup=!0,this.enabled=!0,this.onSetup.trigger())}create(t){const e=new Wr(this.components);return t&&(e.guid=t.guid??e.guid,e.set(t)),this.list.set(e.guid,e),e}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const t=[...this.list].map(([e,i])=>i.type);return new Set(t)}get usedStatuses(){const t=[...this.list].map(([e,i])=>i.status);return new Set(t)}get usedPriorities(){const t=[...this.list].map(([e,i])=>i.priority).filter(e=>e);return new Set(t)}get usedStages(){const t=[...this.list].map(([e,i])=>i.stage).filter(e=>e);return new Set(t)}get usedUsers(){const t=[];for(const[e,i]of this.list){t.push(i.creationAuthor),i.assignedTo&&t.push(i.assignedTo),i.modifiedAuthor&&t.push(i.modifiedAuthor);for(const[s,n]of i.comments)t.push(n.author),n.modifiedAuthor&&t.push(n.modifiedAuthor)}return new Set(t)}get usedLabels(){const t=[];for(const[e,i]of this.list)t.push(...i.labels);return new Set(t)}updateExtensions(){for(const[t,e]of this.list){for(const i of e.labels)this.config.labels.add(i);this.config.types.add(e.type),e.priority&&this.config.priorities.add(e.priority),e.stage&&this.config.stages.add(e.stage),this.config.statuses.add(e.status),this.config.users.add(e.creationAuthor),e.assignedTo&&this.config.users.add(e.assignedTo),e.modifiedAuthor&&this.config.users.add(e.modifiedAuthor);for(const[i,s]of e.comments)this.config.users.add(s.author),s.modifiedAuthor&&this.config.users.add(s.modifiedAuthor)}}updateViewpointReferences(){const t=this.components.get(me);for(const[e,i]of this.list)for(const s of i.viewpoints)t.list.has(s)||i.viewpoints.delete(s)}async export(t=this.list.values()){const e=new zr;e.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`),e.file("bcf.extensions",this.serializeExtensions());const i=await(await fetch("https://thatopen.github.io/engine_components/resources/favicon.ico")).blob(),s=this.components.get(me);for(const n of t){const r=e.folder(n.guid);r.file("markup.bcf",n.serialize());for(const o of n.viewpoints){const h=s.list.get(o);h&&(r.file(`${o}.jpeg`,i,{binary:!0}),r.file(`${o}.bcfv`,await h.serialize()))}}return await e.generateAsync({type:"blob"})}serializeExtensions(){const t=[...this.config.types].map(o=>`<TopicType>${o}</TopicType>`).join(`
`),e=[...this.config.statuses].map(o=>`<TopicStatus>${o}</TopicStatus>`).join(`
`),i=[...this.config.priorities].map(o=>`<Priority>${o}</Priority>`).join(`
`),s=[...this.config.labels].map(o=>`<TopicLabel>${o}</TopicLabel>`).join(`
`),n=[...this.config.stages].map(o=>`<Stage>${o}</Stage>`).join(`
`),r=[...this.config.users].map(o=>`<User>${o}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${t.length!==0?`<TopicTypes>
${t}
</TopicTypes>`:""}
        ${e.length!==0?`<TopicStatuses>
${e}
</TopicStatuses>`:""}
        ${i.length!==0?`<Priorities>
${i}
</Priorities>`:""}
        ${s.length!==0?`<TopicLabels>
${s}
</TopicLabels>`:""}
        ${n.length!==0?`<Stages>
${n}
</Stages>`:""}
        ${r.length!==0?`<Users>
${r}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(t){const{Guid:e,Date:i,Author:s,Comment:n,Viewpoint:r}=t;if(!(e&&i&&s&&(Cn||r)))return null;const o=this.components.get(me),h=new Cn(this.components,n??"");return h.guid=e,h.date=new Date(i),h.author=s,h.viewpoint=r!=null&&r.Guid?o.list.get(r.Guid):void 0,h.modifiedAuthor=t.ModifiedAuthor,h.modifiedDate=t.ModifiedDate?new Date(t.ModifiedDate):void 0,h}getMarkupComments(t,e){var i;let s;if(e==="2.1"&&(s=t.Comment),e==="3"&&(s=(i=t.Topic.Comments)==null?void 0:i.Comment),!s)return[];s=Array.isArray(s)?s:[s];const n=s.map(r=>this.processMarkupComment(r)).filter(r=>r);return Array.isArray(n)?n:[n]}getMarkupLabels(t,e){var i;let s;return e==="2.1"&&(s=t.Topic.Labels),e==="3"&&(s=(i=t.Topic.Labels)==null?void 0:i.Label),s?Array.isArray(s)?s:[s]:[]}getMarkupViewpoints(t,e){var i;let s;return e==="2.1"&&(s=t.Viewpoints),e==="3"&&(s=(i=t.Topic.Viewpoints)==null?void 0:i.ViewPoint),s?(s=Array.isArray(s)?s:[s],s):[]}getMarkupRelatedTopics(t,e){var i;let s;return e==="2.1"&&(s=t.Topic.RelatedTopic),e==="3"&&(s=(i=t.Topic.RelatedTopics)==null?void 0:i.RelatedTopic),s?(Array.isArray(s)?s:[s]).map(n=>n.Guid):[]}async load(t,e){var i;const{fallbackVersionOnImport:s,ignoreIncompleteTopicsOnImport:n,updateExtensionsOnImport:r}=this.config,o=new zr;await o.loadAsync(t);const h=Object.values(o.files);let l=s;const c=h.find(C=>C.name.endsWith(".version"));if(c){const C=await c.async("string"),R=Es.xmlParser.parse(C).Version.VersionId;l=String(R)}if(!(l&&(l==="2.1"||l==="3")))throw new Error(`BCFTopics: ${l} is not supported.`);const p=h.find(C=>C.name.endsWith(".extensions"));if(r&&p){const C=await p.async("string");Qc(this,C)}const u=[],d=this.components.get(me),m=h.filter(C=>C.name.endsWith(".bcfv"));for(const C of m){const R=await C.async("string"),T=Es.xmlParser.parse(R).VisualizationInfo;if(!T){console.warn("Missing VisualizationInfo in Viewpoint");continue}const y={},{Guid:O,ClippingPlanes:A,Components:N,OrthogonalCamera:b,PerspectiveCamera:P}=T;if(O&&(y.guid=O),N){const{Selection:F,Visibility:x}=N;if(F&&F.Component){const M=Array.isArray(F.Component)?F.Component:[F.Component];y.selectionComponents=M.map(Z=>Z.IfcGuid).filter(Z=>Z)}if(x&&"DefaultVisibility"in x&&(y.defaultVisibility=x.DefaultVisibility),x&&x.Exceptions&&"Component"in x.Exceptions){const{Component:M}=x.Exceptions,Z=Array.isArray(M)?M:[M];y.exceptionComponents=Z.map(V=>V.IfcGuid).filter(V=>V)}let w;l==="2.1"&&(w=N.ViewSetupHints),l==="3"&&(w=(i=N.Visibility)==null?void 0:i.ViewSetupHints),w&&("OpeningsVisible"in w&&(y.openingsVisible=w.OpeningsVisible),"SpacesVisible"in w&&(y.spacesVisible=w.SpacesVisible),"SpaceBoundariesVisible"in w&&(y.spaceBoundariesVisible=w.SpaceBoundariesVisible))}if(b||P){const F=T.PerspectiveCamera??T.OrthogonalCamera,{CameraViewPoint:x,CameraDirection:w}=F,M=new U(Number(x.X),Number(x.Z),Number(-x.Y)),Z=new U(Number(w.X),Number(w.Z),Number(-w.Y)),V={position:{x:M.x,y:M.y,z:M.z},direction:{x:Z.x,y:Z.y,z:Z.z},aspectRatio:"AspectRatio"in F?F.AspectRatio:1};"ViewToWorldScale"in F&&(y.camera={...V,viewToWorldScale:F.ViewToWorldScale}),"FieldOfView"in F&&(y.camera={...V,fov:F.FieldOfView})}const z=new ra(this.components,e,{data:y,setCamera:!1});if(N){const{Coloring:F}=N;if(F&&F.Color){const x=Array.isArray(F.Color)?F.Color:[F.Color];for(const w of x){const{Color:M,Component:Z}=w,V=(Array.isArray(Z)?Z:[Z]).map(J=>J.IfcGuid);z.componentColors.set(M,V)}}}if(u.push(z),A){const F=this.components.get(wl),x=Array.isArray(A.ClippingPlane)?A.ClippingPlane:[A.ClippingPlane];for(const w of x){const{Location:M,Direction:Z}=w;if(!(M&&Z))continue;const V=new U(M.X,M.Z,-M.Y),J=new U(Z.X,-Z.Z,Z.Y),j=F.createFromNormalAndCoplanarPoint(e,J,V);j.visible=!1,j.enabled=!1,z.clippingPlanes.add(j)}}}const f={},E=[],I=h.filter(C=>C.name.endsWith(".bcf"));for(const C of I){const R=await C.async("string"),T=Es.xmlParser.parse(R).Markup,y=T.Topic,{Guid:O,TopicType:A,TopicStatus:N,Title:b,CreationDate:P,CreationAuthor:z}=y;if(n&&!(O&&A&&N&&b&&P&&z))continue;const F=new Wr(this.components);F.guid=O??F.guid;const x=this.getMarkupRelatedTopics(T,l);f[F.guid]=new Set(x),F.type=A??F.type,F.status=N??F.status,F.title=b??F.title,F.creationDate=P?new Date(P):F.creationDate,F.creationAuthor=z??F.creationAuthor,F.serverAssignedId=y.ServerAssignedId,F.priority=y.Priority,F.index=y.Index,F.modifiedDate=y.ModifiedDate?new Date(y.ModifiedDate):void 0,F.modifiedAuthor=y.ModifiedAuthor,F.dueDate=y.DueDate?new Date(y.DueDate):void 0,F.assignedTo=y.AssignedTo,F.description=y.Description,F.stage=y.Stage;const w=this.getMarkupLabels(T,l);for(const V of w)F.labels.add(V);const M=this.getMarkupComments(T,l);for(const V of M)F.comments.set(V.guid,V);const Z=this.getMarkupViewpoints(T,l);for(const V of Z){if(!(V&&V.Guid))continue;const J=d.list.get(V.Guid);J&&F.viewpoints.add(J.guid)}this.list.set(F.guid,F),E.push(F)}for(const C in f){const R=this.list.get(C);if(!R)continue;const T=f[C];for(const y of T)R.relatedTopics.add(y)}return this.onBCFImported.trigger(E),{viewpoints:u,topics:E}}};g(Tn,"uuid","de977976-e4f6-4e4f-a01a-204727839802"),g(Tn,"xmlParser",new $c.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let Bt=Tn;const $o=class pe extends St{constructor(t){super(t),g(this,"enabled",!0),g(this,"onDisposed",new $),g(this,"_absoluteMin"),g(this,"_absoluteMax"),g(this,"_meshes",[]),this.components.add(pe.uuid,this),this._absoluteMin=pe.newBound(!0),this._absoluteMax=pe.newBound(!1)}static getDimensions(t){const{min:e,max:i}=t,s=Math.abs(i.x-e.x),n=Math.abs(i.y-e.y),r=Math.abs(i.z-e.z),o=new U;return o.subVectors(i,e).divideScalar(2).add(e),{width:s,height:n,depth:r,center:o}}static newBound(t){const e=t?1:-1;return new U(e*Number.MAX_VALUE,e*Number.MAX_VALUE,e*Number.MAX_VALUE)}static getBounds(t,e,i){const s=i||this.newBound(!1),n=e||this.newBound(!0);for(const r of t)r.x<n.x&&(n.x=r.x),r.y<n.y&&(n.y=r.y),r.z<n.z&&(n.z=r.z),r.x>s.x&&(s.x=r.x),r.y>s.y&&(s.y=r.y),r.z>s.z&&(s.z=r.z);return new Nt(e,i)}dispose(){const t=this.components.get(ri);for(const e of this._meshes)t.destroy(e);this._meshes=[],this.onDisposed.trigger(pe.uuid),this.onDisposed.reset()}get(){const t=this._absoluteMin.clone(),e=this._absoluteMax.clone();return new Nt(t,e)}getSphere(){const t=this._absoluteMin.clone(),e=this._absoluteMax.clone(),i=Math.abs((e.x-t.x)/2),s=Math.abs((e.y-t.y)/2),n=Math.abs((e.z-t.z)/2),r=new U(t.x+i,t.y+s,t.z+n),o=r.distanceTo(t);return new Ts(r,o)}getMesh(){const t=new Nt(this._absoluteMin,this._absoluteMax),e=pe.getDimensions(t),{width:i,height:s,depth:n,center:r}=e,o=new Pt(i,s,n),h=new it(o);return this._meshes.push(h),h.position.copy(r),h}reset(){this._absoluteMin=pe.newBound(!0),this._absoluteMax=pe.newBound(!1)}add(t){for(const e of t.items)this.addMesh(e.mesh)}addMesh(t,e){if(!t.geometry.index)return;const i=pe.getFragmentBounds(t);t.updateMatrixWorld();const s=t.matrixWorld,n=new ut,r=t instanceof Me,o=new Set;if(t instanceof Fa){e||(e=t.fragment.ids);for(const h of e){const l=t.fragment.getInstancesIDs(h);if(l)for(const c of l)o.add(c)}}else o.add(0);for(const h of o){const l=i.min.clone(),c=i.max.clone();r&&(t.getMatrixAt(h,n),l.applyMatrix4(n),c.applyMatrix4(n)),l.applyMatrix4(s),c.applyMatrix4(s),l.x<this._absoluteMin.x&&(this._absoluteMin.x=l.x),l.y<this._absoluteMin.y&&(this._absoluteMin.y=l.y),l.z<this._absoluteMin.z&&(this._absoluteMin.z=l.z),l.x>this._absoluteMax.x&&(this._absoluteMax.x=l.x),l.y>this._absoluteMax.y&&(this._absoluteMax.y=l.y),l.z>this._absoluteMax.z&&(this._absoluteMax.z=l.z),c.x>this._absoluteMax.x&&(this._absoluteMax.x=c.x),c.y>this._absoluteMax.y&&(this._absoluteMax.y=c.y),c.z>this._absoluteMax.z&&(this._absoluteMax.z=c.z),c.x<this._absoluteMin.x&&(this._absoluteMin.x=c.x),c.y<this._absoluteMin.y&&(this._absoluteMin.y=c.y),c.z<this._absoluteMin.z&&(this._absoluteMin.z=c.z)}}addFragmentIdMap(t){const e=this.components.get(Tt);for(const i in t){const s=e.list.get(i);if(!s)continue;const n=t[i];this.addMesh(s.mesh,n)}}static getFragmentBounds(t){const e=t.geometry.attributes.position,i=Number.MAX_VALUE,s=-i,n=new U(i,i,i),r=new U(s,s,s);if(!t.geometry.index)throw new Error("Geometry must be indexed!");const o=Array.from(t.geometry.index.array);for(let h=0;h<o.length;h++){if(h%3===0&&o[h]===0&&o[h+1]===0&&o[h+2]===0){h+=2;continue}const l=o[h],c=e.getX(l),p=e.getY(l),u=e.getZ(l);c<n.x&&(n.x=c),p<n.y&&(n.y=p),u<n.z&&(n.z=u),c>r.x&&(r.x=c),p>r.y&&(r.y=p),u>r.z&&(r.z=u)}return new Nt(n,r)}};g($o,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let Kc=$o;const Qo=class Ko extends St{constructor(t){super(t),g(this,"enabled",!0),g(this,"list",{}),g(this,"onDisposed",new $),g(this,"onFragmentsDisposed",e=>{const{groupID:i,fragmentIDs:s}=e;for(const n in this.list){const r=this.list[n],o=Object.keys(r);if(o.includes(i))delete r[i],Object.values(r).length===0&&delete this.list[n];else for(const h of o){const l=r[h];for(const c of s)delete l.map[c];Object.values(l).length===0&&delete r[h]}}}),t.add(Ko.uuid,this),t.get(Tt).onFragmentsDisposed.add(this.onFragmentsDisposed)}dispose(){this.list={},this.components.get(Tt).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(),this.onDisposed.reset()}remove(t){for(const e in this.list){const i=this.list[e];for(const s in i){const n=i[s];delete n.map[t]}}}find(t){const e=this.components.get(Tt);if(!t){const r={};for(const[o,h]of e.list)r[o]=new Set(h.ids);return r}const i=Object.keys(t).length,s={};for(const r in t){const o=t[r];if(!this.list[r]){console.warn(`Classification ${r} does not exist.`);continue}for(const h of o){const l=this.list[r][h];if(l)for(const c in l.map){s[c]||(s[c]=new Map);for(const p of l.map[c]){const u=s[c].get(p);u===void 0?s[c].set(p,1):s[c].set(p,u+1)}}}}const n={};for(const r in s){const o=s[r];for(const[h,l]of o){if(l===void 0)throw new Error("Malformed fragments map!");l===i&&(n[r]||(n[r]=new Set),n[r].add(h))}}return n}byModel(t,e){this.list.models||(this.list.models={});const i=this.list.models;i[t]||(i[t]={map:{},id:null,name:t});const s=i[t];for(const[n,r]of e.data){const o=r[0];for(const h of o){const l=e.keyFragments.get(h);l&&(s.map[l]||(s.map[l]=new Set),s.map[l].add(n))}}}async byPredefinedType(t){var e;this.list.predefinedTypes||(this.list.predefinedTypes={});const i=this.list.predefinedTypes,s=t.getAllPropertiesIDs();for(const n of s){const r=await t.getProperties(n);if(!r)continue;const o=String((e=r.PredefinedType)==null?void 0:e.value).toUpperCase();i[o]||(i[o]={map:{},id:null,name:o});const h=i[o];for(const[l,c]of t.data){const p=c[0];for(const u of p){const d=t.keyFragments.get(u);if(!d)throw new Error("Fragment ID not found!");h.map[d]||(h.map[d]=new Set),h.map[d].add(r.expressID)}}}}byEntity(t){this.list.entities||(this.list.entities={});for(const[e,i]of t.data){const s=i[1][1],n=Oo[s];this.saveItem(t,"entities",n,e)}}async byIfcRel(t,e,i){ii.isRel(e)&&await ii.getRelationMap(t,e,async(s,n)=>{const{name:r}=await ii.getEntityName(t,s);for(const o of n)this.saveItem(t,i,r??"NO REL NAME",o)})}async bySpatialStructure(t,e={}){var i,s;const n=this.components.get(Pi),r=n.relationMaps[t.uuid];if(!r)throw new Error(`Classifier: model relations of ${t.name||t.uuid} have to exists to group by spatial structure.`);const o="spatialStructures",h=e.useProperties===void 0||e.useProperties;for(const[l]of r){if(e.isolate){const d=t.data.get(l);if(!d)continue;const m=d[1][1];if(m===void 0||!e.isolate.has(m))continue}const c=n.getEntityRelations(t,l,"Decomposes");if(c)for(const d of c){let m=d.toString();if(h){const f=await t.getProperties(d);if(!f)continue;m=(i=f.Name)==null?void 0:i.value}this.saveItem(t,o,m,l,d)}const p=n.getEntityRelations(t,l,"ContainsElements");if(!p)continue;let u=l.toString();if(h){const d=await t.getProperties(l);if(!d)continue;u=(s=d.Name)==null?void 0:s.value}for(const d of p){this.saveItem(t,o,u,d,l);const m=n.getEntityRelations(t,Number(d),"IsDecomposedBy");if(m)for(const f of m)this.saveItem(t,o,u,f,l)}}}setColor(t,e,i=!1){const s=this.components.get(Tt);for(const n in t){const r=s.list.get(n);if(!r)continue;const o=t[n];r.setColor(e,o,i)}}resetColor(t){const e=this.components.get(Tt);for(const i in t){const s=e.list.get(i);if(!s)continue;const n=t[i];s.resetColor(n)}}saveItem(t,e,i,s,n=null){this.list[e]||(this.list[e]={});const r=t.data.get(s);if(r)for(const o of r[0]){const h=t.keyFragments.get(o);if(h){const l=this.list[e];l[i]||(l[i]={map:{},id:n,name:i}),l[i].map[h]||(l[i].map[h]=new Set),l[i].map[h].add(s)}}}};g(Qo,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let _n=Qo;const qo=class Jo extends St{constructor(t){super(t),g(this,"onDisposed",new $),g(this,"enabled",!0),g(this,"height",10),g(this,"groupName","spatialStructures"),g(this,"list",new Set),t.add(Jo.uuid,this)}dispose(){this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}set(t){if(!this.enabled)return;const e=this.components.get(_n),i=this.components.get(Tt),s=t?1:-1;let n=0;const r=e.list[this.groupName],o=new ut;for(const h in r){o.elements[13]=n*s*this.height;for(const l in r[h].map){const c=i.list.get(l),p=h+l,u=this.list.has(p);if(!c||t&&u||!t&&!u)continue;t?this.list.add(p):this.list.delete(p);const d=r[h].map[l];c.applyTransform(d,o),c.mesh.computeBoundingSphere(),c.mesh.computeBoundingBox()}n++}}};g(qo,"uuid","d260618b-ce88-4c7d-826c-6debb91de3e2");let pd=qo;const ta=class ea extends St{constructor(t){super(t),g(this,"enabled",!0),this.components.add(ea.uuid,this)}set(t,e){const i=this.components.get(Tt);if(!e){for(const[s,n]of i.list)n&&(n.setVisibility(t),this.updateCulledVisibility(n));return}for(const s in e){const n=e[s],r=i.list.get(s);r&&(r.setVisibility(t,n),this.updateCulledVisibility(r))}}isolate(t){this.set(!1),this.set(!0,t)}updateCulledVisibility(t){const e=this.components.get(ll);for(const[i,s]of e.list){const n=s.colorMeshes.get(t.id);n&&(n.count=t.mesh.count)}}};g(ta,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let qc=ta;class Jc{constructor(){g(this,"factor",1),g(this,"complement",1)}apply(t){const e=this.getScaleMatrix().multiply(t);t.copy(e)}setUp(t){var e,i,s;this.factor=1;const n=this.getLengthUnits(t);if(!n)return;const r=n==null,o=n.Name===void 0||n.Name===null;r||o||(n.Name.value==="FOOT"&&(this.factor=.3048),((e=n.Prefix)==null?void 0:e.value)==="MILLI"?this.complement=.001:((i=n.Prefix)==null?void 0:i.value)==="CENTI"?this.complement=.01:((s=n.Prefix)==null?void 0:s.value)==="DECI"&&(this.complement=.01))}getLengthUnits(t){try{const e=t.GetLineIDsWithType(0,so).get(0),i=t.GetLine(0,e);for(const s of i.Units){if(!s||s.value===null||s.value===void 0)continue;const n=t.GetLine(0,s.value);if(n.UnitType&&n.UnitType.value==="LENGTHUNIT")return n}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const t=this.factor;return new ut().fromArray([t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1])}}class td{constructor(){g(this,"itemsByFloor",{}),g(this,"_units",new Jc)}setUp(t){this._units.setUp(t),this.cleanUp();try{const e=t.GetLineIDsWithType(0,Mi),i=new Set,s=t.GetLineIDsWithType(0,re);for(let l=0;l<s.size();l++)i.add(s.get(l));const n=t.GetLineIDsWithType(0,Di),r=n.size();for(let l=0;l<r;l++){const c=n.get(l),p=t.GetLine(0,c);if(!p||!p.RelatingObject||!p.RelatedObjects)continue;const u=p.RelatingObject.value,d=p.RelatedObjects;for(const m of d){const f=m.value;i.has(f)&&(this.itemsByFloor[f]=u)}}const o={},h=e.size();for(let l=0;l<h;l++){const c=e.get(l),p=t.GetLine(0,c);if(!p||!p.RelatingStructure||!p.RelatedElements)continue;const u=p.RelatingStructure.value,d=p.RelatedElements;if(i.has(u))for(const m of d){o[u]||(o[u]=[]);const f=m.value;o[u].push(f)}else for(const m of d){const f=m.value;this.itemsByFloor[f]=u}}for(const l in o){const c=this.itemsByFloor[l];if(c!==void 0){const p=o[l];for(const u of p)this.itemsByFloor[u]=c}}for(let l=0;l<r;l++){const c=n.get(l),p=t.GetLine(0,c);if(!p||!p.RelatingObject||!p.RelatedObjects)continue;const u=p.RelatingObject.value,d=p.RelatedObjects;for(const m of d){const f=m.value,E=this.itemsByFloor[u];E!==void 0&&(this.itemsByFloor[f]=E)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}}class ed{constructor(){g(this,"includeProperties",!0),g(this,"optionalCategories",[re]),g(this,"coordinate",!0),g(this,"wasm",{path:"",absolute:!1,logLevel:Qr.LOG_LEVEL_OFF}),g(this,"excludedCategories",new Set),g(this,"includedCategories",new Set),g(this,"saveLocations",!1),g(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),g(this,"autoSetWasm",!0),g(this,"customLocateFileHandler",null)}}class id{constructor(){g(this,"defLineMat",new An({color:16777215}))}read(t){const e=t.GetAllAlignments(0),i=t.GetAllCrossSections2D(0),s=t.GetAllCrossSections3D(0),n={IfcAlignment:e,IfcCrossSection2D:i,IfcCrossSection3D:s};return this.get(n)}get(t){if(t.IfcAlignment){const e=new Map;for(const i of t.IfcAlignment){const s=new Kr;s.absolute=this.getCurves(i.curve3D,s),s.horizontal=this.getCurves(i.horizontal,s),s.vertical=this.getCurves(i.vertical,s),e.set(e.size,s)}return{alignments:e,coordinationMatrix:new ut}}}getCurves(t,e){const i=[];let s=0;for(const n of t){const r={};if(n.data)for(const u of n.data){const[d,m]=u.split(": "),f=parseFloat(m);r[d]=f||m}const{points:o}=n,h=new Float32Array(o.length*3);for(let u=0;u<o.length;u++){const{x:d,y:m,z:f}=o[u];h[u*3]=d,h[u*3+1]=m,h[u*3+2]=f||0}const l=new Fe(h,3),c=new qr;c.setAttribute("position",l);const p=new Jr(s,r,e,c,this.defLineMat);i.push(p.curve),s++}return i}}class sd{getNameInfo(t){var e;const i={},{arguments:s}=t.GetHeaderLine(0,to)||{};if(!s)return i;const[n,r,o,h,l,c,p]=s;if(n!=null&&n.value&&(i.name=n.value),r!=null&&r.value&&(i.creationDate=new Date(r.value)),o){i.author={};const[u,d]=o;u!=null&&u.value&&(i.author.name=u.value),d!=null&&d.value&&(i.author.email=d.value)}return(e=h[0])!=null&&e.value&&(i.organization=h[0].value),l!=null&&l.value&&(i.preprocessorVersion=l==null?void 0:l.value),c!=null&&c.value&&(i.originatingSystem=c==null?void 0:c.value),p!=null&&p.value&&(i.authorization=p==null?void 0:p.value),i}getDescriptionInfo(t){var e;const i={},{arguments:s}=t.GetHeaderLine(0,eo)||{};if(!s)return i;const[n,r]=s;if((e=n[0])!=null&&e.value){const o=n[0].value.match(/\[([^\]]+)\]/);o&&o[1]&&(i.viewDefinition=o[1])}return r!=null&&r.value&&(i.implementationLevel=r.value),i}}class nd{static get(t,e){const i=[ys,Rs,Fs,Ss,re,no,ro,oo,ao],s=t.data;for(const n of i){const r=e.GetLineIDsWithType(0,n),o=r.size();for(let h=0;h<o;h++){const l=r.get(h);s.has(l)||s.set(l,[[],[0,n]])}}}}const ia=class wn extends St{constructor(t){super(t),g(this,"onDisposed",new $),g(this,"onIfcStartedLoading",new $),g(this,"onSetup",new $),g(this,"settings",new ed),g(this,"webIfc",new Re),g(this,"enabled",!0),g(this,"_material",new Is),g(this,"_spatialTree",new td),g(this,"_metaData",new sd),g(this,"_fragmentInstances",new Map),g(this,"_civil",new id),g(this,"_visitedFragments",new Map),g(this,"_materialT",new Is({transparent:!0,opacity:.5})),this.components.add(wn.uuid,this),this.settings.excludedCategories.add(Fn)}dispose(){this.webIfc=null,this.onDisposed.trigger(wn.uuid),this.onDisposed.reset()}async setup(t){this.settings={...this.settings,...t},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(t,e=!0){const i=performance.now();this.onIfcStartedLoading.trigger(),await this.readIfcFile(t);const s=await this.getAllGeometries(),n=await this.components.get(Do).export(this.webIfc,0);s.setLocalProperties(n);const r=this.components.get(Tt);r.groups.set(s.uuid,s);for(const o of s.items)r.list.set(o.id,o),o.mesh.uuid=o.id,o.group=s;r.onFragmentsLoaded.trigger(s),e&&r.coordinate([s]);for(const[o]of s.data){const h=n[o];if(!h||!h.GlobalId)continue;const l=h.GlobalId.value||h.GlobalId;s.globalToExpressIDs.set(l,o)}return nd.get(s,this.webIfc),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-i} ms!`),s}async readIfcFile(t){const{path:e,absolute:i,logLevel:s}=this.settings.wasm;return this.webIfc.SetWasmPath(e,i),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModel(t,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new Re,this._visitedFragments.clear(),this._fragmentInstances.clear()}async getAllGeometries(){this._spatialTree.setUp(this.webIfc);const t=this.webIfc.GetIfcEntityList(0),e=new Sn;e.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};const i=[];for(const n of t){if(!this.webIfc.IsIfcElement(n)&&n!==re)continue;const r=this.settings.includedCategories;if(r.size>0&&!r.has(n)||this.settings.excludedCategories.has(n))continue;const o=this.webIfc.GetLineIDsWithType(0,n),h=o.size();for(let l=0;l<h;l++){const c=o.get(l);i.push(c);const p=this._spatialTree.itemsByFloor[c]||0;e.data.set(c,[[],[p,n]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,i,n=>{this.getMesh(n,e)});for(const n of this._visitedFragments){const{index:r,fragment:o}=n[1];e.keyFragments.set(r,o.id)}for(const n of e.items){const r=this._fragmentInstances.get(n.id);if(!r)throw new Error("Fragment not found!");const o=[];for(const[h,l]of r)o.push(l);n.add(o)}const s=this.webIfc.GetCoordinationMatrix(0);return e.coordinationMatrix.fromArray(s),e.civilData=this._civil.read(this.webIfc),e}getMesh(t,e){const i=t.geometries.size(),s=t.expressID;for(let n=0;n<i;n++){const r=t.geometries.get(n),{x:o,y:h,z:l,w:c}=r.color,p=c!==1,{geometryExpressID:u}=r,d=`${u}-${p}`;if(!this._visitedFragments.has(d)){const T=this.getGeometry(this.webIfc,u),y=p?this._materialT:this._material,O=new Zr(T,y,1);e.add(O.mesh),e.items.push(O);const A=this._visitedFragments.size;this._visitedFragments.set(d,{index:A,fragment:O})}const m=new ie().setRGB(o,h,l,"srgb"),f=new ut;f.fromArray(r.flatTransformation);const E=this._visitedFragments.get(d);if(E===void 0)throw new Error("Error getting geometry data for streaming!");const I=e.data.get(s);if(!I)throw new Error("Data not found!");I[0].push(E.index);const{fragment:C}=E;this._fragmentInstances.has(C.id)||this._fragmentInstances.set(C.id,new Map);const R=this._fragmentInstances.get(C.id);if(!R)throw new Error("Instances not found!");if(R.has(s)){const T=R.get(s);if(!T)throw new Error("Instance not found!");T.transforms.push(f),T.colors&&T.colors.push(m)}else R.set(s,{id:s,transforms:[f],colors:[m]})}}getGeometry(t,e){const i=t.GetGeometry(0,e),s=t.GetIndexArray(i.GetIndexData(),i.GetIndexDataSize()),n=t.GetVertexArray(i.GetVertexData(),i.GetVertexDataSize()),r=new Float32Array(n.length/2),o=new Float32Array(n.length/2);for(let p=0;p<n.length;p+=6)r[p/2]=n[p],r[p/2+1]=n[p+1],r[p/2+2]=n[p+2],o[p/2]=n[p+3],o[p/2+1]=n[p+4],o[p/2+2]=n[p+5];const h=new si,l=new Fe(r,3),c=new Fe(o,3);return h.setAttribute("position",l),h.setAttribute("normal",c),h.setIndex(Array.from(s)),i.delete(),h}async autoSetWasm(){const t=await fetch(`https://unpkg.com/@thatopen/components@${Eo.release}/package.json`);if(!t.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const e=await t.json();if(!("web-ifc"in e.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const i=e.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${i}/`,this.settings.wasm.absolute=!0}}};g(ia,"uuid","e9c0f00f-064e-4577-871a-4f247f56aaf4");let fd=ia;class rd extends jn{constructor(){super(...arguments),g(this,"minGeometrySize",10),g(this,"minAssetsSize",1e3)}}const sa=class na extends St{constructor(t){super(t),g(this,"onGeometryStreamed",new $),g(this,"onAssetStreamed",new $),g(this,"onProgress",new $),g(this,"onIfcLoaded",new $),g(this,"onDisposed",new $),g(this,"settings",new rd),g(this,"enabled",!0),g(this,"webIfc",new Re),g(this,"_spatialTree",new bo),g(this,"_metaData",new No),g(this,"_visitedGeometries",new Map),g(this,"_streamSerializer",new Sa),g(this,"_geometries",new Map),g(this,"_geometryCount",0),g(this,"_civil",new vo),g(this,"_groupSerializer",new io),g(this,"_assets",[]),g(this,"_meshesWithHoles",new Set),this.components.add(na.uuid,this),this.settings.excludedCategories.add(Fn)}dispose(){this.onIfcLoaded.reset(),this.onGeometryStreamed.reset(),this.onAssetStreamed.reset(),this.webIfc=null,this.onDisposed.trigger(),this.onDisposed.reset()}async streamFromBuffer(t){await this.readIfcFile(t),await this.streamAllGeometries(),this.cleanUp()}async streamFromCallBack(t){await this.streamIfcFile(t),await this.streamAllGeometries(),this.cleanUp()}async readIfcFile(t){const{path:e,absolute:i,logLevel:s}=this.settings.wasm;this.webIfc.SetWasmPath(e,i),await this.webIfc.Init(),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModel(t,this.settings.webIfc)}async streamIfcFile(t){const{path:e,absolute:i,logLevel:s}=this.settings.wasm;this.webIfc.SetWasmPath(e,i),await this.webIfc.Init(),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModelFromCallback(t,this.settings.webIfc)}async streamAllGeometries(){const{minGeometrySize:t,minAssetsSize:e}=this.settings;this._spatialTree.setUp(this.webIfc);const i=this.webIfc.GetIfcEntityList(0),s=[[]],n=new Sn;n.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};let r=0,o=0;for(const m of i){if(!this.webIfc.IsIfcElement(m)&&m!==re||this.settings.excludedCategories.has(m))continue;const f=this.webIfc.GetLineIDsWithType(0,m),E=f.size();for(let I=0;I<E;I++){r>t&&(r=0,o++,s.push([]));const C=f.get(I);s[o].push(C);const R=this.webIfc.GetLine(0,C);if(R.GlobalId){const y=(R==null?void 0:R.GlobalId.value)||(R==null?void 0:R.GlobalId);n.globalToExpressIDs.set(y,C)}const T=this._spatialTree.itemsByFloor[C]||0;n.data.set(C,[[],[T,m]]),r++}}this._spatialTree.cleanUp();let h=.01,l=0;for(const m of s){l++,this.webIfc.StreamMeshes(0,m,E=>{this.getMesh(this.webIfc,E,n)}),this._geometryCount>t&&await this.streamGeometries(),this._assets.length>e&&await this.streamAssets();const f=l/s.length;f>h&&(h+=.01,h=Math.max(h,f),this.onProgress.trigger(Math.round(h*100)/100))}this._geometryCount&&await this.streamGeometries(),this._assets.length&&await this.streamAssets();const{opaque:c,transparent:p}=n.geometryIDs;for(const[m,{index:f,uuid:E}]of this._visitedGeometries)n.keyFragments.set(f,E),(m>1?c:p).set(m,f);xo.get(n,this.webIfc);const u=this.webIfc.GetCoordinationMatrix(0);n.coordinationMatrix.fromArray(u),n.civilData=this._civil.read(this.webIfc);const d=this._groupSerializer.export(n);this.onIfcLoaded.trigger(d),n.dispose(!0)}cleanUp(){try{this.webIfc.Dispose()}catch{}this.webIfc=null,this.webIfc=new Re,this._visitedGeometries.clear(),this._geometries.clear(),this._assets=[],this._meshesWithHoles.clear()}getMesh(t,e,i){const s=e.geometries.size(),n=e.expressID,r={id:n,geometries:[]};for(let o=0;o<s;o++){const h=e.geometries.get(o),l=h.geometryExpressID,c=h.color.w===1?1:-1,p=l*c;if(!this._visitedGeometries.has(p)){this._visitedGeometries.has(l)||this.getGeometry(t,l);const T=this._visitedGeometries.size,y=Xr.generateUUID();this._visitedGeometries.set(p,{uuid:y,index:T})}const u=this._visitedGeometries.get(p);if(u===void 0)throw new Error("Error getting geometry data for streaming!");const d=i.data.get(n);if(!d)throw new Error("Data not found!");d[0].push(u.index);const{x:m,y:f,z:E,w:I}=h.color,C=[m,f,E,I],R=h.flatTransformation;r.geometries.push({color:C,geometryID:l,transformation:R})}this._assets.push(r)}getGeometry(t,e){const i=t.GetGeometry(0,e),s=t.GetIndexArray(i.GetIndexData(),i.GetIndexDataSize()),n=t.GetVertexArray(i.GetVertexData(),i.GetVertexDataSize()),r=new Float32Array(n.length/2),o=new Float32Array(n.length/2);for(let u=0;u<n.length;u+=6)r[u/2]=n[u],r[u/2+1]=n[u+1],r[u/2+2]=n[u+2],o[u/2]=n[u+3],o[u/2+1]=n[u+4],o[u/2+2]=n[u+5];const h=Qh(r),l=new Float32Array(h.transformation.elements),c=[h.center.x,h.center.y,h.center.z];let p=!1;for(let u=0;u<r.length-2;u+=3){const d=r[u],m=r[u+1],f=r[u+2],E=o[u],I=o[u+1],C=o[u+2];if(Kh(c,[d,m,f],[E,I,C])){p=!0;break}}this._geometries.set(e,{position:r,normal:o,index:s,boundingBox:l,hasHoles:p}),i.delete(),this._geometryCount++}async streamAssets(){await this.onAssetStreamed.trigger(this._assets),this._assets=null,this._assets=[]}async streamGeometries(){let t=this._streamSerializer.export(this._geometries),e={};for(const[i,{boundingBox:s,hasHoles:n}]of this._geometries)e[i]={boundingBox:s,hasHoles:n};this.onGeometryStreamed.trigger({data:e,buffer:t}),e=null,t=null,this._geometries.clear(),this._geometryCount=0}};g(sa,"uuid","d9999a00-e1f5-4d3f-8cfe-c56e08609764");let md=sa;class od extends jn{constructor(){super(...arguments),g(this,"propertiesSize",100)}}class ad extends St{constructor(){super(...arguments),g(this,"onPropertiesStreamed",new ps),g(this,"onProgress",new ps),g(this,"onIndicesStreamed",new ps),g(this,"onDisposed",new $),g(this,"enabled",!0),g(this,"settings",new od),g(this,"webIfc",new Re)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(t){await this.readIfcFile(t),await this.streamAllProperties(),this.cleanUp()}async streamFromCallBack(t){await this.streamIfcFile(t),await this.streamAllProperties(),this.cleanUp()}async readIfcFile(t){const{path:e,absolute:i,logLevel:s}=this.settings.wasm;this.webIfc.SetWasmPath(e,i),await this.webIfc.Init(),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModel(t,this.settings.webIfc)}async streamIfcFile(t){const{path:e,absolute:i,logLevel:s}=this.settings.wasm;this.webIfc.SetWasmPath(e,i),await this.webIfc.Init(),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModelFromCallback(t,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:t}=this.settings,e=new Set(this.webIfc.GetIfcEntityList(0)),i=new Set([ys,Rs,Fs,Ss,re]);for(const o of i)e.add(o);let s=.01,n=0;for(const o of e){if(n++,Po.has(o))continue;const h=i.has(o),l=this.webIfc.GetLineIDsWithType(0,o),c=l.size();let p=0;for(let u=0;u<c-t;u+=t){const d={};for(let m=0;m<t;m++){p++;const f=l.get(u+m);try{const E=this.webIfc.GetLine(0,f,h);d[E.expressID]=E}catch{console.log(`Could not get property: ${f}`)}}await this.onPropertiesStreamed.trigger({type:o,data:d})}if(p!==c){const u={};for(let d=p;d<c;d++){const m=l.get(d);try{const f=this.webIfc.GetLine(0,m,h);u[f.expressID]=f}catch{console.log(`Could not get property: ${m}`)}}await this.onPropertiesStreamed.trigger({type:o,data:u})}n/e.size>s&&(s=Math.round(s*100)/100,await this.onProgress.trigger(s),s+=.01)}await this.onProgress.trigger(1);const r=await this.components.get(Pi).processFromWebIfc(this.webIfc,0);await this.onIndicesStreamed.trigger(r)}cleanUp(){this.webIfc.Dispose(),this.webIfc=null,this.webIfc=new Re}}g(ad,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");class ra{constructor(t,e,i){g(this,"title"),g(this,"guid",Ue.create()),g(this,"clippingPlanes",new ei),g(this,"camera",{aspectRatio:0,fov:0,direction:{x:0,y:0,z:80},position:{x:0,y:0,z:0}}),g(this,"exceptionComponents",new ei),g(this,"selectionComponents",new ei),g(this,"componentColors",new Ae),g(this,"spacesVisible",!1),g(this,"spaceBoundariesVisible",!1),g(this,"openingsVisible",!1),g(this,"defaultVisibility",!0),g(this,"_components"),g(this,"world");const s={setCamera:!0,...i},{data:n,setCamera:r}=s;this._components=t,this.world=e,n&&(this.guid=n.guid??this.guid,this.set(n)),r&&this.updateCamera()}get _selectionModelIdMap(){const t=this._components.get(Tt),e={};for(const[i,s]of t.groups){i in e||(e[i]=new Set);for(const n of this.selectionComponents){const r=s.globalToExpressIDs.get(n);r&&e[i].add(r)}}return e}get _exceptionModelIdMap(){const t=this._components.get(Tt),e={};for(const[i,s]of t.groups){i in e||(e[i]=new Set);for(const n of this.exceptionComponents){const r=s.globalToExpressIDs.get(n);r&&e[i].add(r)}}return e}get selection(){return this._components.get(Tt).modelIdToFragmentIdMap(this._selectionModelIdMap)}get exception(){return this._components.get(Tt).modelIdToFragmentIdMap(this._exceptionModelIdMap)}get projection(){return"fov"in this.camera?"Perspective":"Orthographic"}get position(){const t=this._components.get(Tt),{position:e}=this.camera,{x:i,y:s,z:n}=e,r=new U(i,s,n);return t.applyBaseCoordinateSystem(r,new ut),r}get direction(){const{direction:t}=this.camera,{x:e,y:i,z:s}=t;return new U(e,i,s)}get _managerVersion(){return this._components.get(Bt).config.version}get topics(){return[...this._components.get(Bt).list.values()].filter(t=>t.viewpoints.has(this.guid))}addComponentsFromMap(t){const e=this._components.get(Tt).fragmentIdMapToGuids(t);this.selectionComponents.add(...e),this._components.get(me).list.set(this.guid,this)}set(t){const e=t,i=this;for(const s in t){if(s==="guid")continue;const n=e[s];if(s==="selectionComponents"){this.selectionComponents.clear(),this.selectionComponents.add(...n);continue}if(s==="exceptionComponents"){this.exceptionComponents.clear(),this.exceptionComponents.add(...n);continue}s in this&&(i[s]=n)}return this._components.get(me).list.set(this.guid,this),this}async go(t=!0){const{camera:e}=this.world;if(!e.hasCameraControls())throw new Error("Viewpoint: the world's camera need controls to set the viewpoint.");e instanceof Al&&e.projection.set(this.projection);const i=this.position,s=this.direction;let n={x:i.x+s.x*80,y:i.y+s.y*80,z:i.z+s.z*80};const r=this.selection;if(Object.keys(r).length===0){const h=this._components.get(fn).get(this.world).castRayFromVector(i,this.direction);h&&(n=h.point)}else{const h=this._components.get(Kc);h.reset(),h.addFragmentIdMap(r),n=h.getSphere().center,h.reset()}const o=this._components.get(qc);o.set(this.defaultVisibility),o.set(!this.defaultVisibility,this.exception),o.set(!0,r),await e.controls.setLookAt(i.x,i.y,i.z,n.x,n.y,n.z,t)}updateCamera(){const{camera:t,renderer:e}=this.world;if(!e)throw new Error("Viewpoint: the world needs to have a renderer!");if(!t.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const i=new U;t.controls.getPosition(i);const s=t.three,n=new U(0,0,-1).applyEuler(s.rotation),{width:r,height:o}=e.getSize();let h=r/o;Number.isNaN(h)&&(h=1);const l=this._components.get(Tt);i.applyMatrix4(l.baseCoordinationMatrix.clone().invert());const c={aspectRatio:h,position:{x:i.x,y:i.y,z:i.z},direction:{x:n.x,y:n.y,z:n.z}};s instanceof Rn?this.camera={...c,fov:s.fov}:s instanceof De&&(this.camera={...c,viewToWorldScale:s.top-s.bottom}),this._components.get(me).list.set(this.guid,this)}colorize(){const t=this._components.get(me),e=this._components.get(Tt),i=this._components.get(_n);for(const[s,n]of this.componentColors){const r=e.guidToFragmentIdMap(n),o=new ie(`#${s}`);i.setColor(r,o,t.config.overwriteColors)}}resetColors(){const t=this._components.get(Tt),e=this._components.get(_n);for(const[i,s]of this.componentColors){const n=t.guidToFragmentIdMap(s);e.resetColor(n)}}async createComponentTags(t){var e,i;const s=this._components.get(Tt),n=this._components.get(Bt);let r="";if(n.config.includeSelectionTag){const o=t==="selection"?this._selectionModelIdMap:this._exceptionModelIdMap;for(const h in o){const l=s.groups.get(h);if(!l)continue;const c=o[h];for(const p of c){const u=await l.getProperties(p);if(!u)continue;const d=(e=u.GlobalId)==null?void 0:e.value;if(!d)continue;const m=(i=u.Tag)==null?void 0:i.value;let f=null;m&&(f=`AuthoringToolId="${m}"`),r+=`
<Component IfcGuid="${d}" ${f??""} />`}}}else r=[...this.selectionComponents].map(o=>`<Component IfcGuid="${o}" />`).join(`
`);return r}async serialize(t=this._managerVersion){const e=this._components.get(Tt),i=this.position;i.applyMatrix4(e.baseCoordinationMatrix.clone().invert());const s=this.direction;s.normalize();const n=new ut().makeRotationX(Math.PI/2),r=s.clone().applyMatrix4(n);r.normalize();const o=`<CameraViewPoint>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraViewPoint>`,h=`<CameraDirection>
      <X>${s.x}</X>
      <Y>${-s.z}</Y>
      <Z>${s.y}</Z>
    </CameraDirection>`,l=`<CameraUpVector>
      <X>${r.x}</X>
      <Y>${-r.z}</Y>
      <Z>${r.y}</Z>
    </CameraUpVector>`,c=`<AspectRatio>${this.camera.aspectRatio}</AspectRatio>`;let p="";"viewToWorld"in this.camera?p=`<OrthogonalCamera>
        ${o}
        ${h}
        ${l}
        ${c}
        <ViewToWorldScale>${this.camera.viewToWorld}</ViewToWorldScale>
      </OrthogonalCamera>`:"fov"in this.camera&&(p=`<PerspectiveCamera>
        ${o}
        ${h}
        ${l}
        ${c}
        <FieldOfView>${this.camera.fov}</FieldOfView>
      </PerspectiveCamera>`);const u=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,d=(await this.createComponentTags("selection")).trim(),m=(await this.createComponentTags("exception")).trim();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${t==="2.1"?u:""}
        ${d.length!==0?`<Selection>${d}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${t==="3"?u:""}
          ${m.length!==0?`<Exceptions>${m}</Exceptions>`:""}
        </Visibility>
      </Components>
      ${p}
    </VisualizationInfo>`}}const oa=class aa extends St{constructor(t){super(t),g(this,"enabled",!0),g(this,"list",new Ae),g(this,"isSetup",!1),g(this,"onSetup",new $),g(this,"config",{overwriteColors:!1}),g(this,"onDisposed",new $),t.add(aa.uuid,this)}create(t,e){const i=new ra(this.components,t,{data:e});return e||this.list.set(i.guid,i),i}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};g(oa,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let me=oa;class hd{constructor(t){if(g(this,"onDisposed",new $),g(this,"onAfterUpdate",new $),g(this,"onBeforeUpdate",new $),g(this,"onResize",new $),g(this,"frontOffset",0),g(this,"overrideMaterial",new Oa),g(this,"backgroundColor",new ie(395274)),g(this,"renderer"),g(this,"enabled",!0),g(this,"world"),g(this,"_lockRotation",!0),g(this,"_camera"),g(this,"_plane"),g(this,"_size",new se(320,160)),g(this,"_tempVector1",new U),g(this,"_tempVector2",new U),g(this,"_tempTarget",new U),g(this,"down",new U(0,-1,0)),g(this,"updatePlanes",()=>{if(!this.world.renderer)throw new Error("The given world must have a renderer!");const s=[],n=this.world.renderer.three;for(const r of n.clippingPlanes)s.push(r);s.push(this._plane),this.renderer.clippingPlanes=s}),this.world=t,!this.world.renderer)throw new Error("The given world must have a renderer!");this.renderer=new Ni,this.renderer.setSize(this._size.x,this._size.y);const e=1,i=this._size.x/this._size.y;this._camera=new De(e*i/-2,e*i/2,e/2,e/-2),this.world.renderer.onClippingPlanesUpdated.add(this.updatePlanes),this._camera.position.set(0,200,0),this._camera.zoom=.1,this._camera.rotation.x=-Math.PI/2,this._plane=new oi(this.down,200),this.updatePlanes()}get lockRotation(){return this._lockRotation}set lockRotation(t){this._lockRotation=t,t&&(this._camera.rotation.z=0)}get zoom(){return this._camera.zoom}set zoom(t){this._camera.zoom=t,this._camera.updateProjectionMatrix()}dispose(){this.enabled=!1,this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.onResize.reset(),this.overrideMaterial.dispose(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return this._camera}update(){if(!this.enabled)return;this.onBeforeUpdate.trigger();const t=this.world.scene.three,e=this.world.camera;if(!e.hasCameraControls())throw new Error("The given world must use camera controls!");if(!(t instanceof _s))throw new Error("The given world must have a THREE.Scene as a root!");const i=e.controls;if(i.getPosition(this._tempVector1),this._camera.position.x=this._tempVector1.x,this._camera.position.z=this._tempVector1.z,this.frontOffset!==0&&(i.getTarget(this._tempVector2),this._tempVector2.sub(this._tempVector1),this._tempVector2.normalize().multiplyScalar(this.frontOffset),this._camera.position.x+=this._tempVector2.x,this._camera.position.z+=this._tempVector2.z),!this._lockRotation){i.getTarget(this._tempTarget);const n=Math.atan2(this._tempTarget.x-this._tempVector1.x,this._tempTarget.z-this._tempVector1.z);this._camera.rotation.z=n+Math.PI}this._plane.set(this.down,this._tempVector1.y);const s=t.background;t.background=this.backgroundColor,this.renderer.render(t,this._camera),t.background=s,this.onAfterUpdate.trigger()}getSize(){return this._size}resize(t=this._size){this._size.copy(t),this.renderer.setSize(t.x,t.y);const e=t.x/t.y,i=1;this._camera.left=i*e/-2,this._camera.right=i*e/2,this._camera.top=i/2,this._camera.bottom=-i/2,this._camera.updateProjectionMatrix(),this.onResize.trigger(t)}}const ha=class la extends St{constructor(t){super(t),g(this,"onAfterUpdate",new $),g(this,"onBeforeUpdate",new $),g(this,"onDisposed",new $),g(this,"enabled",!0),g(this,"list",new Map),this.components.add(la.uuid,this)}create(t){if(this.list.has(t.uuid))throw new Error("This world already has a minimap!");const e=new hd(t);return this.list.set(t.uuid,e),e}delete(t){const e=this.list.get(t);e&&e.dispose(),this.list.delete(t)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}update(){for(const[t,e]of this.list)e.update()}};g(ha,"uuid","39ad6aad-84c8-4adf-a1e0-7f25313a9e7f");let Ed=ha;const ca=class da extends St{constructor(t){super(t),g(this,"enabled",!0),t.add(da.uuid,this)}static distanceFromPointToLine(t,e,i,s=!1){const n=new ee,r=new U;return n.set(e,i),n.closestPointToPoint(t,s,r),r.distanceTo(t)}getFace(t,e,i){if(!t.geometry.index)throw new Error("Geometry must be indexed!");const s=new Map,n=t.geometry.index.array,{plane:r}=this.getFaceData(e,i,t),o=[];for(let p=0;p<n.length/3;p++){const{plane:u,edges:d}=this.getFaceData(p,i,t);if(u.equals(r)){o.push({index:p,edges:d});for(const{id:m,points:f,distance:E}of d)s.set(m,{points:f,distance:E})}}let h=0;const l=new Map,c=new Map;for(const{index:p,edges:u}of o){const d=new Map;for(const{id:T}of u)if(l.has(T)){const y=l.get(T);d.set(T,y)}const m=u.map(T=>T.id);if(!d.size){const T=h++;for(const{id:y}of u)l.set(y,T);c.set(T,{edges:new Set(m),indices:new Set([p])});continue}let f=null;const E=new Set,I=new Set(m);for(const[T,y]of d){f===null?f=y:y!==f&&E.add(y),l.delete(T);const{edges:O}=c.get(y);O.delete(T),I.delete(T)}if(f===null)throw new Error("Error computing face!");const C=c.get(f),{indices:R}=C;R.add(p);for(const T of I){l.set(T,f);const{edges:y}=C;y.add(T)}for(const T of E){const y=c.get(T),{edges:O,indices:A}=y,N=c.get(f),{edges:b,indices:P}=N;for(const z of O)b.add(z),l.set(z,f);for(const z of A)P.add(z);c.delete(T)}}for(const[p,{indices:u,edges:d}]of c)if(u.has(e)){const m=[];for(const f of d){const E=s.get(f);m.push(E)}return{edges:m,indices:u}}return null}getVerticesAndNormal(t,e,i){if(!t.geometry.index)throw new Error("Geometry must be indexed!");const s=t.geometry.index.array,n=t.geometry.attributes.position.array,r=t.geometry.attributes.normal.array,o=s[e*3]*3,h=s[e*3+1]*3,l=s[e*3+2]*3,c=new U(n[o],n[o+1],n[o+2]),p=new U(n[h],n[h+1],n[h+2]),u=new U(n[l],n[l+1],n[l+2]),d=new U(r[o],r[o+1],r[o+2]),m=new U(r[h],r[h+1],r[h+2]),f=new U(r[l],r[l+1],r[l+2]),E=(d.x+m.x+f.x)/3,I=(d.y+m.y+f.y)/3,C=(d.z+m.z+f.z)/3,R=new U(E,I,C);if(i!==void 0&&t instanceof Me){const T=new ut;t.getMatrixAt(i,T);const y=new ut;y.extractRotation(T),R.applyMatrix4(y),c.applyMatrix4(T),p.applyMatrix4(T),u.applyMatrix4(T)}return{p1:c,p2:p,p3:u,faceNormal:R}}round(t){t.x=Math.trunc(t.x*1e3)/1e3,t.y=Math.trunc(t.y*1e3)/1e3,t.z=Math.trunc(t.z*1e3)/1e3}getVolumeFromFragments(t){const e=this.components.get(Tt),i=new ut,s=[];for(const r in t){const o=e.list.get(r);if(!o)continue;const h=t[r];let l=0;for(const u of h){const d=o.getInstancesIDs(u);d&&(l+=d.size)}const c=new Me(o.mesh.geometry,void 0,l);let p=0;for(const u of h){const d=o.getInstancesIDs(u);if(d)for(const m of d)o.mesh.getMatrixAt(m,i),c.setMatrixAt(p++,i)}s.push(c)}const n=this.getVolumeFromMeshes(s);for(const r of s)r.geometry=null,r.material=[],r.dispose();return n}getVolumeFromMeshes(t){let e=0;for(const i of t)e+=this.getVolumeOfMesh(i);return e}getFaceData(t,e,i){const s=this.getVerticesAndNormal(i,t,e),{p1:n,p2:r,p3:o,faceNormal:h}=s;this.round(n),this.round(r),this.round(o),this.round(h);const l=[{id:`${n.x}|${n.y}|${n.z}`,value:n},{id:`${r.x}|${r.y}|${r.z}`,value:r},{id:`${o.x}|${o.y}|${o.z}`,value:o}];l.sort((C,R)=>C.id<R.id?-1:C.id>R.id?1:0);const[{id:c,value:p},{id:u,value:d},{id:m,value:f}]=l,E=[{id:`${c}|${u}`,distance:p.distanceTo(d),points:[p,d]},{id:`${u}|${m}`,distance:d.distanceTo(f),points:[d,f]},{id:`${c}|${m}`,distance:p.distanceTo(f),points:[p,f]}],I=new oi;return I.setFromNormalAndCoplanarPoint(h,n),I.constant=Math.round(I.constant*10)/10,{plane:I,edges:E}}getVolumeOfMesh(t){let e=0;const i=new U,s=new U,n=new U,{index:r}=t.geometry,o=t.geometry.attributes.position.array;if(!r)return console.warn("Geometry must be indexed to compute its volume!"),0;const h=[];if(t instanceof Me)for(let c=0;c<t.count;c++){const p=new ut;t.getMatrixAt(c,p),h.push(p)}else h.push(new ut().identity());const{matrixWorld:l}=t;for(let c=0;c<r.array.length-2;c+=3)for(const p of h){const u=p.multiply(l),d=r.array[c]*3,m=r.array[c+1]*3,f=r.array[c+2]*3;i.set(o[d],o[d+1],o[d+2]).applyMatrix4(u),s.set(o[m],o[m+1],o[m+2]).applyMatrix4(u),n.set(o[f],o[f+1],o[f+2]).applyMatrix4(u),e+=this.getSignedVolumeOfTriangle(i,s,n)}return Math.abs(e)}getSignedVolumeOfTriangle(t,e,i){const s=i.x*e.y*t.z,n=e.x*i.y*t.z,r=i.x*t.y*e.z,o=t.x*i.y*e.z,h=e.x*t.y*i.z,l=t.x*e.y*i.z;return 1/6*(-s+n+r-o-h+l)}};g(ca,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");let Id=ca;export{Tt as C,fd as F,dd as H,qc as I,Bt as L,qh as M,Id as N,Ed as O,_n as P,md as S,ad as U,cd as Y,ll as a,xi as b,wl as c,Eo as d,fn as e,me as f,bl as g,ud as h,Do as i,Oo as k,nl as l,Kc as m,Al as r,xl as u,Pi as v,pd as w,Jh as x};
